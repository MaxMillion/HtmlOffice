/*

 This is a generated file. DO NOT EDIT.

 Copyright (C) 2010-2014 KO GmbH <copyright@kogmbh.com>

 @licstart
 This file is the compiled version of the WebODF library.

 WebODF is free software: you can redistribute it and/or modify it
 under the terms of the GNU Affero General Public License (GNU AGPL)
 as published by the Free Software Foundation, either version 3 of
 the License, or (at your option) any later version.

 WebODF is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU Affero General Public License for more details.

 You should have received a copy of the GNU Affero General Public License
 along with WebODF.  If not, see <http://www.gnu.org/licenses/>.
 @licend

 @source: http://www.webodf.org/
 @source: https://github.com/kogmbh/WebODF/
*/
var webodf_version="0.4.2-2481-g69672c6-dirty";function Runtime(){}Runtime.prototype.getVariable=function(f){};Runtime.prototype.toJson=function(f){};Runtime.prototype.fromJson=function(f){};Runtime.prototype.byteArrayFromString=function(f,h){};Runtime.prototype.byteArrayToString=function(f,h){};Runtime.prototype.read=function(f,h,d,c){};Runtime.prototype.readFile=function(f,h,d){};Runtime.prototype.readFileSync=function(f,h){};Runtime.prototype.loadXML=function(f,h){};Runtime.prototype.writeFile=function(f,h,d){};
Runtime.prototype.isFile=function(f,h){};Runtime.prototype.getFileSize=function(f,h){};Runtime.prototype.deleteFile=function(f,h){};Runtime.prototype.log=function(f,h){};Runtime.prototype.setTimeout=function(f,h){};Runtime.prototype.clearTimeout=function(f){};Runtime.prototype.libraryPaths=function(){};Runtime.prototype.currentDirectory=function(){};Runtime.prototype.setCurrentDirectory=function(f){};Runtime.prototype.type=function(){};Runtime.prototype.getDOMImplementation=function(){};
Runtime.prototype.parseXML=function(f){};Runtime.prototype.exit=function(f){};Runtime.prototype.getWindow=function(){};Runtime.prototype.requestAnimationFrame=function(f){};Runtime.prototype.cancelAnimationFrame=function(f){};Runtime.prototype.assert=function(f,h,d){};var IS_COMPILED_CODE=!0;
Runtime.byteArrayToString=function(f,h){function d(c){var d="",e,f=c.length;for(e=0;e<f;e+=1)d+=String.fromCharCode(c[e]&255);return d}function c(c){var d="",e,f=c.length,n=[],q,b,a,l;for(e=0;e<f;e+=1)q=c[e],128>q?n.push(q):(e+=1,b=c[e],194<=q&&224>q?n.push((q&31)<<6|b&63):(e+=1,a=c[e],224<=q&&240>q?n.push((q&15)<<12|(b&63)<<6|a&63):(e+=1,l=c[e],240<=q&&245>q&&(q=(q&7)<<18|(b&63)<<12|(a&63)<<6|l&63,q-=65536,n.push((q>>10)+55296,(q&1023)+56320))))),1E3<=n.length&&(d+=String.fromCharCode.apply(null,
n),n.length=0);return d+String.fromCharCode.apply(null,n)}var e;"utf8"===h?e=c(f):("binary"!==h&&this.log("Unsupported encoding: "+h),e=d(f));return e};Runtime.getVariable=function(f){try{return eval(f)}catch(h){}};Runtime.toJson=function(f){return JSON.stringify(f)};Runtime.fromJson=function(f){return JSON.parse(f)};Runtime.getFunctionName=function(f){return void 0===f.name?(f=/function\s+(\w+)/.exec(f))&&f[1]:f.name};
function BrowserRuntime(f){function h(c){var b=c.length,a,l,k=0;for(a=0;a<b;a+=1)l=c.charCodeAt(a),k+=1+(128<l)+(2048<l),55040<l&&57344>l&&(k+=1,a+=1);return k}function d(c,b,a){var l=c.length,k,d;b=new Uint8Array(new ArrayBuffer(b));a?(b[0]=239,b[1]=187,b[2]=191,d=3):d=0;for(a=0;a<l;a+=1)k=c.charCodeAt(a),128>k?(b[d]=k,d+=1):2048>k?(b[d]=192|k>>>6,b[d+1]=128|k&63,d+=2):55040>=k||57344<=k?(b[d]=224|k>>>12&15,b[d+1]=128|k>>>6&63,b[d+2]=128|k&63,d+=3):(a+=1,k=(k-55296<<10|c.charCodeAt(a)-56320)+65536,
b[d]=240|k>>>18&7,b[d+1]=128|k>>>12&63,b[d+2]=128|k>>>6&63,b[d+3]=128|k&63,d+=4);return b}function c(c){var b=c.length,a=new Uint8Array(new ArrayBuffer(b)),l;for(l=0;l<b;l+=1)a[l]=c.charCodeAt(l)&255;return a}function e(c,b){var a,l,k;void 0!==b?k=c:b=c;f?(l=f.ownerDocument,k&&(a=l.createElement("span"),a.className=k,a.appendChild(l.createTextNode(k)),f.appendChild(a),f.appendChild(l.createTextNode(" "))),a=l.createElement("span"),0<b.length&&"<"===b[0]?a.innerHTML=b:a.appendChild(l.createTextNode(b)),
f.appendChild(a),f.appendChild(l.createElement("br"))):console&&console.log(b);"alert"===k&&alert(b)}function m(q,b,a){if(0!==a.status||a.responseText)if(200===a.status||0===a.status){if(a.response&&"string"!==typeof a.response)"binary"===b?(a=a.response,a=new Uint8Array(a)):a=String(a.response);else if("binary"===b)if(null!==a.responseBody&&"undefined"!==String(typeof VBArray)){a=(new VBArray(a.responseBody)).toArray();var l=a.length,k=new Uint8Array(new ArrayBuffer(l));for(b=0;b<l;b+=1)k[b]=a[b];
a=k}else{(b=a.getResponseHeader("Content-Length"))&&(b=parseInt(b,10));if(b&&b!==a.responseText.length)a:{var l=a.responseText,k=!1,e=h(l);if("number"===typeof b){if(b!==e&&b!==e+3){l=void 0;break a}k=e+3===b;e=b}l=d(l,e,k)}void 0===l&&(l=c(a.responseText));a=l}else a=a.responseText;n[q]=a;q={err:null,data:a}}else q={err:a.responseText||a.statusText,data:null};else q={err:"File "+q+" is empty.",data:null};return q}function g(c,b,a){var l=new XMLHttpRequest;l.open("GET",c,a);l.overrideMimeType&&("binary"!==
b?l.overrideMimeType("text/plain; charset="+b):l.overrideMimeType("text/plain; charset=x-user-defined"));return l}function p(c,b,a){function l(){var l;4===k.readyState&&(l=m(c,b,k),a(l.err,l.data))}if(n.hasOwnProperty(c))a(null,n[c]);else{var k=g(c,b,!0);k.onreadystatechange=l;try{k.send(null)}catch(d){a(d.message,null)}}}var r=this,n={};this.byteArrayFromString=function(e,b){var a;"utf8"===b?a=d(e,h(e),!1):("binary"!==b&&r.log("unknown encoding: "+b),a=c(e));return a};this.byteArrayToString=Runtime.byteArrayToString;
this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=p;this.read=function(c,b,a,l){p(c,"binary",function(k,c){var d=null;if(c){if("string"===typeof c)throw"This should not happen.";d=c.subarray(b,b+a)}l(k,d)})};this.readFileSync=function(c,b){var a=g(c,b,!1),l;try{a.send(null);l=m(c,b,a);if(l.err)throw l.err;if(null===l.data)throw"No data read from "+c+".";}catch(k){throw k;}return l.data};this.writeFile=function(c,b,a){n[c]=b;var l=new XMLHttpRequest,
k;l.open("PUT",c,!0);l.onreadystatechange=function(){4===l.readyState&&(0!==l.status||l.responseText?200<=l.status&&300>l.status||0===l.status?a(null):a("Status "+String(l.status)+": "+l.responseText||l.statusText):a("File "+c+" is empty."))};k=b.buffer&&!l.sendAsBinary?b.buffer:r.byteArrayToString(b,"binary");try{l.sendAsBinary?l.sendAsBinary(k):l.send(k)}catch(d){r.log("HUH? "+d+" "+b),a(d.message)}};this.deleteFile=function(c,b){delete n[c];var a=new XMLHttpRequest;a.open("DELETE",c,!0);a.onreadystatechange=
function(){4===a.readyState&&(200>a.status&&300<=a.status?b(a.responseText):b(null))};a.send(null)};this.loadXML=function(c,b){var a=new XMLHttpRequest;a.open("GET",c,!0);a.overrideMimeType&&a.overrideMimeType("text/xml");a.onreadystatechange=function(){4===a.readyState&&(0!==a.status||a.responseText?200===a.status||0===a.status?b(null,a.responseXML):b(a.responseText,null):b("File "+c+" is empty.",null))};try{a.send(null)}catch(l){b(l.message,null)}};this.isFile=function(c,b){r.getFileSize(c,function(a){b(-1!==
a)})};this.getFileSize=function(c,b){if(n.hasOwnProperty(c)&&"string"!==typeof n[c])b(n[c].length);else{var a=new XMLHttpRequest;a.open("HEAD",c,!0);a.onreadystatechange=function(){if(4===a.readyState){var l=a.getResponseHeader("Content-Length");l?b(parseInt(l,10)):p(c,"binary",function(a,l){a?b(-1):b(l.length)})}};a.send(null)}};this.log=e;this.assert=function(c,b,a){if(!c)throw e("alert","ASSERTION FAILED:\n"+b),a&&a(),b;};this.setTimeout=function(c,b){return setTimeout(function(){c()},b)};this.clearTimeout=
function(c){clearTimeout(c)};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(){};this.currentDirectory=function(){return""};this.type=function(){return"BrowserRuntime"};this.getDOMImplementation=function(){return window.document.implementation};this.parseXML=function(c){return(new DOMParser).parseFromString(c,"text/xml")};this.exit=function(c){e("Calling exit with code "+String(c)+", but exit() is not implemented.")};this.getWindow=function(){return window};this.requestAnimationFrame=
function(c){var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,a=0;if(b)b.bind(window),a=b(c);else return setTimeout(c,15);return a};this.cancelAnimationFrame=function(c){var b=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;b?(b.bind(window),b(c)):clearTimeout(c)}}
function NodeJSRuntime(){function f(c){var d=c.length,e,b=new Uint8Array(new ArrayBuffer(d));for(e=0;e<d;e+=1)b[e]=c[e];return b}function h(d,g,p){function b(a,b){if(a)return p(a,null);if(!b)return p("No data for "+d+".",null);if("string"===typeof b)return p(a,b);p(a,f(b))}d=e.resolve(m,d);"binary"!==g?c.readFile(d,g,b):c.readFile(d,null,b)}var d=this,c=require("fs"),e=require("path"),m="",g,p;this.byteArrayFromString=function(c,d){var e=new Buffer(c,d),b,a=e.length,l=new Uint8Array(new ArrayBuffer(a));
for(b=0;b<a;b+=1)l[b]=e[b];return l};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.readFile=h;this.loadXML=function(c,e){h(c,"utf-8",function(g,b){if(g)return e(g,null);if(!b)return e("No data for "+c+".",null);e(null,d.parseXML(b))})};this.writeFile=function(d,g,f){g=new Buffer(g);d=e.resolve(m,d);c.writeFile(d,g,"binary",function(b){f(b||null)})};this.deleteFile=function(d,g){d=e.resolve(m,d);
c.unlink(d,g)};this.read=function(d,g,p,b){d=e.resolve(m,d);c.open(d,"r+",666,function(a,l){if(a)b(a,null);else{var k=new Buffer(p);c.read(l,k,0,p,g,function(a){c.close(l);b(a,f(k))})}})};this.readFileSync=function(d,e){var g;g=c.readFileSync(d,"binary"===e?null:e);if(null===g)throw"File "+d+" could not be read.";"binary"===e&&(g=f(g));return g};this.isFile=function(d,g){d=e.resolve(m,d);c.stat(d,function(c,b){g(!c&&b.isFile())})};this.getFileSize=function(d,g){d=e.resolve(m,d);c.stat(d,function(c,
b){c?g(-1):g(b.size)})};this.log=function(c,d){var e;void 0!==d?e=c:d=c;"alert"===e&&process.stderr.write("\n!!!!! ALERT !!!!!\n");process.stderr.write(d+"\n");"alert"===e&&process.stderr.write("!!!!! ALERT !!!!!\n")};this.assert=function(c,d,e){c||(process.stderr.write("ASSERTION FAILED: "+d),e&&e())};this.setTimeout=function(c,d){return setTimeout(function(){c()},d)};this.clearTimeout=function(c){clearTimeout(c)};this.libraryPaths=function(){return[__dirname]};this.setCurrentDirectory=function(c){m=
c};this.currentDirectory=function(){return m};this.type=function(){return"NodeJSRuntime"};this.getDOMImplementation=function(){return p};this.parseXML=function(c){return g.parseFromString(c,"text/xml")};this.exit=process.exit;this.getWindow=function(){return null};this.requestAnimationFrame=function(c){return setTimeout(c,15)};this.cancelAnimationFrame=function(c){clearTimeout(c)};g=new (require("xmldom").DOMParser);p=d.parseXML("<a/>").implementation}
function RhinoRuntime(){function f(c,d){var e;void 0!==d?e=c:d=c;"alert"===e&&print("\n!!!!! ALERT !!!!!");print(d);"alert"===e&&print("!!!!! ALERT !!!!!")}var h=this,d={},c=d.javax.xml.parsers.DocumentBuilderFactory.newInstance(),e,m,g="";c.setValidating(!1);c.setNamespaceAware(!0);c.setExpandEntityReferences(!1);c.setSchema(null);m=d.org.xml.sax.EntityResolver({resolveEntity:function(c,e){var g=new d.java.io.FileReader(e);return new d.org.xml.sax.InputSource(g)}});e=c.newDocumentBuilder();e.setEntityResolver(m);
this.byteArrayFromString=function(c,d){var e,g=c.length,b=new Uint8Array(new ArrayBuffer(g));for(e=0;e<g;e+=1)b[e]=c.charCodeAt(e)&255;return b};this.byteArrayToString=Runtime.byteArrayToString;this.getVariable=Runtime.getVariable;this.fromJson=Runtime.fromJson;this.toJson=Runtime.toJson;this.loadXML=function(c,g){var f=new d.java.io.File(c),h=null;try{h=e.parse(f)}catch(b){return print(b),g(b,null)}g(null,h)};this.readFile=function(c,e,f){g&&(c=g+"/"+c);var m=new d.java.io.File(c),b="binary"===e?
"latin1":e;m.isFile()?((c=readFile(c,b))&&"binary"===e&&(c=h.byteArrayFromString(c,"binary")),f(null,c)):f(c+" is not a file.",null)};this.writeFile=function(c,e,f){g&&(c=g+"/"+c);c=new d.java.io.FileOutputStream(c);var h,b=e.length;for(h=0;h<b;h+=1)c.write(e[h]);c.close();f(null)};this.deleteFile=function(c,e){g&&(c=g+"/"+c);var f=new d.java.io.File(c),h=c+Math.random(),h=new d.java.io.File(h);f.rename(h)?(h.deleteOnExit(),e(null)):e("Could not delete "+c)};this.read=function(c,e,f,h){g&&(c=g+"/"+
c);var b;b=c;var a="binary";(new d.java.io.File(b)).isFile()?("binary"===a&&(a="latin1"),b=readFile(b,a)):b=null;b?h(null,this.byteArrayFromString(b.substring(e,e+f),"binary")):h("Cannot read "+c,null)};this.readFileSync=function(c,d){if(!d)return"";var e=readFile(c,d);if(null===e)throw"File could not be read.";return e};this.isFile=function(c,e){g&&(c=g+"/"+c);var f=new d.java.io.File(c);e(f.isFile())};this.getFileSize=function(c,e){g&&(c=g+"/"+c);var f=new d.java.io.File(c);e(f.length())};this.log=
f;this.assert=function(c,d,e){c||(f("alert","ASSERTION FAILED: "+d),e&&e())};this.setTimeout=function(c){c();return 0};this.clearTimeout=function(){};this.libraryPaths=function(){return["lib"]};this.setCurrentDirectory=function(c){g=c};this.currentDirectory=function(){return g};this.type=function(){return"RhinoRuntime"};this.getDOMImplementation=function(){return e.getDOMImplementation()};this.parseXML=function(c){c=new d.java.io.StringReader(c);c=new d.org.xml.sax.InputSource(c);return e.parse(c)};
this.exit=quit;this.getWindow=function(){return null};this.requestAnimationFrame=function(c){c();return 0};this.cancelAnimationFrame=function(){}}Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime(window.document.getElementById("logoutput")):"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),core={},gui={},xmldom={},odf={},ops={},webodf={};
(function(){webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source"})();
(function(){function f(c,d,e){var g=c+"/manifest.json",b,a;runtime.log("Loading manifest: "+g);try{b=runtime.readFileSync(g,"utf-8")}catch(l){if(e)runtime.log("No loadable manifest found.");else throw console.log(String(l)),l;return}e=JSON.parse(b);for(a in e)e.hasOwnProperty(a)&&(d[a]={dir:c,deps:e[a]})}function h(c,d,e){function g(k){if(!l[k]&&!e(k)){if(a[k])throw"Circular dependency detected for "+k+".";a[k]=!0;if(!d[k])throw"Missing dependency information for class "+k+".";var c=d[k],f=c.deps,
h,m=f.length;for(h=0;h<m;h+=1)g(f[h]);a[k]=!1;l[k]=!0;b.push(c.dir+"/"+k.replace(".","/")+".js")}}var b=[],a={},l={};c.forEach(g);return b}function d(c,d){return d=d+("\n//# sourceURL="+c)+("\n//@ sourceURL="+c)}function c(c){var e,g;for(e=0;e<c.length;e+=1)g=runtime.readFileSync(c[e],"utf-8"),g=d(c[e],g),eval(g)}function e(c){c=c.split(".");var d,e=g,f=c.length;for(d=0;d<f;d+=1){if(!e.hasOwnProperty(c[d]))return!1;e=e[c[d]]}return!0}var m,g={core:core,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=
function(d,g){if(IS_COMPILED_CODE||0===d.length)return g&&g();var n;if(!(n=m)){n=[];var q=runtime.libraryPaths(),b;runtime.currentDirectory()&&-1===q.indexOf(runtime.currentDirectory())&&f(runtime.currentDirectory(),n,!0);for(b=0;b<q.length;b+=1)f(q[b],n)}m=n;d=h(d,m,e);if(0===d.length)return g&&g();if("BrowserRuntime"===runtime.type()&&g){n=d;q=document.currentScript||document.documentElement.lastChild;b=document.createDocumentFragment();var a,l;for(l=0;l<n.length;l+=1)a=document.createElement("script"),
a.type="text/javascript",a.charset="utf-8",a.async=!1,a.setAttribute("src",n[l]),b.appendChild(a);g&&(a.onload=g);q.parentNode.insertBefore(b,q)}else c(d),g&&g()};runtime.loadClass=function(c,d){runtime.loadClasses([c],d)}})();(function(){var f=function(f){return f};runtime.getTranslator=function(){return f};runtime.setTranslator=function(h){f=h};runtime.tr=function(h){var d=f(h);return d&&"string"===String(typeof d)?d:h}})();
(function(f){function h(d){if(d.length){var c=d[0];runtime.readFile(c,"utf8",function(e,f){function g(){var c;(c=eval(r))&&runtime.exit(c)}var h="",h=c.lastIndexOf("/"),r=f,h=-1!==h?c.substring(0,h):".";runtime.setCurrentDirectory(h);e?(runtime.log(e),runtime.exit(1)):null===r?(runtime.log("No code found for "+c),runtime.exit(1)):g.apply(null,d)})}}f=f?Array.prototype.slice.call(f):[];"NodeJSRuntime"===runtime.type()?h(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?h(f):h(f.slice(1))})("undefined"!==
String(typeof arguments)&&arguments);(function(){core.Async=function(){return{forEach:function(f,h,d){function c(c){g!==m&&(c?(g=m,d(c)):(g+=1,g===m&&d(null)))}var e,m=f.length,g=0;for(e=0;e<m;e+=1)h(f[e],c)},destroyAll:function(f,h){function d(c,e){if(e)h(e);else if(c<f.length)f[c](function(e){d(c+1,e)});else h()}d(0,void 0)}}}()})();function makeBase64(){function f(a){var b,l=a.length,k=new Uint8Array(new ArrayBuffer(l));for(b=0;b<l;b+=1)k[b]=a.charCodeAt(b)&255;return k}function h(a){var b,l="",k,c=a.length-2;for(k=0;k<c;k+=3)b=a[k]<<16|a[k+1]<<8|a[k+2],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>18],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>12&63],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>6&63],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b&
63];k===c+1?(b=a[k]<<4,l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>6],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b&63],l+="=="):k===c&&(b=a[k]<<10|a[k+1]<<2,l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>12],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b>>>6&63],l+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[b&63],l+="=");return l}function d(a){a=a.replace(/[^A-Za-z0-9+\/]+/g,
"");var b=a.length,l=new Uint8Array(new ArrayBuffer(3*b)),c=a.length%4,d=0,e,g;for(e=0;e<b;e+=4)g=(k[a.charAt(e)]||0)<<18|(k[a.charAt(e+1)]||0)<<12|(k[a.charAt(e+2)]||0)<<6|(k[a.charAt(e+3)]||0),l[d]=g>>16,l[d+1]=g>>8&255,l[d+2]=g&255,d+=3;b=3*b-[0,0,2,1][c];return l.subarray(0,b)}function c(a){var b,l,k=a.length,c=0,d=new Uint8Array(new ArrayBuffer(3*k));for(b=0;b<k;b+=1)l=a[b],128>l?d[c++]=l:(2048>l?d[c++]=192|l>>>6:(d[c++]=224|l>>>12&15,d[c++]=128|l>>>6&63),d[c++]=128|l&63);return d.subarray(0,
c)}function e(a){var b,l,k,c,d=a.length,e=new Uint8Array(new ArrayBuffer(d)),g=0;for(b=0;b<d;b+=1)l=a[b],128>l?e[g++]=l:(b+=1,k=a[b],224>l?e[g++]=(l&31)<<6|k&63:(b+=1,c=a[b],e[g++]=(l&15)<<12|(k&63)<<6|c&63));return e.subarray(0,g)}function m(a){return h(f(a))}function g(a){return String.fromCharCode.apply(String,d(a))}function p(a){return e(f(a))}function r(a){a=e(a);for(var b="",l=0;l<a.length;)b+=String.fromCharCode.apply(String,a.subarray(l,l+45E3)),l+=45E3;return b}function n(a,b,l){var k,c,
d,e="";for(d=b;d<l;d+=1)b=a.charCodeAt(d)&255,128>b?e+=String.fromCharCode(b):(d+=1,k=a.charCodeAt(d)&255,224>b?e+=String.fromCharCode((b&31)<<6|k&63):(d+=1,c=a.charCodeAt(d)&255,e+=String.fromCharCode((b&15)<<12|(k&63)<<6|c&63)));return e}function q(a,b){function l(){var d=c+1E5;d>a.length&&(d=a.length);k+=n(a,c,d);c=d;d=c===a.length;b(k,d)&&!d&&runtime.setTimeout(l,0)}var k="",c=0;1E5>a.length?b(n(a,0,a.length),!0):("string"!==typeof a&&(a=a.slice()),l())}function b(a){return c(f(a))}function a(a){return String.fromCharCode.apply(String,
c(a))}function l(a){return String.fromCharCode.apply(String,c(f(a)))}var k=function(a){var b={},l,k;l=0;for(k=a.length;l<k;l+=1)b[a.charAt(l)]=l;return b}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),t,s,w=runtime.getWindow(),x,v;w&&w.btoa?(x=w.btoa,t=function(a){return x(l(a))}):(x=m,t=function(a){return h(b(a))});w&&w.atob?(v=w.atob,s=function(a){a=v(a);return n(a,0,a.length)}):(v=g,s=function(a){return r(d(a))});core.Base64=function(){this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=
h;this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=d;this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=c;this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=e;this.convertUTF8StringToBase64=m;this.convertBase64ToUTF8String=g;this.convertUTF8StringToUTF16Array=p;this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=r;this.convertUTF8StringToUTF16String=q;this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=b;this.convertUTF16ArrayToUTF8String=
a;this.convertUTF16StringToUTF8String=l;this.convertUTF16StringToBase64=t;this.convertBase64ToUTF16String=s;this.fromBase64=g;this.toBase64=m;this.atob=v;this.btoa=x;this.utob=l;this.btou=q;this.encode=t;this.encodeURI=function(a){return t(a).replace(/[+\/]/g,function(a){return"+"===a?"-":"_"}).replace(/\\=+$/,"")};this.decode=function(a){return s(a.replace(/[\-_]/g,function(a){return"-"===a?"+":"/"}))};return this};return core.Base64}core.Base64=makeBase64();core.ByteArray=function(f){this.pos=0;this.data=f;this.readUInt32LE=function(){this.pos+=4;var f=this.data,d=this.pos;return f[--d]<<24|f[--d]<<16|f[--d]<<8|f[--d]};this.readUInt16LE=function(){this.pos+=2;var f=this.data,d=this.pos;return f[--d]<<8|f[--d]}};core.ByteArrayWriter=function(f){function h(d){d>e-c&&(e=Math.max(2*e,c+d),d=new Uint8Array(new ArrayBuffer(e)),d.set(m),m=d)}var d=this,c=0,e=1024,m=new Uint8Array(new ArrayBuffer(e));this.appendByteArrayWriter=function(c){d.appendByteArray(c.getByteArray())};this.appendByteArray=function(d){var e=d.length;h(e);m.set(d,c);c+=e};this.appendArray=function(d){var e=d.length;h(e);m.set(d,c);c+=e};this.appendUInt16LE=function(c){d.appendArray([c&255,c>>8&255])};this.appendUInt32LE=function(c){d.appendArray([c&
255,c>>8&255,c>>16&255,c>>24&255])};this.appendString=function(c){d.appendByteArray(runtime.byteArrayFromString(c,f))};this.getLength=function(){return c};this.getByteArray=function(){var d=new Uint8Array(new ArrayBuffer(c));d.set(m.subarray(0,c));return d}};core.CSSUnits=function(){var f=this,h={"in":1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(d,c,e){return d*h[e]/h[c]};this.convertMeasure=function(d,c){var e,h;d&&c&&(e=parseFloat(d),h=d.replace(e.toString(),""),e=f.convert(e,h,c));return e};this.getUnits=function(d){return d.substr(d.length-2,d.length)}};(function(){function f(){var c,e,f,g,h,r,n,q,b;void 0===d&&(e=(c=runtime.getWindow())&&c.document,r=e.documentElement,n=e.body,d={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},e&&(g=e.createElement("div"),g.style.position="absolute",g.style.left="-99999px",g.style.transform="scale(2)",g.style["-webkit-transform"]="scale(2)",h=e.createElement("div"),g.appendChild(h),n.appendChild(g),c=e.createRange(),c.selectNode(h),d.rangeBCRIgnoresElementBCR=0===c.getClientRects().length,
h.appendChild(e.createTextNode("Rect transform test")),e=h.getBoundingClientRect(),f=c.getBoundingClientRect(),d.unscaledRangeClientRects=2<Math.abs(e.height-f.height),g.style.transform="",g.style["-webkit-transform"]="",e=r.style.overflow,f=n.style.overflow,q=n.style.height,b=n.scrollTop,r.style.overflow="visible",n.style.overflow="visible",n.style.height="200%",n.scrollTop=n.scrollHeight,d.elementBCRIgnoresBodyScroll=c.getBoundingClientRect().top!==h.getBoundingClientRect().top,n.scrollTop=b,n.style.height=
q,n.style.overflow=f,r.style.overflow=e,c.detach(),n.removeChild(g),c=Object.keys(d).map(function(a){return a+":"+String(d[a])}).join(", "),runtime.log("Detected browser quirks - "+c)));return d}function h(c,d,f){for(c=c?c.firstElementChild:null;c;){if(c.localName===f&&c.namespaceURI===d)return c;c=c.nextElementSibling}return null}var d;core.DomUtils=function(){function c(a,b){for(var c=0,d;a.parentNode!==b;)runtime.assert(null!==a.parentNode,"parent is null"),a=a.parentNode;for(d=b.firstChild;d!==
a;)c+=1,d=d.nextSibling;return c}function d(a,b){return 0>=a.compareBoundaryPoints(Range.START_TO_START,b)&&0<=a.compareBoundaryPoints(Range.END_TO_END,b)}function m(a,b){return 0>=a.compareBoundaryPoints(Range.END_TO_START,b)&&0<=a.compareBoundaryPoints(Range.START_TO_END,b)}function g(a,b){var c=null;a.nodeType===Node.TEXT_NODE&&(0===a.length?(a.parentNode.removeChild(a),b.nodeType===Node.TEXT_NODE&&(c=b)):(b.nodeType===Node.TEXT_NODE&&(a.appendData(b.data),b.parentNode.removeChild(b)),c=a));return c}
function p(a){for(var b=a.parentNode;a.firstChild;)b.insertBefore(a.firstChild,a);b.removeChild(a);return b}function r(a,b){for(var c=a.parentNode,d=a.firstChild,e;d;)e=d.nextSibling,r(d,b),d=e;c&&b(a)&&p(a);return c}function n(a,b){return a===b||Boolean(a.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function q(a,b){return f().unscaledRangeClientRects?a:a/b}function b(a,k,c){Object.keys(k).forEach(function(d){var e=d.split(":"),g=e[1],f=c(e[0]),e=k[d],h=typeof e;"object"===h?Object.keys(e).length&&
(d=f?a.getElementsByTagNameNS(f,g)[0]||a.ownerDocument.createElementNS(f,d):a.getElementsByTagName(g)[0]||a.ownerDocument.createElement(d),a.appendChild(d),b(d,e,c)):f&&(runtime.assert("number"===h||"string"===h,"attempting to map unsupported type '"+h+"' (key: "+d+")"),a.setAttributeNS(f,d,String(e)))})}var a=null;this.splitBoundaries=function(a){var b,d=[],e,f,g;if(a.startContainer.nodeType===Node.TEXT_NODE||a.endContainer.nodeType===Node.TEXT_NODE){e=a.endContainer;f=a.endContainer.nodeType!==
Node.TEXT_NODE?a.endOffset===a.endContainer.childNodes.length:!1;g=a.endOffset;b=a.endContainer;if(g<b.childNodes.length)for(b=b.childNodes.item(g),g=0;b.firstChild;)b=b.firstChild;else for(;b.lastChild;)b=b.lastChild,g=b.nodeType===Node.TEXT_NODE?b.textContent.length:b.childNodes.length;b===e&&(e=null);a.setEnd(b,g);g=a.endContainer;0!==a.endOffset&&g.nodeType===Node.TEXT_NODE&&(b=g,a.endOffset!==b.length&&(d.push(b.splitText(a.endOffset)),d.push(b)));g=a.startContainer;0!==a.startOffset&&g.nodeType===
Node.TEXT_NODE&&(b=g,a.startOffset!==b.length&&(g=b.splitText(a.startOffset),d.push(b),d.push(g),a.setStart(g,0)));if(null!==e){for(g=a.endContainer;g.parentNode&&g.parentNode!==e;)g=g.parentNode;f=f?e.childNodes.length:c(g,e);a.setEnd(e,f)}}return d};this.containsRange=d;this.rangesIntersect=m;this.rangeIntersection=function(a,b){var c;m(a,b)&&(c=a.cloneRange(),-1===a.compareBoundaryPoints(Range.START_TO_START,b)&&c.setStart(b.startContainer,b.startOffset),1===a.compareBoundaryPoints(Range.END_TO_END,
b)&&c.setEnd(b.endContainer,b.endOffset));return c};this.getNodesInRange=function(a,b,c){var d=[],e=a.commonAncestorContainer,e=e.nodeType===Node.TEXT_NODE?e.parentNode:e;c=a.startContainer.ownerDocument.createTreeWalker(e,c,b,!1);var g,f;a.endContainer.childNodes[a.endOffset-1]?(g=a.endContainer.childNodes[a.endOffset-1],f=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(g=a.endContainer,f=Node.DOCUMENT_POSITION_PRECEDING);a.startContainer.childNodes[a.startOffset]?(a=a.startContainer.childNodes[a.startOffset],
c.currentNode=a):a.startOffset===(a.startContainer.nodeType===Node.TEXT_NODE?a.startContainer.length:a.startContainer.childNodes.length)?(a=a.startContainer,c.currentNode=a,c.lastChild(),a=c.nextNode()):(a=a.startContainer,c.currentNode=a);if(a){a=c.currentNode;if(a!==e)for(a=a.parentNode;a&&a!==e;)b(a)===NodeFilter.FILTER_REJECT&&(c.currentNode=a),a=a.parentNode;a=c.currentNode;switch(b(a)){case NodeFilter.FILTER_REJECT:for(a=c.nextSibling();!a&&c.parentNode();)a=c.nextSibling();break;case NodeFilter.FILTER_SKIP:a=
c.nextNode()}for(;a;){b=g.compareDocumentPosition(a);if(0!==b&&0===(b&f))break;d.push(a);a=c.nextNode()}}return d};this.normalizeTextNodes=function(a){a&&a.nextSibling&&(a=g(a,a.nextSibling));a&&a.previousSibling&&g(a.previousSibling,a)};this.rangeContainsNode=function(a,b){var c=b.ownerDocument.createRange(),g=b.ownerDocument.createRange(),f;c.setStart(a.startContainer,a.startOffset);c.setEnd(a.endContainer,a.endOffset);g.selectNodeContents(b);f=d(c,g);c.detach();g.detach();return f};this.mergeIntoParent=
p;this.removeUnwantedNodes=r;this.getElementsByTagNameNS=function(a,b,c){var d=[];a=a.getElementsByTagNameNS(b,c);d.length=c=a.length;for(b=0;b<c;b+=1)d[b]=a.item(b);return d};this.getElementsByTagName=function(a,b){var c=[],d,e,g;d=a.getElementsByTagName(b);c.length=g=d.length;for(e=0;e<g;e+=1)c[e]=d.item(e);return c};this.containsNode=function(a,b){return a===b||a.contains(b)};this.comparePoints=function(a,b,d,e){if(a===d)return e-b;var g=a.compareDocumentPosition(d);2===g?g=-1:4===g?g=1:10===g?
(b=c(a,d),g=b<e?1:-1):(e=c(d,a),g=e<b?-1:1);return g};this.adaptRangeDifferenceToZoomLevel=q;this.translateRect=function(a,b,c){return{top:q(a.top-b.top,c),left:q(a.left-b.left,c),bottom:q(a.bottom-b.top,c),right:q(a.right-b.left,c),width:q(a.width,c),height:q(a.height,c)}};this.getBoundingClientRect=function(b){var c=b.ownerDocument,d=f(),e=c.body;if((!1===d.unscaledRangeClientRects||d.rangeBCRIgnoresElementBCR)&&b.nodeType===Node.ELEMENT_NODE)return b=b.getBoundingClientRect(),d.elementBCRIgnoresBodyScroll?
{left:b.left+e.scrollLeft,right:b.right+e.scrollLeft,top:b.top+e.scrollTop,bottom:b.bottom+e.scrollTop,width:b.width,height:b.height}:b;var g;a?g=a:a=g=c.createRange();d=g;d.selectNode(b);return d.getBoundingClientRect()};this.mapKeyValObjOntoNode=function(a,b,c){Object.keys(b).forEach(function(d){var e=d.split(":"),g=e[1],e=c(e[0]),f=b[d];e?(g=a.getElementsByTagNameNS(e,g)[0],g||(g=a.ownerDocument.createElementNS(e,d),a.appendChild(g)),g.textContent=f):runtime.log("Key ignored: "+d)})};this.removeKeyElementsFromNode=
function(a,b,c){b.forEach(function(b){var d=b.split(":"),k=d[1];(d=c(d[0]))?(k=a.getElementsByTagNameNS(d,k)[0])?k.parentNode.removeChild(k):runtime.log("Element for "+b+" not found."):runtime.log("Property Name ignored: "+b)})};this.getKeyValRepresentationOfNode=function(a,b){for(var c={},d=a.firstElementChild,e;d;){if(e=b(d.namespaceURI))c[e+":"+d.localName]=d.textContent;d=d.nextElementSibling}return c};this.mapObjOntoNode=b;this.getDirectChild=h;(function(a){var b,c;c=runtime.getWindow();null!==
c&&(b=c.navigator.appVersion.toLowerCase(),c=-1===b.indexOf("chrome")&&(-1!==b.indexOf("applewebkit")||-1!==b.indexOf("safari")),b=b.indexOf("msie"),c||b)&&(a.containsNode=n)})(this)}})();core.Cursor=function(f,h){function d(b){b.parentNode&&(p.push(b.previousSibling),p.push(b.nextSibling),b.parentNode.removeChild(b))}function c(b,a,c){if(a.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(a),"putCursorIntoTextNode: invalid container");var d=a.parentNode;runtime.assert(Boolean(d),"putCursorIntoTextNode: container without parent");runtime.assert(0<=c&&c<=a.length,"putCursorIntoTextNode: offset is out of bounds");0===c?d.insertBefore(b,a):(c!==a.length&&a.splitText(c),d.insertBefore(b,
a.nextSibling))}else a.nodeType===Node.ELEMENT_NODE&&a.insertBefore(b,a.childNodes.item(c));p.push(b.previousSibling);p.push(b.nextSibling)}var e=f.createElementNS("urn:webodf:names:cursor","cursor"),m=f.createElementNS("urn:webodf:names:cursor","anchor"),g,p=[],r=f.createRange(),n,q=new core.DomUtils;this.getNode=function(){return e};this.getAnchorNode=function(){return m.parentNode?m:e};this.getSelectedRange=function(){n?(r.setStartBefore(e),r.collapse(!0)):(r.setStartAfter(g?m:e),r.setEndBefore(g?
e:m));return r};this.setSelectedRange=function(b,a){r&&r!==b&&r.detach();r=b;g=!1!==a;(n=b.collapsed)?(d(m),d(e),c(e,b.startContainer,b.startOffset)):(d(m),d(e),c(g?e:m,b.endContainer,b.endOffset),c(g?m:e,b.startContainer,b.startOffset));p.forEach(q.normalizeTextNodes);p.length=0};this.hasForwardSelection=function(){return g};this.remove=function(){d(e);p.forEach(q.normalizeTextNodes);p.length=0};e.setAttributeNS("urn:webodf:names:cursor","memberId",h);m.setAttributeNS("urn:webodf:names:cursor","memberId",
h)};core.Destroyable=function(){};core.Destroyable.prototype.destroy=function(f){};core.EventNotifier=function(f){function h(c){runtime.assert(!d.hasOwnProperty(c),'Duplicated event ids: "'+c+'" registered more than once.');d[c]=[]}var d={};this.emit=function(c,e){var f,g;runtime.assert(d.hasOwnProperty(c),'unknown event fired "'+c+'"');g=d[c];for(f=0;f<g.length;f+=1)g[f](e)};this.subscribe=function(c,e){runtime.assert(d.hasOwnProperty(c),'tried to subscribe to unknown event "'+c+'"');d[c].push(e)};this.unsubscribe=function(c,e){var f;runtime.assert(d.hasOwnProperty(c),'tried to unsubscribe from unknown event "'+
c+'"');f=d[c].indexOf(e);runtime.assert(-1!==f,'tried to unsubscribe unknown callback from event "'+c+'"');-1!==f&&d[c].splice(f,1)};this.register=h;f&&f.forEach(h)};core.LazyProperty=function(f){var h,d=!1;this.value=function(){d||(h=f(),d=!0);return h};this.reset=function(){d=!1}};core.LoopWatchDog=function(f,h){var d=Date.now(),c=0;this.check=function(){var e;if(f&&(e=Date.now(),e-d>f))throw runtime.log("alert","watchdog timeout"),"timeout!";if(0<h&&(c+=1,c>h))throw runtime.log("alert","watchdog loop overflow"),"loop overflow";}};core.PositionIterator=function(f,h,d,c){function e(){this.acceptNode=function(a){return!a||a.nodeType===l&&0===a.length?s:t}}function m(a){this.acceptNode=function(b){return!b||b.nodeType===l&&0===b.length?s:a.acceptNode(b)}}function g(){var a=q.currentNode,c=a.nodeType;b=c===l?a.length-1:c===k?1:0}function p(){if(null===q.previousSibling()){if(!q.parentNode()||q.currentNode===f)return q.firstChild(),!1;b=0}else g();return!0}function r(){var c=q.currentNode,d;d=a(c);if(c!==f)for(c=c.parentNode;c&&
c!==f;)a(c)===s&&(q.currentNode=c,d=s),c=c.parentNode;d===s?(b=1,c=n.nextPosition()):c=d===t?!0:n.nextPosition();c&&runtime.assert(a(q.currentNode)===t,"moveToAcceptedNode did not result in walker being on an accepted node");return c}var n=this,q,b,a,l=Node.TEXT_NODE,k=Node.ELEMENT_NODE,t=NodeFilter.FILTER_ACCEPT,s=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var a=q.currentNode,c=a.nodeType;if(a===f)return!1;if(0===b&&c===k)null===q.firstChild()&&(b=1);else if(c===l&&b+1<a.length)b+=1;else if(null!==
q.nextSibling())b=0;else if(q.parentNode())b=1;else return!1;return!0};this.previousPosition=function(){var a=!0,c=q.currentNode;0===b?a=p():c.nodeType===l?b-=1:null!==q.lastChild()?g():c===f?a=!1:b=0;return a};this.previousNode=p;this.container=function(){var a=q.currentNode,c=a.nodeType;0===b&&c!==l&&(a=a.parentNode);return a};this.rightNode=function(){var c=q.currentNode,d=c.nodeType;if(d===l&&b===c.length)for(c=c.nextSibling;c&&a(c)!==t;)c=c.nextSibling;else d===k&&1===b&&(c=null);return c};this.leftNode=
function(){var c=q.currentNode;if(0===b)for(c=c.previousSibling;c&&a(c)!==t;)c=c.previousSibling;else if(c.nodeType===k)for(c=c.lastChild;c&&a(c)!==t;)c=c.previousSibling;return c};this.getCurrentNode=function(){return q.currentNode};this.unfilteredDomOffset=function(){if(q.currentNode.nodeType===l)return b;for(var a=0,c=q.currentNode,c=1===b?c.lastChild:c.previousSibling;c;)a+=1,c=c.previousSibling;return a};this.getPreviousSibling=function(){var a=q.currentNode,b=q.previousSibling();q.currentNode=
a;return b};this.getNextSibling=function(){var a=q.currentNode,b=q.nextSibling();q.currentNode=a;return b};this.setPositionBeforeElement=function(a){runtime.assert(Boolean(a),"setPositionBeforeElement called without element");q.currentNode=a;b=0;return r()};this.setUnfilteredPosition=function(a,c){runtime.assert(Boolean(a),"PositionIterator.setUnfilteredPosition called without container");q.currentNode=a;if(a.nodeType===l)return b=c,runtime.assert(c<=a.length,"Error in setPosition: "+c+" > "+a.length),
runtime.assert(0<=c,"Error in setPosition: "+c+" < 0"),c===a.length&&(q.nextSibling()?b=0:q.parentNode()?b=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid.")),!0;c<a.childNodes.length?(q.currentNode=a.childNodes.item(c),b=0):b=1;return r()};this.moveToEnd=function(){q.currentNode=f;b=1};this.moveToEndOfNode=function(a){a.nodeType===l?n.setUnfilteredPosition(a,a.length):(q.currentNode=a,b=1)};this.isBeforeNode=function(){return 0===b};this.getNodeFilter=function(){return a};
a=(d?new m(d):new e).acceptNode;a.acceptNode=a;h=h||NodeFilter.SHOW_ALL;runtime.assert(f.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes");q=f.ownerDocument.createTreeWalker(f,h,a,c);b=0;null===q.firstChild()&&(b=1)};core.PositionFilter=function(){};core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3};core.PositionFilter.prototype.acceptPosition=function(f){};core.PositionFilterChain=function(){var f=[],h=core.PositionFilter.FilterResult.FILTER_ACCEPT,d=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(c){var e;for(e=0;e<f.length;e+=1)if(f[e].acceptPosition(c)===d)return d;return h};this.addFilter=function(c){f.push(c)}};core.zip_HuftNode=function(){this.n=this.b=this.e=0;this.t=null};core.zip_HuftList=function(){this.list=this.next=null};
core.RawInflate=function(){function f(a,b,c,d,k,l){this.BMAX=16;this.N_MAX=288;this.status=0;this.root=null;this.m=0;var e=Array(this.BMAX+1),g,f,h,m,q,A,n,t=Array(this.BMAX+1),p,U,J,r=new core.zip_HuftNode,s=Array(this.BMAX);m=Array(this.N_MAX);var K,u=Array(this.BMAX+1),W,H,w;w=this.root=null;for(q=0;q<e.length;q++)e[q]=0;for(q=0;q<t.length;q++)t[q]=0;for(q=0;q<s.length;q++)s[q]=null;for(q=0;q<m.length;q++)m[q]=0;for(q=0;q<u.length;q++)u[q]=0;g=256<b?a[256]:this.BMAX;p=a;U=0;q=b;do e[p[U]]++,U++;
while(0<--q);if(e[0]===b)this.root=null,this.status=this.m=0;else{for(A=1;A<=this.BMAX&&0===e[A];A++);n=A;l<A&&(l=A);for(q=this.BMAX;0!==q&&0===e[q];q--);h=q;l>q&&(l=q);for(W=1<<A;A<q;A++,W<<=1)if(W-=e[A],0>W){this.status=2;this.m=l;return}W-=e[q];if(0>W)this.status=2,this.m=l;else{e[q]+=W;u[1]=A=0;p=e;U=1;for(J=2;0<--q;)A+=p[U++],u[J++]=A;p=a;q=U=0;do A=p[U++],0!==A&&(m[u[A]++]=q);while(++q<b);b=u[h];u[0]=q=0;p=m;U=0;m=-1;K=t[0]=0;J=null;H=0;for(n=n-1+1;n<=h;n++)for(a=e[n];0<a--;){for(;n>K+t[1+m];){K+=
t[1+m];m++;H=h-K;H=H>l?l:H;A=n-K;f=1<<A;if(f>a+1)for(f-=a+1,J=n;++A<H;){f<<=1;if(f<=e[++J])break;f-=e[J]}K+A>g&&K<g&&(A=g-K);H=1<<A;t[1+m]=A;J=Array(H);for(f=0;f<H;f++)J[f]=new core.zip_HuftNode;w=null===w?this.root=new core.zip_HuftList:w.next=new core.zip_HuftList;w.next=null;w.list=J;s[m]=J;0<m&&(u[m]=q,r.b=t[m],r.e=16+A,r.t=J,A=(q&(1<<K)-1)>>K-t[m],s[m-1][A].e=r.e,s[m-1][A].b=r.b,s[m-1][A].n=r.n,s[m-1][A].t=r.t)}r.b=n-K;U>=b?r.e=99:p[U]<c?(r.e=256>p[U]?16:15,r.n=p[U++]):(r.e=k[p[U]-c],r.n=d[p[U++]-
c]);f=1<<n-K;for(A=q>>K;A<H;A+=f)J[A].e=r.e,J[A].b=r.b,J[A].n=r.n,J[A].t=r.t;for(A=1<<n-1;0!==(q&A);A>>=1)q^=A;for(q^=A;(q&(1<<K)-1)!==u[m];)K-=t[m],m--}this.m=t[1];this.status=0!==W&&1!==h?1:0}}}function h(c){for(;a<c;){var d=b,k;k=u.length===C?-1:u[C++];b=d|k<<a;a+=8}}function d(a){return b&I[a]}function c(c){b>>=c;a-=c}function e(a,b,k){var e,f,q;if(0===k)return 0;for(q=0;;){h(v);f=w.list[d(v)];for(e=f.e;16<e;){if(99===e)return-1;c(f.b);e-=16;h(e);f=f.t[d(e)];e=f.e}c(f.b);if(16===e)p&=32767,a[b+
q++]=g[p++]=f.n;else{if(15===e)break;h(e);t=f.n+d(e);c(e);h(z);f=x.list[d(z)];for(e=f.e;16<e;){if(99===e)return-1;c(f.b);e-=16;h(e);f=f.t[d(e)];e=f.e}c(f.b);h(e);s=p-f.n-d(e);for(c(e);0<t&&q<k;)t--,s&=32767,p&=32767,a[b+q++]=g[p++]=g[s++]}if(q===k)return k}l=-1;return q}function m(a,b,k){var l,g,q,m,n,t,p,r=Array(316);for(l=0;l<r.length;l++)r[l]=0;h(5);t=257+d(5);c(5);h(5);p=1+d(5);c(5);h(4);l=4+d(4);c(4);if(286<t||30<p)return-1;for(g=0;g<l;g++)h(3),r[U[g]]=d(3),c(3);for(g=l;19>g;g++)r[U[g]]=0;v=
7;g=new f(r,19,19,null,null,v);if(0!==g.status)return-1;w=g.root;v=g.m;m=t+p;for(l=q=0;l<m;)if(h(v),n=w.list[d(v)],g=n.b,c(g),g=n.n,16>g)r[l++]=q=g;else if(16===g){h(2);g=3+d(2);c(2);if(l+g>m)return-1;for(;0<g--;)r[l++]=q}else{17===g?(h(3),g=3+d(3),c(3)):(h(7),g=11+d(7),c(7));if(l+g>m)return-1;for(;0<g--;)r[l++]=0;q=0}v=9;g=new f(r,t,257,A,K,v);0===v&&(g.status=1);if(0!==g.status)return-1;w=g.root;v=g.m;for(l=0;l<p;l++)r[l]=r[l+t];z=6;g=new f(r,p,0,J,H,z);x=g.root;z=g.m;return 0===z&&257<t||0!==g.status?
-1:e(a,b,k)}var g=[],p,r=null,n,q,b,a,l,k,t,s,w,x,v,z,u,C,I=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],A=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],K=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],J=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],H=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],U=[16,17,18,0,8,7,9,6,
10,5,11,4,12,3,13,2,14,1,15],W;this.inflate=function(U,I){g.length=65536;a=b=p=0;l=-1;k=!1;t=s=0;w=null;u=U;C=0;var O=new Uint8Array(new ArrayBuffer(I));a:for(var B=0,X;B<I&&(!k||-1!==l);){if(0<t){if(0!==l)for(;0<t&&B<I;)t--,s&=32767,p&=32767,O[0+B]=g[p]=g[s],B+=1,p+=1,s+=1;else{for(;0<t&&B<I;)t-=1,p&=32767,h(8),O[0+B]=g[p]=d(8),B+=1,p+=1,c(8);0===t&&(l=-1)}if(B===I)break}if(-1===l){if(k)break;h(1);0!==d(1)&&(k=!0);c(1);h(2);l=d(2);c(2);w=null;t=0}switch(l){case 0:X=O;var ga=0+B,ca=I-B,Z=void 0,Z=
a&7;c(Z);h(16);Z=d(16);c(16);h(16);if(Z!==(~b&65535))X=-1;else{c(16);t=Z;for(Z=0;0<t&&Z<ca;)t--,p&=32767,h(8),X[ga+Z++]=g[p++]=d(8),c(8);0===t&&(l=-1);X=Z}break;case 1:if(null!==w)X=e(O,0+B,I-B);else b:{X=O;ga=0+B;ca=I-B;if(null===r){for(var D=void 0,Z=Array(288),D=void 0,D=0;144>D;D++)Z[D]=8;for(D=144;256>D;D++)Z[D]=9;for(D=256;280>D;D++)Z[D]=7;for(D=280;288>D;D++)Z[D]=8;q=7;D=new f(Z,288,257,A,K,q);if(0!==D.status){alert("HufBuild error: "+D.status);X=-1;break b}r=D.root;q=D.m;for(D=0;30>D;D++)Z[D]=
5;W=5;D=new f(Z,30,0,J,H,W);if(1<D.status){r=null;alert("HufBuild error: "+D.status);X=-1;break b}n=D.root;W=D.m}w=r;x=n;v=q;z=W;X=e(X,ga,ca)}break;case 2:X=null!==w?e(O,0+B,I-B):m(O,0+B,I-B);break;default:X=-1}if(-1===X)break a;B+=X}u=new Uint8Array(new ArrayBuffer(0));return O}};core.ScheduledTask=function(f,h,d){function c(){g&&(d(m),g=!1)}function e(){c();f.apply(void 0,p);p=null}var m,g=!1,p=[],r=!1;this.trigger=function(){runtime.assert(!1===r,"Can't trigger destroyed ScheduledTask instance");p=Array.prototype.slice.call(arguments);g||(g=!0,m=h(e))};this.triggerImmediate=function(){runtime.assert(!1===r,"Can't trigger destroyed ScheduledTask instance");p=Array.prototype.slice.call(arguments);e()};this.processRequests=function(){g&&e()};this.cancel=c;this.destroy=function(d){c();
r=!0;d()}};core.StepDirection={PREVIOUS:1,NEXT:2};core.StepIterator=function(f,h){function d(){q=null;a=b=void 0}function c(){void 0===a&&(a=f.acceptPosition(h)===n);return a}function e(a,b){d();return h.setUnfilteredPosition(a,b)}function m(){q||(q=h.container());return q}function g(){void 0===b&&(b=h.unfilteredDomOffset());return b}function p(){for(d();h.nextPosition();)if(d(),c())return!0;return!1}function r(){for(d();h.previousPosition();)if(d(),c())return!0;return!1}var n=core.PositionFilter.FilterResult.FILTER_ACCEPT,q,b,a;this.isStep=c;this.setPosition=
e;this.container=m;this.offset=g;this.nextStep=p;this.previousStep=r;this.advanceStep=function(a){return a===core.StepDirection.NEXT?p():r()};this.roundToClosestStep=function(){var a,b,d=c();d||(a=m(),b=g(),d=r(),d||(e(a,b),d=p()));return d};this.roundToPreviousStep=function(){var a=c();a||(a=r());return a};this.roundToNextStep=function(){var a=c();a||(a=p());return a};this.leftNode=function(){return h.leftNode()}};(function(){var f;core.Task={};core.Task.SUPPRESS_MANUAL_PROCESSING=!1;core.Task.processTasks=function(){core.Task.SUPPRESS_MANUAL_PROCESSING||f.performRedraw()};core.Task.createRedrawTask=function(h){return new core.ScheduledTask(h,f.requestRedrawTask,f.cancelRedrawTask)};core.Task.createTimeoutTask=function(f,d){return new core.ScheduledTask(f,function(c){return runtime.setTimeout(c,d)},runtime.clearTimeout)};f=new function(){var f={};this.requestRedrawTask=function(d){var c=runtime.requestAnimationFrame(function(){d();
delete f[c]});f[c]=d;return c};this.performRedraw=function(){Object.keys(f).forEach(function(d){f[d]();runtime.cancelAnimationFrame(parseInt(d,10))});f={}};this.cancelRedrawTask=function(d){runtime.cancelAnimationFrame(d);delete f[d]}}})();core.UnitTest=function(){};core.UnitTest.prototype.setUp=function(){};core.UnitTest.prototype.tearDown=function(){};core.UnitTest.prototype.description=function(){};core.UnitTest.prototype.tests=function(){};core.UnitTest.prototype.asyncTests=function(){};
core.UnitTest.provideTestAreaDiv=function(){var f=runtime.getWindow().document,h=f.getElementById("testarea");runtime.assert(!h,'Unclean test environment, found a div with id "testarea".');h=f.createElement("div");h.setAttribute("id","testarea");f.body.appendChild(h);return h};
core.UnitTest.cleanupTestAreaDiv=function(){var f=runtime.getWindow().document,h=f.getElementById("testarea");runtime.assert(!!h&&h.parentNode===f.body,'Test environment broken, found no div with id "testarea" below body.');f.body.removeChild(h)};core.UnitTest.createXmlDocument=function(f,h,d){var c="<?xml version='1.0' encoding='UTF-8'?>",c=c+("<"+f);Object.keys(d).forEach(function(e){c+=" xmlns:"+e+'="'+d[e]+'"'});c+=">";c+=h;c+="</"+f+">";return runtime.parseXML(c)};
core.UnitTest.createOdtDocument=function(f,h){return core.UnitTest.createXmlDocument("office:document",f,h)};
core.UnitTestLogger=function(){var f=[],h=0,d=0,c="",e="";this.startTest=function(m,g){f=[];h=0;c=m;e=g;d=Date.now()};this.endTest=function(){var m=Date.now();return{description:e,suite:[c,e],success:0===h,log:f,time:m-d}};this.debug=function(c){f.push({category:"debug",message:c})};this.fail=function(c){h+=1;f.push({category:"fail",message:c})};this.pass=function(c){f.push({category:"pass",message:c})}};
core.UnitTestRunner=function(f,h){function d(a){r+=1;b?h.debug(a):h.fail(a)}function c(a,b){var c;try{if(a.length!==b.length)return d("array of length "+a.length+" should be "+b.length+" long"),!1;for(c=0;c<a.length;c+=1)if(a[c]!==b[c])return d(a[c]+" should be "+b[c]+" at array index "+c),!1}catch(e){return!1}return!0}function e(a,b,c){var g=a.attributes,f=g.length,h,q,m;for(h=0;h<f;h+=1)if(q=g.item(h),"xmlns"!==q.prefix&&"urn:webodf:names:steps"!==q.namespaceURI){m=b.getAttributeNS(q.namespaceURI,
q.localName);if(!b.hasAttributeNS(q.namespaceURI,q.localName))return d("Attribute "+q.localName+" with value "+q.value+" was not present"),!1;if(m!==q.value)return d("Attribute "+q.localName+" was "+m+" should be "+q.value),!1}return c?!0:e(b,a,!0)}function m(a,b){var c,g;c=a.nodeType;g=b.nodeType;if(c!==g)return d("Nodetype '"+c+"' should be '"+g+"'"),!1;if(c===Node.TEXT_NODE){if(a.data===b.data)return!0;d("Textnode data '"+a.data+"' should be '"+b.data+"'");return!1}runtime.assert(c===Node.ELEMENT_NODE,
"Only textnodes and elements supported.");if(a.namespaceURI!==b.namespaceURI)return d("namespace '"+a.namespaceURI+"' should be '"+b.namespaceURI+"'"),!1;if(a.localName!==b.localName)return d("localName '"+a.localName+"' should be '"+b.localName+"'"),!1;if(!e(a,b,!1))return!1;c=a.firstChild;for(g=b.firstChild;c;){if(!g)return d("Nodetype '"+c.nodeType+"' is unexpected here."),!1;if(!m(c,g))return!1;c=c.nextSibling;g=g.nextSibling}return g?(d("Nodetype '"+g.nodeType+"' is missing here."),!1):!0}function g(a,
b,d){if(0===b)return a===b&&1/a===1/b;if(a===b)return!0;if(null===a||null===b)return!1;if("number"===typeof b&&isNaN(b))return"number"===typeof a&&isNaN(a);if("number"===typeof b&&"number"===typeof a){if(a===b)return!0;void 0===d&&(d=1E-4);runtime.assert("number"===typeof d,"Absolute tolerance not given as number.");runtime.assert(0<=d,"Absolute tolerance should be given as positive number, was "+d);a=Math.abs(a-b);return a<=d}return Object.prototype.toString.call(b)===Object.prototype.toString.call([])?
c(a,b):"object"===typeof b&&"object"===typeof a?b.constructor===Element||b.constructor===Node?m(a,b):q(a,b):!1}function p(a,b,c,e){"string"===typeof b&&"string"===typeof c||h.debug("WARN: shouldBe() expects string arguments");var f,q;try{q=eval(b)}catch(m){f=m}a=eval(c);f?d(b+" should be "+a+". Threw exception "+f):g(q,a,e)?h.pass(b+" is "+c):String(typeof q)===String(typeof a)?(c=0===q&&0>1/q?"-0":String(q),d(b+" should be "+a+". Was "+c+".")):d(b+" should be "+a+" (of type "+typeof a+"). Was "+
q+" (of type "+typeof q+").")}var r=0,n,q,b=!1;this.resourcePrefix=function(){return f};this.beginExpectFail=function(){n=r;b=!0};this.endExpectFail=function(){var a=n===r;b=!1;r=n;a&&(r+=1,h.fail("Expected at least one failed test, but none registered."))};q=function(a,b){var k=Object.keys(a),e=Object.keys(b);k.sort();e.sort();return c(k,e)&&Object.keys(a).every(function(c){var k=a[c],e=b[c];return g(k,e)?!0:(d(k+" should be "+e+" for key "+c),!1)})};this.areNodesEqual=m;this.shouldBeNull=function(a,
b){p(a,b,"null")};this.shouldBeNonNull=function(a,b){var c,e;try{e=eval(b)}catch(g){c=g}c?d(b+" should be non-null. Threw exception "+c):null!==e?h.pass(b+" is non-null."):d(b+" should be non-null. Was "+e)};this.shouldBe=p;this.testFailed=d;this.countFailedTests=function(){return r};this.name=function(a){var b,c,d=[],e=a.length;d.length=e;for(b=0;b<e;b+=1){c=Runtime.getFunctionName(a[b])||"";if(""===c)throw"Found a function without a name.";d[b]={f:a[b],name:c}}return d}};
core.UnitTester=function(){function f(c,d){return"<span style='color:blue;cursor:pointer' onclick='"+d+"'>"+c+"</span>"}function h(c){d.reporter&&d.reporter(c)}var d=this,c=0,e=new core.UnitTestLogger,m={},g="BrowserRuntime"===runtime.type();this.resourcePrefix="";this.reporter=function(c){var d,e;g?runtime.log("<span>Running "+f(c.description,'runTest("'+c.suite[0]+'","'+c.description+'")')+"</span>"):runtime.log("Running "+c.description);if(!c.success)for(d=0;d<c.log.length;d+=1)e=c.log[d],runtime.log(e.category,
e.message)};this.runTests=function(p,r,n){function q(d){function g(){A&&a.endExpectFail();h(e.endTest());l.tearDown();k[f]=v===a.countFailedTests();q(d.slice(1))}var f,A;if(0===d.length)m[b]=k,c+=a.countFailedTests(),r();else if(s=d[0].f,f=d[0].name,A=!0===d[0].expectFail,v=a.countFailedTests(),n.length&&-1===n.indexOf(f))q(d.slice(1));else{l.setUp();e.startTest(b,f);A&&a.beginExpectFail();try{s(g)}catch(p){a.testFailed("Unexpected exception encountered: "+p.toString()+"\n"+p.stack),g()}}}var b=Runtime.getFunctionName(p)||
"",a=new core.UnitTestRunner(d.resourcePrefix,e),l=new p(a),k={},t,s,w,x,v;if(m.hasOwnProperty(b))runtime.log("Test "+b+" has already run.");else{g?runtime.log("<span>Running "+f(b,'runSuite("'+b+'");')+": "+l.description()+"</span>"):runtime.log("Running "+b+": "+l.description);w=l.tests();for(t=0;t<w.length;t+=1)if(s=w[t].f,p=w[t].name,x=!0===w[t].expectFail,!n.length||-1!==n.indexOf(p)){v=a.countFailedTests();l.setUp();e.startTest(b,p);x&&a.beginExpectFail();try{s()}catch(z){a.testFailed("Unexpected exception encountered: "+
z.toString()+"\n"+z.stack)}x&&a.endExpectFail();h(e.endTest());l.tearDown();k[p]=v===a.countFailedTests()}q(l.asyncTests())}};this.failedTestsCount=function(){return c};this.results=function(){return m}};core.Utils=function(){function f(h,d){if(d&&Array.isArray(d)){h=h||[];if(!Array.isArray(h))throw"Destination is not an array.";h=h.concat(d.map(function(c){return f(null,c)}))}else if(d&&"object"===typeof d){h=h||{};if("object"!==typeof h)throw"Destination is not an object.";Object.keys(d).forEach(function(c){h[c]=f(h[c],d[c])})}else h=d;return h}this.hashString=function(f){var d=0,c,e;c=0;for(e=f.length;c<e;c+=1)d=(d<<5)-d+f.charCodeAt(c),d|=0;return d};this.mergeObjects=function(h,d){Object.keys(d).forEach(function(c){h[c]=
f(h[c],d[c])});return h}};core.Zip=function(f,h){function d(a){var b=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,
853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,
4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,
225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,
2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,
2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],c,d,e=a.length,k=0,k=0;c=-1;for(d=0;d<e;d+=1)k=(c^a[d])&255,k=b[k],c=c>>>8^k;return c^-1}function c(a){return new Date((a>>25&127)+1980,(a>>21&15)-1,a>>16&31,a>>11&15,a>>5&63,(a&31)<<1)}function e(a){var b=a.getFullYear();return 1980>b?0:b-1980<<
25|a.getMonth()+1<<21|a.getDate()<<16|a.getHours()<<11|a.getMinutes()<<5|a.getSeconds()>>1}function m(a,b){var d,e,l,g,f,h,q,m=this;this.load=function(b){if(null!==m.data)b(null,m.data);else{var c=f+34+e+l+256;c+q>k&&(c=k-q);runtime.read(a,q,c,function(c,d){if(c||null===d)b(c,d);else a:{var e=d,k=new core.ByteArray(e),l=k.readUInt32LE(),q;if(67324752!==l)b("File entry signature is wrong."+l.toString()+" "+e.length.toString(),null);else{k.pos+=22;l=k.readUInt16LE();q=k.readUInt16LE();k.pos+=l+q;if(g){e=
e.subarray(k.pos,k.pos+f);if(f!==e.length){b("The amount of compressed bytes read was "+e.length.toString()+" instead of "+f.toString()+" for "+m.filename+" in "+a+".",null);break a}e=s(e,h)}else e=e.subarray(k.pos,k.pos+h);h!==e.length?b("The amount of bytes read was "+e.length.toString()+" instead of "+h.toString()+" for "+m.filename+" in "+a+".",null):(m.data=e,b(null,e))}}})}};this.set=function(a,b,c,d){m.filename=a;m.data=b;m.compressed=c;m.date=d};this.error=null;b&&(d=b.readUInt32LE(),33639248!==
d?this.error="Central directory entry has wrong signature at position "+(b.pos-4).toString()+' for file "'+a+'": '+b.data.length.toString():(b.pos+=6,g=b.readUInt16LE(),this.date=c(b.readUInt32LE()),b.readUInt32LE(),f=b.readUInt32LE(),h=b.readUInt32LE(),e=b.readUInt16LE(),l=b.readUInt16LE(),d=b.readUInt16LE(),b.pos+=8,q=b.readUInt32LE(),this.filename=runtime.byteArrayToString(b.data.subarray(b.pos,b.pos+e),"utf8"),this.data=null,b.pos+=e+l+d))}function g(a,b){if(22!==a.length)b("Central directory length should be 22.",
w);else{var c=new core.ByteArray(a),d;d=c.readUInt32LE();101010256!==d?b("Central directory signature is wrong: "+d.toString(),w):(d=c.readUInt16LE(),0!==d?b("Zip files with non-zero disk numbers are not supported.",w):(d=c.readUInt16LE(),0!==d?b("Zip files with non-zero disk numbers are not supported.",w):(d=c.readUInt16LE(),t=c.readUInt16LE(),d!==t?b("Number of entries is inconsistent.",w):(d=c.readUInt32LE(),c=c.readUInt16LE(),c=k-22-d,runtime.read(f,c,k-c,function(a,c){if(a||null===c)b(a,w);else a:{var d=
new core.ByteArray(c),e,k;l=[];for(e=0;e<t;e+=1){k=new m(f,d);if(k.error){b(k.error,w);break a}l[l.length]=k}b(null,w)}})))))}}function p(a,b){var c=null,d,e;for(e=0;e<l.length;e+=1)if(d=l[e],d.filename===a){c=d;break}c?c.data?b(null,c.data):c.load(b):b(a+" not found.",null)}function r(a){var b=new core.ByteArrayWriter("utf8"),c=0;b.appendArray([80,75,3,4,20,0,0,0,0,0]);a.data&&(c=a.data.length);b.appendUInt32LE(e(a.date));b.appendUInt32LE(a.data?d(a.data):0);b.appendUInt32LE(c);b.appendUInt32LE(c);
b.appendUInt16LE(a.filename.length);b.appendUInt16LE(0);b.appendString(a.filename);a.data&&b.appendByteArray(a.data);return b}function n(a,b){var c=new core.ByteArrayWriter("utf8"),k=0;c.appendArray([80,75,1,2,20,0,20,0,0,0,0,0]);a.data&&(k=a.data.length);c.appendUInt32LE(e(a.date));c.appendUInt32LE(a.data?d(a.data):0);c.appendUInt32LE(k);c.appendUInt32LE(k);c.appendUInt16LE(a.filename.length);c.appendArray([0,0,0,0,0,0,0,0,0,0,0,0]);c.appendUInt32LE(b);c.appendString(a.filename);return c}function q(a,
b){if(a===l.length)b(null);else{var c=l[a];null!==c.data?q(a+1,b):c.load(function(c){c?b(c):q(a+1,b)})}}function b(a,b){q(0,function(c){if(c)b(c);else{var d,e,k=new core.ByteArrayWriter("utf8"),g=[0];for(d=0;d<l.length;d+=1)k.appendByteArrayWriter(r(l[d])),g.push(k.getLength());c=k.getLength();for(d=0;d<l.length;d+=1)e=l[d],k.appendByteArrayWriter(n(e,g[d]));d=k.getLength()-c;k.appendArray([80,75,5,6,0,0,0,0]);k.appendUInt16LE(l.length);k.appendUInt16LE(l.length);k.appendUInt32LE(d);k.appendUInt32LE(c);
k.appendArray([0,0]);a(k.getByteArray())}})}function a(a,c){b(function(b){runtime.writeFile(a,b,c)},c)}var l,k,t,s=(new core.RawInflate).inflate,w=this,x=new core.Base64;this.load=p;this.save=function(a,b,c,d){var e,k;for(e=0;e<l.length;e+=1)if(k=l[e],k.filename===a){k.set(a,b,c,d);return}k=new m(f);k.set(a,b,c,d);l.push(k)};this.remove=function(a){var b,c;for(b=0;b<l.length;b+=1)if(c=l[b],c.filename===a)return l.splice(b,1),!0;return!1};this.write=function(b){a(f,b)};this.writeAs=a;this.createByteArray=
b;this.loadContentXmlAsFragments=function(a,b){w.loadAsString(a,function(a,c){if(a)return b.rootElementReady(a);b.rootElementReady(null,c,!0)})};this.loadAsString=function(a,b){p(a,function(a,c){if(a||null===c)return b(a,null);var d=runtime.byteArrayToString(c,"utf8");b(null,d)})};this.loadAsDOM=function(a,b){w.loadAsString(a,function(a,c){if(a||null===c)b(a,null);else{var d=(new DOMParser).parseFromString(c,"text/xml");b(null,d)}})};this.loadAsDataURL=function(a,b,c){p(a,function(a,d){if(a||!d)return c(a,
null);var k=0,e;b||(b=80===d[1]&&78===d[2]&&71===d[3]?"image/png":255===d[0]&&216===d[1]&&255===d[2]?"image/jpeg":71===d[0]&&73===d[1]&&70===d[2]?"image/gif":"");for(e="data:"+b+";base64,";k<d.length;)e+=x.convertUTF8ArrayToBase64(d.subarray(k,Math.min(k+45E3,d.length))),k+=45E3;c(null,e)})};this.getEntries=function(){return l.slice()};k=-1;null===h?l=[]:runtime.getFileSize(f,function(a){k=a;0>k?h("File '"+f+"' cannot be read.",w):runtime.read(f,k-22,22,function(a,b){a||null===h||null===b?h(a,w):
g(b,h)})})};gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}};gui.SessionConstraints=function(){function f(c){h.hasOwnProperty(c)||(h[c]=!1,d.register(c))}var h={},d=new core.EventNotifier;this.registerConstraint=f;this.subscribe=function(c,e){f(c);d.subscribe(c,e)};this.unsubscribe=function(c,e){d.unsubscribe(c,e)};this.setState=function(c,e){runtime.assert(!0===h.hasOwnProperty(c),"No such constraint");h[c]!==e&&(h[c]=e,d.emit(c,e))};this.getState=function(c){runtime.assert(!0===h.hasOwnProperty(c),"No such constraint");return h[c]}};xmldom.LSSerializerFilter=function(){};xmldom.LSSerializerFilter.prototype.acceptNode=function(f){};odf.OdfNodeFilter=function(){this.acceptNode=function(f){return"http://www.w3.org/1999/xhtml"===f.namespaceURI?NodeFilter.FILTER_SKIP:f.namespaceURI&&f.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}};odf.Namespaces={namespaceMap:{db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",
office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",
dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"};
(function(){var f=odf.Namespaces.namespaceMap,h=odf.Namespaces.prefixMap,d;for(d in f)f.hasOwnProperty(d)&&(h[f[d]]=d)})();odf.Namespaces.forEachPrefix=function(f){var h=odf.Namespaces.namespaceMap,d;for(d in h)h.hasOwnProperty(d)&&f(d,h[d])};odf.Namespaces.lookupNamespaceURI=function(f){var h=null;odf.Namespaces.namespaceMap.hasOwnProperty(f)&&(h=odf.Namespaces.namespaceMap[f]);return h};odf.Namespaces.lookupPrefix=function(f){var h=odf.Namespaces.prefixMap;return h.hasOwnProperty(f)?h[f]:null};
odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI;xmldom.XPathIterator=function(){};xmldom.XPathIterator.prototype.next=function(){};xmldom.XPathIterator.prototype.reset=function(){};
function createXPathSingleton(){function f(c,b,a){return-1!==c&&(c<b||-1===b)&&(c<a||-1===a)}function h(c){for(var b=[],a=0,d=c.length,k;a<d;){var e=c,g=d,h=b,m="",p=[],r=e.indexOf("[",a),u=e.indexOf("/",a),C=e.indexOf("=",a);f(u,r,C)?(m=e.substring(a,u),a=u+1):f(r,u,C)?(m=e.substring(a,r),a=n(e,r,p)):f(C,u,r)?(m=e.substring(a,C),a=C):(m=e.substring(a,g),a=g);h.push({location:m,predicates:p});if(a<d&&"="===c[a]){k=c.substring(a+1,d);if(2<k.length&&("'"===k[0]||'"'===k[0]))k=k.slice(1,k.length-1);
else try{k=parseInt(k,10)}catch(I){}a=d}}return{steps:b,value:k}}function d(){var c=null,b=!1;this.setNode=function(a){c=a};this.reset=function(){b=!1};this.next=function(){var a=b?null:c;b=!0;return a}}function c(c,b,a){this.reset=function(){c.reset()};this.next=function(){for(var d=c.next();d;){d.nodeType===Node.ELEMENT_NODE&&(d=d.getAttributeNodeNS(b,a));if(d)break;d=c.next()}return d}}function e(c,b){var a=c.next(),d=null;this.reset=function(){c.reset();a=c.next();d=null};this.next=function(){for(;a;){if(d)if(b&&
d.firstChild)d=d.firstChild;else{for(;!d.nextSibling&&d!==a;)d=d.parentNode;d===a?a=c.next():d=d.nextSibling}else{do(d=a.firstChild)||(a=c.next());while(a&&!d)}if(d&&d.nodeType===Node.ELEMENT_NODE)return d}return null}}function m(c,b){this.reset=function(){c.reset()};this.next=function(){for(var a=c.next();a&&!b(a);)a=c.next();return a}}function g(c,b,a){b=b.split(":",2);var d=a(b[0]),e=b[1];return new m(c,function(a){return a.localName===e&&a.namespaceURI===d})}function p(c,b,a){var e=new d,k=r(e,
b,a),g=b.value;return void 0===g?new m(c,function(a){e.setNode(a);k.reset();return null!==k.next()}):new m(c,function(a){e.setNode(a);k.reset();return(a=k.next())?a.nodeValue===g:!1})}var r,n;n=function(c,b,a){for(var d=b,e=c.length,g=0;d<e;)"]"===c[d]?(g-=1,0>=g&&a.push(h(c.substring(b,d)))):"["===c[d]&&(0>=g&&(b=d+1),g+=1),d+=1;return d};r=function(d,b,a){var l,k,f,h;for(l=0;l<b.steps.length;l+=1){f=b.steps[l];k=f.location;if(""===k)d=new e(d,!1);else if("@"===k[0]){k=k.substr(1).split(":",2);h=
a(k[0]);if(!h)throw"No namespace associated with the prefix "+k[0];d=new c(d,h,k[1])}else"."!==k&&(d=new e(d,!1),-1!==k.indexOf(":")&&(d=g(d,k,a)));for(k=0;k<f.predicates.length;k+=1)h=f.predicates[k],d=p(d,h,a)}return d};return{getODFElementsWithXPath:function(c,b,a){var e=c.ownerDocument,k=[],g=null;if(e&&"function"===typeof e.evaluate)for(a=e.evaluate(b,c,a,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null),g=a.iterateNext();null!==g;)g.nodeType===Node.ELEMENT_NODE&&k.push(g),g=a.iterateNext();else{k=
new d;k.setNode(c);c=h(b);k=r(k,c,a);c=[];for(a=k.next();a;)c.push(a),a=k.next();k=c}return k}}}xmldom.XPath=createXPathSingleton();odf.StyleInfo=function(){function f(a,b){var c,d,e,k,g,l=0;if(c=A[a.localName])if(e=c[a.namespaceURI])l=e.length;for(c=0;c<l;c+=1)d=e[c],k=d.ns,g=d.localname,(d=a.getAttributeNS(k,g))&&a.setAttributeNS(k,C[k]+g,b+d);for(e=a.firstElementChild;e;)f(e,b),e=e.nextElementSibling}function h(a,b){var c,d,e,k,g,l=0;if(c=A[a.localName])if(e=c[a.namespaceURI])l=e.length;for(c=0;c<l;c+=1)if(d=e[c],k=d.ns,g=d.localname,d=a.getAttributeNS(k,g))d=d.replace(b,""),a.setAttributeNS(k,C[k]+g,d);for(e=a.firstElementChild;e;)h(e,
b),e=e.nextElementSibling}function d(a,b){var c,d,e,k,g,l=0;if(c=A[a.localName])if(e=c[a.namespaceURI])l=e.length;for(c=0;c<l;c+=1)if(k=e[c],d=k.ns,g=k.localname,d=a.getAttributeNS(d,g))b=b||{},k=k.keyname,b.hasOwnProperty(k)?b[k][d]=1:(g={},g[d]=1,b[k]=g);return b}function c(a,b){var e,k;d(a,b);for(e=a.firstChild;e;)e.nodeType===Node.ELEMENT_NODE&&(k=e,c(k,b)),e=e.nextSibling}function e(a,b,c){this.key=a;this.name=b;this.family=c;this.requires={}}function m(a,b,c){var d=a+'"'+b,k=c[d];k||(k=c[d]=
new e(d,a,b));return k}function g(a,b,c){var d,e,k,l,f,h=0;d=a.getAttributeNS(v,"name");l=a.getAttributeNS(v,"family");d&&l&&(b=m(d,l,c));if(b){if(d=A[a.localName])if(k=d[a.namespaceURI])h=k.length;for(d=0;d<h;d+=1)if(l=k[d],e=l.ns,f=l.localname,e=a.getAttributeNS(e,f))l=l.keyname,l=m(e,l,c),b.requires[l.key]=l}for(a=a.firstElementChild;a;)g(a,b,c),a=a.nextElementSibling;return c}function p(a,b){var c=b[a.family];c||(c=b[a.family]={});c[a.name]=1;Object.keys(a.requires).forEach(function(c){p(a.requires[c],
b)})}function r(a,b){var c=g(a,null,{});Object.keys(c).forEach(function(a){a=c[a];var d=b[a.family];d&&d.hasOwnProperty(a.name)&&p(a,b)})}function n(a,b){function c(b){(b=k.getAttributeNS(v,b))&&(a[b]=!0)}var d=["font-name","font-name-asian","font-name-complex"],e,k;for(e=b&&b.firstElementChild;e;)k=e,d.forEach(c),n(a,k),e=e.nextElementSibling}function q(a,b){function c(a){var d=k.getAttributeNS(v,a);d&&b.hasOwnProperty(d)&&k.setAttributeNS(v,"style:"+a,b[d])}var d=["font-name","font-name-asian",
"font-name-complex"],e,k;for(e=a&&a.firstElementChild;e;)k=e,d.forEach(c),q(k,b),e=e.nextElementSibling}var b=odf.Namespaces.chartns,a=odf.Namespaces.dbns,l=odf.Namespaces.dr3dns,k=odf.Namespaces.drawns,t=odf.Namespaces.formns,s=odf.Namespaces.numberns,w=odf.Namespaces.officens,x=odf.Namespaces.presentationns,v=odf.Namespaces.stylens,z=odf.Namespaces.tablens,u=odf.Namespaces.textns,C={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:",
"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:",
"urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},I={text:[{ens:v,en:"tab-stop",ans:v,a:"leader-text-style"},{ens:v,en:"drop-cap",ans:v,a:"style-name"},{ens:u,en:"notes-configuration",ans:u,a:"citation-body-style-name"},{ens:u,en:"notes-configuration",ans:u,a:"citation-style-name"},{ens:u,en:"a",ans:u,a:"style-name"},{ens:u,en:"alphabetical-index",ans:u,a:"style-name"},{ens:u,en:"linenumbering-configuration",
ans:u,a:"style-name"},{ens:u,en:"list-level-style-number",ans:u,a:"style-name"},{ens:u,en:"ruby-text",ans:u,a:"style-name"},{ens:u,en:"span",ans:u,a:"style-name"},{ens:u,en:"a",ans:u,a:"visited-style-name"},{ens:v,en:"text-properties",ans:v,a:"text-line-through-text-style"},{ens:u,en:"alphabetical-index-source",ans:u,a:"main-entry-style-name"},{ens:u,en:"index-entry-bibliography",ans:u,a:"style-name"},{ens:u,en:"index-entry-chapter",ans:u,a:"style-name"},{ens:u,en:"index-entry-link-end",ans:u,a:"style-name"},
{ens:u,en:"index-entry-link-start",ans:u,a:"style-name"},{ens:u,en:"index-entry-page-number",ans:u,a:"style-name"},{ens:u,en:"index-entry-span",ans:u,a:"style-name"},{ens:u,en:"index-entry-tab-stop",ans:u,a:"style-name"},{ens:u,en:"index-entry-text",ans:u,a:"style-name"},{ens:u,en:"index-title-template",ans:u,a:"style-name"},{ens:u,en:"list-level-style-bullet",ans:u,a:"style-name"},{ens:u,en:"outline-level-style",ans:u,a:"style-name"}],paragraph:[{ens:k,en:"caption",ans:k,a:"text-style-name"},{ens:k,
en:"circle",ans:k,a:"text-style-name"},{ens:k,en:"connector",ans:k,a:"text-style-name"},{ens:k,en:"control",ans:k,a:"text-style-name"},{ens:k,en:"custom-shape",ans:k,a:"text-style-name"},{ens:k,en:"ellipse",ans:k,a:"text-style-name"},{ens:k,en:"frame",ans:k,a:"text-style-name"},{ens:k,en:"line",ans:k,a:"text-style-name"},{ens:k,en:"measure",ans:k,a:"text-style-name"},{ens:k,en:"path",ans:k,a:"text-style-name"},{ens:k,en:"polygon",ans:k,a:"text-style-name"},{ens:k,en:"polyline",ans:k,a:"text-style-name"},
{ens:k,en:"rect",ans:k,a:"text-style-name"},{ens:k,en:"regular-polygon",ans:k,a:"text-style-name"},{ens:w,en:"annotation",ans:k,a:"text-style-name"},{ens:t,en:"column",ans:t,a:"text-style-name"},{ens:v,en:"style",ans:v,a:"next-style-name"},{ens:z,en:"body",ans:z,a:"paragraph-style-name"},{ens:z,en:"even-columns",ans:z,a:"paragraph-style-name"},{ens:z,en:"even-rows",ans:z,a:"paragraph-style-name"},{ens:z,en:"first-column",ans:z,a:"paragraph-style-name"},{ens:z,en:"first-row",ans:z,a:"paragraph-style-name"},
{ens:z,en:"last-column",ans:z,a:"paragraph-style-name"},{ens:z,en:"last-row",ans:z,a:"paragraph-style-name"},{ens:z,en:"odd-columns",ans:z,a:"paragraph-style-name"},{ens:z,en:"odd-rows",ans:z,a:"paragraph-style-name"},{ens:u,en:"notes-configuration",ans:u,a:"default-style-name"},{ens:u,en:"alphabetical-index-entry-template",ans:u,a:"style-name"},{ens:u,en:"bibliography-entry-template",ans:u,a:"style-name"},{ens:u,en:"h",ans:u,a:"style-name"},{ens:u,en:"illustration-index-entry-template",ans:u,a:"style-name"},
{ens:u,en:"index-source-style",ans:u,a:"style-name"},{ens:u,en:"object-index-entry-template",ans:u,a:"style-name"},{ens:u,en:"p",ans:u,a:"style-name"},{ens:u,en:"table-index-entry-template",ans:u,a:"style-name"},{ens:u,en:"table-of-content-entry-template",ans:u,a:"style-name"},{ens:u,en:"table-index-entry-template",ans:u,a:"style-name"},{ens:u,en:"user-index-entry-template",ans:u,a:"style-name"},{ens:v,en:"page-layout-properties",ans:v,a:"register-truth-ref-style-name"}],chart:[{ens:b,en:"axis",ans:b,
a:"style-name"},{ens:b,en:"chart",ans:b,a:"style-name"},{ens:b,en:"data-label",ans:b,a:"style-name"},{ens:b,en:"data-point",ans:b,a:"style-name"},{ens:b,en:"equation",ans:b,a:"style-name"},{ens:b,en:"error-indicator",ans:b,a:"style-name"},{ens:b,en:"floor",ans:b,a:"style-name"},{ens:b,en:"footer",ans:b,a:"style-name"},{ens:b,en:"grid",ans:b,a:"style-name"},{ens:b,en:"legend",ans:b,a:"style-name"},{ens:b,en:"mean-value",ans:b,a:"style-name"},{ens:b,en:"plot-area",ans:b,a:"style-name"},{ens:b,en:"regression-curve",
ans:b,a:"style-name"},{ens:b,en:"series",ans:b,a:"style-name"},{ens:b,en:"stock-gain-marker",ans:b,a:"style-name"},{ens:b,en:"stock-loss-marker",ans:b,a:"style-name"},{ens:b,en:"stock-range-line",ans:b,a:"style-name"},{ens:b,en:"subtitle",ans:b,a:"style-name"},{ens:b,en:"title",ans:b,a:"style-name"},{ens:b,en:"wall",ans:b,a:"style-name"}],section:[{ens:u,en:"alphabetical-index",ans:u,a:"style-name"},{ens:u,en:"bibliography",ans:u,a:"style-name"},{ens:u,en:"illustration-index",ans:u,a:"style-name"},
{ens:u,en:"index-title",ans:u,a:"style-name"},{ens:u,en:"object-index",ans:u,a:"style-name"},{ens:u,en:"section",ans:u,a:"style-name"},{ens:u,en:"table-of-content",ans:u,a:"style-name"},{ens:u,en:"table-index",ans:u,a:"style-name"},{ens:u,en:"user-index",ans:u,a:"style-name"}],ruby:[{ens:u,en:"ruby",ans:u,a:"style-name"}],table:[{ens:a,en:"query",ans:a,a:"style-name"},{ens:a,en:"table-representation",ans:a,a:"style-name"},{ens:z,en:"background",ans:z,a:"style-name"},{ens:z,en:"table",ans:z,a:"style-name"}],
"table-column":[{ens:a,en:"column",ans:a,a:"style-name"},{ens:z,en:"table-column",ans:z,a:"style-name"}],"table-row":[{ens:a,en:"query",ans:a,a:"default-row-style-name"},{ens:a,en:"table-representation",ans:a,a:"default-row-style-name"},{ens:z,en:"table-row",ans:z,a:"style-name"}],"table-cell":[{ens:a,en:"column",ans:a,a:"default-cell-style-name"},{ens:z,en:"table-column",ans:z,a:"default-cell-style-name"},{ens:z,en:"table-row",ans:z,a:"default-cell-style-name"},{ens:z,en:"body",ans:z,a:"style-name"},
{ens:z,en:"covered-table-cell",ans:z,a:"style-name"},{ens:z,en:"even-columns",ans:z,a:"style-name"},{ens:z,en:"covered-table-cell",ans:z,a:"style-name"},{ens:z,en:"even-columns",ans:z,a:"style-name"},{ens:z,en:"even-rows",ans:z,a:"style-name"},{ens:z,en:"first-column",ans:z,a:"style-name"},{ens:z,en:"first-row",ans:z,a:"style-name"},{ens:z,en:"last-column",ans:z,a:"style-name"},{ens:z,en:"last-row",ans:z,a:"style-name"},{ens:z,en:"odd-columns",ans:z,a:"style-name"},{ens:z,en:"odd-rows",ans:z,a:"style-name"},
{ens:z,en:"table-cell",ans:z,a:"style-name"}],graphic:[{ens:l,en:"cube",ans:k,a:"style-name"},{ens:l,en:"extrude",ans:k,a:"style-name"},{ens:l,en:"rotate",ans:k,a:"style-name"},{ens:l,en:"scene",ans:k,a:"style-name"},{ens:l,en:"sphere",ans:k,a:"style-name"},{ens:k,en:"caption",ans:k,a:"style-name"},{ens:k,en:"circle",ans:k,a:"style-name"},{ens:k,en:"connector",ans:k,a:"style-name"},{ens:k,en:"control",ans:k,a:"style-name"},{ens:k,en:"custom-shape",ans:k,a:"style-name"},{ens:k,en:"ellipse",ans:k,a:"style-name"},
{ens:k,en:"frame",ans:k,a:"style-name"},{ens:k,en:"g",ans:k,a:"style-name"},{ens:k,en:"line",ans:k,a:"style-name"},{ens:k,en:"measure",ans:k,a:"style-name"},{ens:k,en:"page-thumbnail",ans:k,a:"style-name"},{ens:k,en:"path",ans:k,a:"style-name"},{ens:k,en:"polygon",ans:k,a:"style-name"},{ens:k,en:"polyline",ans:k,a:"style-name"},{ens:k,en:"rect",ans:k,a:"style-name"},{ens:k,en:"regular-polygon",ans:k,a:"style-name"},{ens:w,en:"annotation",ans:k,a:"style-name"}],presentation:[{ens:l,en:"cube",ans:x,
a:"style-name"},{ens:l,en:"extrude",ans:x,a:"style-name"},{ens:l,en:"rotate",ans:x,a:"style-name"},{ens:l,en:"scene",ans:x,a:"style-name"},{ens:l,en:"sphere",ans:x,a:"style-name"},{ens:k,en:"caption",ans:x,a:"style-name"},{ens:k,en:"circle",ans:x,a:"style-name"},{ens:k,en:"connector",ans:x,a:"style-name"},{ens:k,en:"control",ans:x,a:"style-name"},{ens:k,en:"custom-shape",ans:x,a:"style-name"},{ens:k,en:"ellipse",ans:x,a:"style-name"},{ens:k,en:"frame",ans:x,a:"style-name"},{ens:k,en:"g",ans:x,a:"style-name"},
{ens:k,en:"line",ans:x,a:"style-name"},{ens:k,en:"measure",ans:x,a:"style-name"},{ens:k,en:"page-thumbnail",ans:x,a:"style-name"},{ens:k,en:"path",ans:x,a:"style-name"},{ens:k,en:"polygon",ans:x,a:"style-name"},{ens:k,en:"polyline",ans:x,a:"style-name"},{ens:k,en:"rect",ans:x,a:"style-name"},{ens:k,en:"regular-polygon",ans:x,a:"style-name"},{ens:w,en:"annotation",ans:x,a:"style-name"}],"drawing-page":[{ens:k,en:"page",ans:k,a:"style-name"},{ens:x,en:"notes",ans:k,a:"style-name"},{ens:v,en:"handout-master",
ans:k,a:"style-name"},{ens:v,en:"master-page",ans:k,a:"style-name"}],"list-style":[{ens:u,en:"list",ans:u,a:"style-name"},{ens:u,en:"numbered-paragraph",ans:u,a:"style-name"},{ens:u,en:"list-item",ans:u,a:"style-override"},{ens:v,en:"style",ans:v,a:"list-style-name"}],data:[{ens:v,en:"style",ans:v,a:"data-style-name"},{ens:v,en:"style",ans:v,a:"percentage-data-style-name"},{ens:x,en:"date-time-decl",ans:v,a:"data-style-name"},{ens:u,en:"creation-date",ans:v,a:"data-style-name"},{ens:u,en:"creation-time",
ans:v,a:"data-style-name"},{ens:u,en:"database-display",ans:v,a:"data-style-name"},{ens:u,en:"date",ans:v,a:"data-style-name"},{ens:u,en:"editing-duration",ans:v,a:"data-style-name"},{ens:u,en:"expression",ans:v,a:"data-style-name"},{ens:u,en:"meta-field",ans:v,a:"data-style-name"},{ens:u,en:"modification-date",ans:v,a:"data-style-name"},{ens:u,en:"modification-time",ans:v,a:"data-style-name"},{ens:u,en:"print-date",ans:v,a:"data-style-name"},{ens:u,en:"print-time",ans:v,a:"data-style-name"},{ens:u,
en:"table-formula",ans:v,a:"data-style-name"},{ens:u,en:"time",ans:v,a:"data-style-name"},{ens:u,en:"user-defined",ans:v,a:"data-style-name"},{ens:u,en:"user-field-get",ans:v,a:"data-style-name"},{ens:u,en:"user-field-input",ans:v,a:"data-style-name"},{ens:u,en:"variable-get",ans:v,a:"data-style-name"},{ens:u,en:"variable-input",ans:v,a:"data-style-name"},{ens:u,en:"variable-set",ans:v,a:"data-style-name"}],"page-layout":[{ens:x,en:"notes",ans:v,a:"page-layout-name"},{ens:v,en:"handout-master",ans:v,
a:"page-layout-name"},{ens:v,en:"master-page",ans:v,a:"page-layout-name"}]},A,K=xmldom.XPath;this.collectUsedFontFaces=n;this.changeFontFaceNames=q;this.UsedStyleList=function(a,b){var d={};this.uses=function(a){var b=a.localName,c=a.getAttributeNS(k,"name")||a.getAttributeNS(v,"name");a="style"===b?a.getAttributeNS(v,"family"):a.namespaceURI===s?"data":b;return(a=d[a])?0<a[c]:!1};c(a,d);b&&r(b,d)};this.getStyleName=function(a,b){var c,d,e=A[b.localName];if(e&&(e=e[b.namespaceURI]))for(d=0;d<e.length;d+=
1)if(e[d].keyname===a&&(e=e[d],b.hasAttributeNS(e.ns,e.localname))){c=b.getAttributeNS(e.ns,e.localname);break}return c};this.hasDerivedStyles=function(a,b,c){var d=c.getAttributeNS(v,"name");c=c.getAttributeNS(v,"family");return K.getODFElementsWithXPath(a,"//style:*[@style:parent-style-name='"+d+"'][@style:family='"+c+"']",b).length?!0:!1};this.prefixStyleNames=function(a,b,c){var d;if(a){for(d=a.firstChild;d;){if(d.nodeType===Node.ELEMENT_NODE){var e=d,l=b,g=e.getAttributeNS(k,"name"),h=void 0;
g?h=k:(g=e.getAttributeNS(v,"name"))&&(h=v);h&&e.setAttributeNS(h,C[h]+"name",l+g)}d=d.nextSibling}f(a,b);c&&f(c,b)}};this.removePrefixFromStyleNames=function(a,b,c){var d=RegExp("^"+b);if(a){for(b=a.firstChild;b;){if(b.nodeType===Node.ELEMENT_NODE){var e=b,g=d,l=e.getAttributeNS(k,"name"),f=void 0;l?f=k:(l=e.getAttributeNS(v,"name"))&&(f=v);f&&(l=l.replace(g,""),e.setAttributeNS(f,C[f]+"name",l))}b=b.nextSibling}h(a,d);c&&h(c,d)}};this.determineStylesForNode=d;A=function(){var a,b,c,d,e,k={},l,g,
f,h;for(c in I)if(I.hasOwnProperty(c))for(d=I[c],b=d.length,a=0;a<b;a+=1)e=d[a],f=e.en,h=e.ens,k.hasOwnProperty(f)?l=k[f]:k[f]=l={},l.hasOwnProperty(h)?g=l[h]:l[h]=g=[],g.push({ns:e.ans,localname:e.a,keyname:c});return k}()};"function"!==typeof Object.create&&(Object.create=function(f){var h=function(){};h.prototype=f;return new h});
xmldom.LSSerializer=function(){function f(c){var d=c||{},g=function(c){var b={},a;for(a in c)c.hasOwnProperty(a)&&(b[c[a]]=a);return b}(c),f=[d],h=[g],n=0;this.push=function(){n+=1;d=f[n]=Object.create(d);g=h[n]=Object.create(g)};this.pop=function(){f.pop();h.pop();n-=1;d=f[n];g=h[n]};this.getLocalNamespaceDefinitions=function(){return g};this.getQName=function(c){var b=c.namespaceURI,a=0,e;if(!b)return c.localName;if(e=g[b])return e+":"+c.localName;do{e||!c.prefix?(e="ns"+a,a+=1):e=c.prefix;if(d[e]===
b)break;if(!d[e]){d[e]=b;g[b]=e;break}e=null}while(null===e);return e+":"+c.localName}}function h(c){return c.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function d(e,f){var g="",p=c.filter?c.filter.acceptNode(f):NodeFilter.FILTER_ACCEPT,r;if(p===NodeFilter.FILTER_ACCEPT&&f.nodeType===Node.ELEMENT_NODE){e.push();r=e.getQName(f);var n,q=f.attributes,b,a,l,k="",t;n="<"+r;b=q.length;for(a=0;a<b;a+=1)l=q.item(a),"http://www.w3.org/2000/xmlns/"!==
l.namespaceURI&&(t=c.filter?c.filter.acceptNode(l):NodeFilter.FILTER_ACCEPT,t===NodeFilter.FILTER_ACCEPT&&(t=e.getQName(l),l="string"===typeof l.value?h(l.value):l.value,k+=" "+(t+'="'+l+'"')));b=e.getLocalNamespaceDefinitions();for(a in b)b.hasOwnProperty(a)&&((q=b[a])?"xmlns"!==q&&(n+=" xmlns:"+b[a]+'="'+a+'"'):n+=' xmlns="'+a+'"');g+=n+(k+">")}if(p===NodeFilter.FILTER_ACCEPT||p===NodeFilter.FILTER_SKIP){for(p=f.firstChild;p;)g+=d(e,p),p=p.nextSibling;f.nodeValue&&(g+=h(f.nodeValue))}r&&(g+="</"+
r+">",e.pop());return g}var c=this;this.filter=null;this.writeToString=function(c,h){if(!c)return"";var g=new f(h);return d(g,c)}};(function(){function f(c){var b,a=p.length;for(b=0;b<a;b+=1)if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===c.namespaceURI&&c.localName===p[b])return b;return-1}function h(c,b){var a=new e.UsedStyleList(c,b),d=new odf.OdfNodeFilter;this.acceptNode=function(c){var e=d.acceptNode(c);e===NodeFilter.FILTER_ACCEPT&&c.parentNode===b&&c.nodeType===Node.ELEMENT_NODE&&(e=a.uses(c)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT);return e}}function d(c,b){var a=new h(c,b);this.acceptNode=function(b){var c=
a.acceptNode(b);c!==NodeFilter.FILTER_ACCEPT||!b.parentNode||b.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==b.parentNode.localName&&"tab"!==b.parentNode.localName||(c=NodeFilter.FILTER_REJECT);return c}}function c(c,b){if(b){var a=f(b),d,e=c.firstChild;if(-1!==a){for(;e;){d=f(e);if(-1!==d&&d>a)break;e=e.nextSibling}c.insertBefore(b,e)}}}var e=new odf.StyleInfo,m=new core.DomUtils,g=odf.Namespaces.stylens,p="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),
r=Date.now()+"_webodf_",n=new core.Base64;odf.ODFElement=function(){};odf.ODFDocumentElement=function(){};odf.ODFDocumentElement.prototype=new odf.ODFElement;odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement;odf.ODFDocumentElement.prototype.fontFaceDecls=null;odf.ODFDocumentElement.prototype.manifest=null;odf.ODFDocumentElement.prototype.settings=null;odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0";odf.ODFDocumentElement.localName="document";
odf.AnnotationElement=function(){};odf.OdfPart=function(c,b,a,d){var e=this;this.size=0;this.type=null;this.name=c;this.container=a;this.url=null;this.mimetype=b;this.onstatereadychange=this.document=null;this.EMPTY=0;this.LOADING=1;this.DONE=2;this.state=this.EMPTY;this.data="";this.load=function(){null!==d&&(this.mimetype=b,d.loadAsDataURL(c,b,function(a,b){a&&runtime.log(a);e.url=b;if(e.onchange)e.onchange(e);if(e.onstatereadychange)e.onstatereadychange(e)}))}};odf.OdfPart.prototype.load=function(){};
odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+n.toBase64(this.data):null};odf.OdfContainer=function b(a,l){function k(a){for(var b=a.firstChild,c;b;)c=b.nextSibling,b.nodeType===Node.ELEMENT_NODE?k(b):b.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&a.removeChild(b),b=c}function f(a){var b={},c,d,e=a.ownerDocument.createNodeIterator(a,NodeFilter.SHOW_ELEMENT,null,!1);for(a=e.nextNode();a;)"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&("annotation"===
a.localName?(c=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(b.hasOwnProperty(c)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+c+"'"):b[c]=a):"annotation-end"===a.localName&&((c=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))?b.hasOwnProperty(c)?(d=b[c],d.annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+c+"'"):d.annotationEndElement=
a):runtime.log("Warning: annotation end without an annotation start, name: '"+c+"'"):runtime.log("Warning: annotation end without a name found"))),a=e.nextNode()}function p(a,b){for(var c=a&&a.firstChild;c;)c.nodeType===Node.ELEMENT_NODE&&c.setAttributeNS("urn:webodf:names:scope","scope",b),c=c.nextSibling}function w(a,b){for(var c=S.rootElement.meta,c=c&&c.firstChild;c&&(c.namespaceURI!==a||c.localName!==b);)c=c.nextSibling;for(c=c&&c.firstChild;c&&c.nodeType!==Node.TEXT_NODE;)c=c.nextSibling;return c?
c.data:null}function x(a){var b={},c;for(a=a.firstChild;a;)a.nodeType===Node.ELEMENT_NODE&&a.namespaceURI===g&&"font-face"===a.localName&&(c=a.getAttributeNS(g,"name"),b[c]=a),a=a.nextSibling;return b}function v(a,b){var c=null,d,e,k;if(a)for(c=a.cloneNode(!0),d=c.firstElementChild;d;)e=d.nextElementSibling,(k=d.getAttributeNS("urn:webodf:names:scope","scope"))&&k!==b&&c.removeChild(d),d=e;return c}function z(a,b){var c,d,k,l=null,f={};if(a)for(b.forEach(function(a){e.collectUsedFontFaces(f,a)}),
l=a.cloneNode(!0),c=l.firstElementChild;c;)d=c.nextElementSibling,k=c.getAttributeNS(g,"name"),f[k]||l.removeChild(c),c=d;return l}function u(a){var b=S.rootElement.ownerDocument,c;if(a){k(a.documentElement);try{c=b.importNode(a.documentElement,!0)}catch(d){}}return c}function C(a){S.state=a;if(S.onchange)S.onchange(S);if(S.onstatereadychange)S.onstatereadychange(S)}function I(a){L=null;S.rootElement=a;a.fontFaceDecls=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");
a.styles=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles");a.automaticStyles=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");a.masterStyles=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles");a.body=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");a.meta=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta");a.settings=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"settings");a.scripts=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts");f(a)}function A(a){var d=u(a),k=S.rootElement,g;d&&"document-styles"===d.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===d.namespaceURI?(k.fontFaceDecls=m.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),c(k,k.fontFaceDecls),g=m.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),k.styles=g||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"styles"),c(k,k.styles),g=m.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),k.automaticStyles=g||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),p(k.automaticStyles,"document-styles"),c(k,k.automaticStyles),d=m.getDirectChild(d,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),k.masterStyles=d||a.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),c(k,k.masterStyles),
e.prefixStyleNames(k.automaticStyles,r,k.masterStyles)):C(b.INVALID)}function K(a){a=u(a);var d,k,l,f;if(a&&"document-content"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI){d=S.rootElement;l=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls");if(d.fontFaceDecls&&l){f=d.fontFaceDecls;var h,A,n,r,t={};k=x(f);r=x(l);for(l=l.firstElementChild;l;){h=l.nextElementSibling;if(l.namespaceURI===g&&"font-face"===l.localName)if(A=l.getAttributeNS(g,
"name"),k.hasOwnProperty(A)){if(!l.isEqualNode(k[A])){n=A;for(var U=k,J=r,K=0,ca=void 0,ca=n=n.replace(/\d+$/,"");U.hasOwnProperty(ca)||J.hasOwnProperty(ca);)K+=1,ca=n+K;n=ca;l.setAttributeNS(g,"style:name",n);f.appendChild(l);k[n]=l;delete r[A];t[A]=n}}else f.appendChild(l),k[A]=l,delete r[A];l=h}f=t}else l&&(d.fontFaceDecls=l,c(d,l));k=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles");p(k,"document-content");f&&e.changeFontFaceNames(k,f);if(d.automaticStyles&&
k)for(f=k.firstChild;f;)d.automaticStyles.appendChild(f),f=k.firstChild;else k&&(d.automaticStyles=k,c(d,k));a=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body");if(null===a)throw"<office:body/> tag is mising.";d.body=a;c(d,d.body)}else C(b.INVALID)}function J(a){a=u(a);var b;a&&"document-meta"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(b=S.rootElement,b.meta=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0",
"meta"),c(b,b.meta))}function H(a){a=u(a);var b;a&&"document-settings"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI&&(b=S.rootElement,b.settings=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),c(b,b.settings))}function U(a){a=u(a);var b;if(a&&"manifest"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===a.namespaceURI)for(b=S.rootElement,b.manifest=a,a=b.manifest.firstElementChild;a;)"file-entry"===a.localName&&
"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===a.namespaceURI&&(V[a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=a.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),a=a.nextElementSibling}function W(a,b,c){a=m.getElementsByTagName(a,b);var d;for(d=0;d<a.length;d+=1)b=a[d],c.hasOwnProperty(b.namespaceURI)||b.parentNode.removeChild(b)}function E(a){W(a,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,
"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0});W(a,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function aa(a){var b=a.firstElementChild,c=[],d,e,k,g=a.attributes,l=g.length;for(d=0;d<l;d+=1)k=g.item(d),e=k.localName.substr(0,2).toLowerCase(),null===
k.namespaceURI&&"on"===e&&c.push(k);l=c.length;for(d=0;d<l;d+=1)a.removeAttributeNode(c[d]);for(;b;)aa(b),b=b.nextElementSibling}function O(a){var c=a.shift();c?Q.loadAsDOM(c.path,function(d,e){e&&(E(e),aa(e.documentElement));c.handler(e);S.state===b.INVALID?d?runtime.log("ERROR: Unable to load "+c.path+" - "+d):runtime.log("ERROR: Unable to load "+c.path):(d&&runtime.log("DEBUG: Unable to load "+c.path+" - "+d),O(a))}):(f(S.rootElement),C(b.DONE))}function B(){O([{path:"styles.xml",handler:A},{path:"content.xml",
handler:K},{path:"meta.xml",handler:J},{path:"settings.xml",handler:H},{path:"META-INF/manifest.xml",handler:U}])}function X(a){var b="";odf.Namespaces.forEachPrefix(function(a,c){b+=" xmlns:"+a+'="'+c+'"'});return'<?xml version="1.0" encoding="UTF-8"?><office:'+a+" "+b+' office:version="1.2">'}function ga(){var a=new xmldom.LSSerializer,b=X("document-meta");a.filter=new odf.OdfNodeFilter;b+=a.writeToString(S.rootElement.meta,odf.Namespaces.namespaceMap);return b+"</office:document-meta>"}function ca(a,
b){var c=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");c.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",a);c.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:media-type",b);return c}function Z(){var a=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),b=a.documentElement,c=new xmldom.LSSerializer,
d;for(d in V)V.hasOwnProperty(d)&&b.appendChild(ca(d,V[d]));c.filter=new odf.OdfNodeFilter;return'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+c.writeToString(a,odf.Namespaces.namespaceMap)}function D(){var a,b,c,d=odf.Namespaces.namespaceMap,k=new xmldom.LSSerializer,g=X("document-styles");b=v(S.rootElement.automaticStyles,"document-styles");c=S.rootElement.masterStyles.cloneNode(!0);a=z(S.rootElement.fontFaceDecls,[c,S.rootElement.styles,b]);e.removePrefixFromStyleNames(b,r,c);k.filter=
new h(c,b);g+=k.writeToString(a,d);g+=k.writeToString(S.rootElement.styles,d);g+=k.writeToString(b,d);g+=k.writeToString(c,d);return g+"</office:document-styles>"}function T(){var a,b,c=odf.Namespaces.namespaceMap,e=new xmldom.LSSerializer,k=X("document-content");b=v(S.rootElement.automaticStyles,"document-content");a=z(S.rootElement.fontFaceDecls,[b]);e.filter=new d(S.rootElement.body,b);k+=e.writeToString(a,c);k+=e.writeToString(b,c);k+=e.writeToString(S.rootElement.body,c);return k+"</office:document-content>"}
function y(a,c){runtime.loadXML(a,function(a,d){if(a)c(a);else if(d){E(d);aa(d.documentElement);var e=u(d);e&&"document"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI?(I(e),C(b.DONE)):C(b.INVALID)}else c("No DOM was loaded.")})}function P(a,b){var d;d=S.rootElement;var e=d.meta;e||(d.meta=e=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),c(d,e));d=e;a&&m.mapKeyValObjOntoNode(d,a,odf.Namespaces.lookupNamespaceURI);b&&m.removeKeyElementsFromNode(d,
b,odf.Namespaces.lookupNamespaceURI)}function M(a){function c(a,b){var d;b||(b=a);d=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",b);k[a]=d;k.appendChild(d)}var d=new core.Zip("",null),e=runtime.byteArrayFromString("application/vnd.oasis.opendocument."+a,"utf8"),k=S.rootElement,g=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",a);d.save("mimetype",e,!1,new Date);c("meta");c("settings");c("scripts");c("fontFaceDecls","font-face-decls");c("styles");
c("automaticStyles","automatic-styles");c("masterStyles","master-styles");c("body");k.body.appendChild(g);V["/"]="application/vnd.oasis.opendocument."+a;V["settings.xml"]="text/xml";V["meta.xml"]="text/xml";V["styles.xml"]="text/xml";V["content.xml"]="text/xml";C(b.DONE);return d}function Y(a){var b=new core.Zip("",null);a=a.files;var c,d;for(c in a)a.hasOwnProperty(c)&&(d="string"===typeof a[c]?runtime.byteArrayFromString(a[c],"utf8"):a[c],b.save(c,d,!1,new Date));return b}function N(){var a,b=new Date,
c="";S.rootElement.settings&&S.rootElement.settings.firstElementChild&&(a=new xmldom.LSSerializer,c=X("document-settings"),a.filter=new odf.OdfNodeFilter,c+=a.writeToString(S.rootElement.settings,odf.Namespaces.namespaceMap),c+="</office:document-settings>");(a=c)?(a=runtime.byteArrayFromString(a,"utf8"),Q.save("settings.xml",a,!0,b)):Q.remove("settings.xml");c=runtime.getWindow();a="WebODF/"+webodf.Version;c&&(a=a+" "+c.navigator.userAgent);P({"meta:generator":a},null);a=runtime.byteArrayFromString(ga(),
"utf8");Q.save("meta.xml",a,!0,b);a=runtime.byteArrayFromString(D(),"utf8");Q.save("styles.xml",a,!0,b);a=runtime.byteArrayFromString(T(),"utf8");Q.save("content.xml",a,!0,b);a=runtime.byteArrayFromString(Z(),"utf8");Q.save("META-INF/manifest.xml",a,!0,b)}function da(a,b){N();Q.writeAs(a,function(a){b(a)})}var S=this,Q,V={},L,ia="",$={};this.onstatereadychange=l;this.state=this.onchange=null;this.getMetadata=w;this.setRootElement=I;this.getContentElement=function(){var a;L||(a=S.rootElement.body,
L=m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","text")||m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||m.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet"));if(!L)throw"Could not find content element in <office:body/>.";return L};this.getDocumentType=function(){var a=S.getContentElement();return a&&a.localName};this.getPart=function(a){return new odf.OdfPart(a,V[a],S,Q)};this.getPartData=function(a,b){Q.load(a,
b)};this.setMetadata=P;this.incrementEditingCycles=function(){var a=w(odf.Namespaces.metans,"editing-cycles"),a=a?parseInt(a,10):0;isNaN(a)&&(a=0);P({"meta:editing-cycles":a+1},null);return a+1};this.createByteArray=function(a,b){N();Q.createByteArray(a,b)};this.saveAs=da;this.save=function(a){da(ia,a)};this.getUrl=function(){return ia};this.setBlob=function(a,b,c){c=n.convertBase64ToByteArray(c);Q.save(a,c,!1,new Date);V.hasOwnProperty(a)&&runtime.log(a+" has been overwritten.");V[a]=b};this.removeBlob=
function(a){var b=Q.remove(a);runtime.assert(b,"file is not found: "+a);delete V[a]};this.state=b.LOADING;this.rootElement=function(a){var b=document.createElementNS(a.namespaceURI,a.localName),c;a=new a.Type;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName});a===odf.OdfContainer.DocumentType.TEXT?Q=M("text"):a===odf.OdfContainer.DocumentType.PRESENTATION?Q=M("presentation"):
a===odf.OdfContainer.DocumentType.SPREADSHEET?Q=M("spreadsheet"):($=a,$.type===odf.OdfContainer.DocumentType.OOX?(Q=Y($),B()):(ia=a,Q=new core.Zip(ia,function(a,c){Q=c;a?y(ia,function(c){a&&(Q.error=a+"\n"+c,C(b.INVALID))}):B()})))};odf.OdfContainer.EMPTY=0;odf.OdfContainer.LOADING=1;odf.OdfContainer.DONE=2;odf.OdfContainer.INVALID=3;odf.OdfContainer.SAVING=4;odf.OdfContainer.MODIFIED=5;odf.OdfContainer.getContainer=function(b){return new odf.OdfContainer(b,null)}})();
odf.OdfContainer.DocumentType={TEXT:1,PRESENTATION:2,SPREADSHEET:3,OOX:4};odf.OdfUtils=function(){function f(a){return"image"===(a&&a.localName)&&a.namespaceURI===aa}function h(a){return null!==a&&a.nodeType===Node.ELEMENT_NODE&&"frame"===a.localName&&a.namespaceURI===aa&&"as-char"===a.getAttributeNS(E,"anchor-type")}function d(a){var b;(b="annotation"===(a&&a.localName)&&a.namespaceURI===odf.Namespaces.officens)||(b="div"===(a&&a.localName)&&"annotationWrapper"===a.className);return b}function c(a){return"a"===(a&&a.localName)&&a.namespaceURI===E}function e(a){var b=a&&
a.localName;return("p"===b||"h"===b)&&a.namespaceURI===E}function m(a,b){for(a&&void 0!==b&&!e(a)&&a.childNodes.item(b)&&(a=a.childNodes.item(b));a&&!e(a);)a=a.parentNode;return a}function g(a,b){for(;a&&a!==b;){if(a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName)return a;a=a.parentElement}return null}function p(a){return/^[ \t\r\n]+$/.test(a)}function r(a){if(null===a||a.nodeType!==Node.ELEMENT_NODE)return!1;var b=a.localName;return/^(span|p|h|a|meta)$/.test(b)&&a.namespaceURI===
E||"span"===b&&"webodf-annotationHighlight"===a.className}function n(a){var b=a&&a.localName,c=!1;b&&(a=a.namespaceURI,a===E&&(c="s"===b||"tab"===b||"line-break"===b));return c}function q(a){return n(a)||h(a)||d(a)}function b(a){var b=a&&a.localName,c=!1;b&&(a=a.namespaceURI,a===E&&(c="s"===b));return c}function a(a){return-1!==ga.indexOf(a.namespaceURI)}function l(b){if(n(b))return!1;if(a(b.parentNode)&&b.nodeType===Node.TEXT_NODE)return 0===b.textContent.length;for(b=b.firstChild;b;){if(a(b)||!l(b))return!1;
b=b.nextSibling}return!0}function k(a){for(;null!==a.firstChild&&r(a);)a=a.firstChild;return a}function t(a){for(;null!==a.lastChild&&r(a);)a=a.lastChild;return a}function s(a){for(;!e(a)&&null===a.previousSibling;)a=a.parentNode;return e(a)?null:t(a.previousSibling)}function w(a){for(;!e(a)&&null===a.nextSibling;)a=a.parentNode;return e(a)?null:k(a.nextSibling)}function x(a){for(var c=!1;a;)if(a.nodeType===Node.TEXT_NODE)if(0===a.length)a=s(a);else return!p(a.data.substr(a.length-1,1));else q(a)?
(c=!1===b(a),a=null):a=s(a);return c}function v(a){var b=!1,c;for(a=a&&k(a);a;){c=a.nodeType===Node.TEXT_NODE?a.length:0;if(0<c&&!p(a.data)){b=!0;break}if(q(a)){b=!0;break}a=w(a)}return b}function z(a,b){return p(a.data.substr(b))?!v(w(a)):!1}function u(a,b){var c=a.data,d;if(!p(c[b])||q(a.parentNode))return!1;0<b?p(c[b-1])||(d=!0):x(s(a))&&(d=!0);return!0===d?z(a,b)?!1:!0:!1}function C(a){return(a=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(a))?
{value:parseFloat(a[1]),unit:a[3]}:null}function I(a){return(a=C(a))&&(0>a.value||"%"===a.unit)?null:a}function A(a){return(a=C(a))&&"%"!==a.unit?null:a}function K(a){switch(a.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return!1;case odf.Namespaces.textns:switch(a.localName){case "note-body":case "ruby-text":return!1}break;case odf.Namespaces.officens:switch(a.localName){case "annotation":case "binary-data":case "event-listeners":return!1}break;default:switch(a.localName){case "cursor":case "editinfo":return!1}}return!0}
function J(a,b){for(;0<b.length&&!X.rangeContainsNode(a,b[0]);)b.shift();for(;0<b.length&&!X.rangeContainsNode(a,b[b.length-1]);)b.pop()}function H(a,b,c){var e;e=X.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_REJECT;if(n(a.parentNode)||d(a))b=NodeFilter.FILTER_REJECT;else if(a.nodeType===Node.TEXT_NODE){if(c||Boolean(m(a)&&(!p(a.textContent)||u(a,0))))b=NodeFilter.FILTER_ACCEPT}else if(q(a))b=NodeFilter.FILTER_ACCEPT;else if(K(a)||r(a))b=NodeFilter.FILTER_SKIP;return b},NodeFilter.SHOW_ELEMENT|
NodeFilter.SHOW_TEXT);b||J(a,e);return e}function U(a,b,c){for(;a;){if(c(a)){b[0]!==a&&b.unshift(a);break}if(d(a))break;a=a.parentNode}}function W(a,b){var c=a;if(b<c.childNodes.length-1)c=c.childNodes[b+1];else{for(;!c.nextSibling;)c=c.parentNode;c=c.nextSibling}for(;c.firstChild;)c=c.firstChild;return c}var E=odf.Namespaces.textns,aa=odf.Namespaces.drawns,O=odf.Namespaces.xlinkns,B=/^\s*$/,X=new core.DomUtils,ga=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,odf.Namespaces.drawns,
odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns];this.isImage=f;this.isCharacterFrame=h;this.isInlineRoot=d;this.isTextSpan=function(a){return"span"===(a&&a.localName)&&a.namespaceURI===E};this.isHyperlink=c;this.getHyperlinkTarget=function(a){return a.getAttributeNS(O,"href")||""};this.isParagraph=e;this.getParagraphElement=m;this.isWithinTrackedChanges=
function(a,b){for(;a&&a!==b;){if(a.namespaceURI===E&&"tracked-changes"===a.localName)return!0;a=a.parentNode}return!1};this.getParentAnnotation=g;this.isWithinAnnotation=function(a,b){return Boolean(g(a,b))};this.getAnnotationCreator=function(a){return a.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0].textContent};this.isListItem=function(a){return"list-item"===(a&&a.localName)&&a.namespaceURI===E};this.isLineBreak=function(a){return"line-break"===(a&&a.localName)&&a.namespaceURI===E};this.isODFWhitespace=
p;this.isGroupingElement=r;this.isCharacterElement=n;this.isAnchoredAsCharacterElement=q;this.isSpaceElement=b;this.isODFNode=a;this.hasNoODFContent=l;this.firstChild=k;this.lastChild=t;this.previousNode=s;this.nextNode=w;this.scanLeftForNonSpace=x;this.lookLeftForCharacter=function(a){var b,c=b=0;a.nodeType===Node.TEXT_NODE&&(c=a.length);0<c?(b=a.data,b=p(b.substr(c-1,1))?1===c?x(s(a))?2:0:p(b.substr(c-2,1))?0:2:1):q(a)&&(b=1);return b};this.lookRightForCharacter=function(a){var b=!1,c=0;a&&a.nodeType===
Node.TEXT_NODE&&(c=a.length);0<c?b=!p(a.data.substr(0,1)):q(a)&&(b=!0);return b};this.scanLeftForAnyCharacter=function(a){var b=!1,c;for(a=a&&t(a);a;){c=a.nodeType===Node.TEXT_NODE?a.length:0;if(0<c&&!p(a.data)){b=!0;break}if(q(a)){b=!0;break}a=s(a)}return b};this.scanRightForAnyCharacter=v;this.isTrailingWhitespace=z;this.isSignificantWhitespace=u;this.isDowngradableSpaceElement=function(a){return b(a)?x(s(a))&&v(w(a)):!1};this.getFirstNonWhitespaceChild=function(a){for(a=a&&a.firstChild;a&&a.nodeType===
Node.TEXT_NODE&&B.test(a.nodeValue);)a=a.nextSibling;return a};this.parseLength=C;this.parseNonNegativeLength=I;this.parseFoFontSize=function(a){var b;b=(b=C(a))&&(0>=b.value||"%"===b.unit)?null:b;return b||A(a)};this.parseFoLineHeight=function(a){return I(a)||A(a)};this.isTextContentContainingNode=K;this.getTextNodes=function(a,b){var c;c=X.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_REJECT;a.nodeType===Node.TEXT_NODE?Boolean(m(a)&&(!p(a.textContent)||u(a,0)))&&(b=NodeFilter.FILTER_ACCEPT):
K(a)&&(b=NodeFilter.FILTER_SKIP);return b},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT);b||J(a,c);return c};this.getTextElements=H;this.getParagraphElements=function(a){var b;b=X.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_REJECT;if(e(a))b=NodeFilter.FILTER_ACCEPT;else if(K(a)||r(a))b=NodeFilter.FILTER_SKIP;return b},NodeFilter.SHOW_ELEMENT);U(a.startContainer,b,e);return b};this.getImageElements=function(a){var b;b=X.getNodesInRange(a,function(a){var b=NodeFilter.FILTER_SKIP;f(a)&&(b=
NodeFilter.FILTER_ACCEPT);return b},NodeFilter.SHOW_ELEMENT);U(a.startContainer,b,f);return b};this.getHyperlinkElements=function(a){var b=[],d=a.cloneRange();a.collapsed&&a.endContainer.nodeType===Node.ELEMENT_NODE&&(a=W(a.endContainer,a.endOffset),a.nodeType===Node.TEXT_NODE&&d.setEnd(a,1));H(d,!0,!1).forEach(function(a){for(a=a.parentNode;!e(a);){if(c(a)&&-1===b.indexOf(a)){b.push(a);break}a=a.parentNode}});d.detach();return b};this.getNormalizedFontFamilyName=function(a){/^(["'])(?:.|[\n\r])*?\1$/.test(a)||
(a=a.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,"$1"),/[ \t\r\n\f]/.test(a)&&(a="'"+a.replace(/[ \t\r\n\f]+/g," ")+"'"));return a}};gui.AnnotatableCanvas=function(){};gui.AnnotatableCanvas.prototype.refreshSize=function(){};gui.AnnotatableCanvas.prototype.getZoomLevel=function(){};gui.AnnotatableCanvas.prototype.getSizer=function(){};
gui.AnnotationViewManager=function(f,h,d,c){function e(a){var b=a.annotationEndElement,c=n.createRange(),d=a.getAttributeNS(odf.Namespaces.officens,"name");b&&(c.setStart(a,a.childNodes.length),c.setEnd(b,0),a=q.getTextNodes(c,!1),a.forEach(function(a){var b=n.createElement("span");b.className="webodf-annotationHighlight";b.setAttribute("annotation",d);a.parentNode.insertBefore(b,a);b.appendChild(a)}));c.detach()}function m(a){var c=f.getSizer();a?(d.style.display="inline-block",c.style.paddingRight=
b.getComputedStyle(d).width):(d.style.display="none",c.style.paddingRight=0);f.refreshSize()}function g(){r.sort(function(a,b){return 0!==(a.compareDocumentPosition(b)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1})}function p(){var a;for(a=0;a<r.length;a+=1){var b=r[a],c=b.parentNode,e=c.nextElementSibling,g=e.nextElementSibling,h=c.parentNode,m=0,m=r[r.indexOf(b)-1],q=void 0,b=f.getZoomLevel();c.style.left=(d.getBoundingClientRect().left-h.getBoundingClientRect().left)/b+"px";c.style.width=d.getBoundingClientRect().width/
b+"px";e.style.width=parseFloat(c.style.left)-30+"px";m&&(q=m.parentNode.getBoundingClientRect(),20>=(h.getBoundingClientRect().top-q.bottom)/b?c.style.top=Math.abs(h.getBoundingClientRect().top-q.bottom)/b+20+"px":c.style.top="0px");g.style.left=e.getBoundingClientRect().width/b+"px";var e=g.style,h=g.getBoundingClientRect().left/b,m=g.getBoundingClientRect().top/b,q=c.getBoundingClientRect().left/b,n=c.getBoundingClientRect().top/b,p=0,C=0,p=q-h,p=p*p,C=n-m,C=C*C,h=Math.sqrt(p+C);e.width=h+"px";
m=Math.asin((c.getBoundingClientRect().top-g.getBoundingClientRect().top)/(b*parseFloat(g.style.width)));g.style.transform="rotate("+m+"rad)";g.style.MozTransform="rotate("+m+"rad)";g.style.WebkitTransform="rotate("+m+"rad)";g.style.msTransform="rotate("+m+"rad)"}}var r=[],n=h.ownerDocument,q=new odf.OdfUtils,b=runtime.getWindow();runtime.assert(Boolean(b),"Expected to be run in an environment which has a global window, like a browser.");this.rerenderAnnotations=p;this.getMinimumHeightForAnnotationPane=
function(){return"none"!==d.style.display&&0<r.length?(r[r.length-1].parentNode.getBoundingClientRect().bottom-d.getBoundingClientRect().top)/f.getZoomLevel()+"px":null};this.addAnnotation=function(a){m(!0);r.push(a);g();var b=n.createElement("div"),d=n.createElement("div"),f=n.createElement("div"),h=n.createElement("div"),w;b.className="annotationWrapper";b.setAttribute("creator",q.getAnnotationCreator(a));a.parentNode.insertBefore(b,a);d.className="annotationNote";d.appendChild(a);c&&(w=n.createElement("div"),
w.className="annotationRemoveButton",d.appendChild(w));f.className="annotationConnector horizontal";h.className="annotationConnector angular";b.appendChild(d);b.appendChild(f);b.appendChild(h);a.annotationEndElement&&e(a);p()};this.forgetAnnotations=function(){for(;r.length;){var a=r[0],b=r.indexOf(a),c=a.parentNode.parentNode;"div"===c.localName&&(c.parentNode.insertBefore(a,c),c.parentNode.removeChild(c));for(var a=a.getAttributeNS(odf.Namespaces.officens,"name"),a=n.querySelectorAll('span.webodf-annotationHighlight[annotation="'+
a+'"]'),d=c=void 0,c=0;c<a.length;c+=1){for(d=a.item(c);d.firstChild;)d.parentNode.insertBefore(d.firstChild,d);d.parentNode.removeChild(d)}-1!==b&&r.splice(b,1);0===r.length&&m(!1)}}};(function(){function f(d,h,g,p,r){var n,q=0,b;for(b in d)if(d.hasOwnProperty(b)){if(q===g){n=b;break}q+=1}n?h.getPartData(d[n].href,function(a,b){if(a)runtime.log(a);else if(b){var k="@font-face { font-family: "+(d[n].family||n)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+c.convertUTF8ArrayToBase64(b)+') format("truetype"); }';try{p.insertRule(k,p.cssRules.length)}catch(q){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(q)+"\nRule: "+k)}}else runtime.log("missing font data for "+
d[n].href);f(d,h,g+1,p,r)}):r&&r()}var h=xmldom.XPath,d=new odf.OdfUtils,c=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(c,m){for(var g=c.rootElement.fontFaceDecls;m.cssRules.length;)m.deleteRule(m.cssRules.length-1);if(g){var p={},r,n,q,b;if(g)for(g=h.getODFElementsWithXPath(g,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),r=0;r<g.length;r+=1)n=g[r],q=n.getAttributeNS(odf.Namespaces.stylens,"name"),b=d.getNormalizedFontFamilyName(n.getAttributeNS(odf.Namespaces.svgns,
"font-family")),n=h.getODFElementsWithXPath(n,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI),0<n.length&&(n=n[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),p[q]={href:n,family:b});f(p,c,0,m)}}}})();odf.Formatting=function(){function f(a){return(a=C[a])?z.mergeObjects({},a):{}}function h(){for(var a=b.rootElement.fontFaceDecls,c={},d,e,a=a&&a.firstElementChild;a;){if(d=a.getAttributeNS(k,"name"))if((e=a.getAttributeNS(l,"font-family"))||0<a.getElementsByTagNameNS(l,"font-face-uri").length)c[d]=e;a=a.nextElementSibling}return c}function d(a){for(var c=b.rootElement.styles.firstElementChild;c;){if(c.namespaceURI===k&&"default-style"===c.localName&&c.getAttributeNS(k,"family")===a)return c;c=c.nextElementSibling}return null}
function c(a,c,d){var e,g,f;d=d||[b.rootElement.automaticStyles,b.rootElement.styles];for(f=0;f<d.length;f+=1)for(e=d[f],e=e.firstElementChild;e;){g=e.getAttributeNS(k,"name");if(e.namespaceURI===k&&"style"===e.localName&&e.getAttributeNS(k,"family")===c&&g===a||"list-style"===c&&e.namespaceURI===t&&"list-style"===e.localName&&g===a||"data"===c&&e.namespaceURI===s&&g===a)return e;e=e.nextElementSibling}return null}function e(a){for(var b,c,d,e,g={},f=a.firstElementChild;f;){if(f.namespaceURI===k)for(d=
g[f.nodeName]={},c=f.attributes,b=0;b<c.length;b+=1)e=c.item(b),d[e.name]=e.value;f=f.nextElementSibling}c=a.attributes;for(b=0;b<c.length;b+=1)e=c.item(b),g[e.name]=e.value;return g}function m(a,g){for(var l=b.rootElement.styles,h,m={},q=a.getAttributeNS(k,"family"),n=a;n;)h=e(n),m=z.mergeObjects(h,m),n=(h=n.getAttributeNS(k,"parent-style-name"))?c(h,q,[l]):null;if(n=d(q))h=e(n),m=z.mergeObjects(h,m);!1!==g&&(h=f(q),m=z.mergeObjects(h,m));return m}function g(b,c){function d(a){Object.keys(a).forEach(function(b){Object.keys(a[b]).forEach(function(a){f+=
"|"+b+":"+a+"|"})})}for(var e=b.nodeType===Node.TEXT_NODE?b.parentNode:b,k,g=[],f="",l=!1;e;)!l&&x.isGroupingElement(e)&&(l=!0),(k=a.determineStylesForNode(e))&&g.push(k),e=e.parentNode;l&&(g.forEach(d),c&&(c[f]=g));return l?g:void 0}function p(a){var d={orderedStyles:[]};a.forEach(function(a){Object.keys(a).forEach(function(e){var g=Object.keys(a[e])[0],f={name:g,family:e,displayName:void 0,isCommonStyle:!1},l;(l=c(g,e))?(e=m(l),d=z.mergeObjects(e,d),f.displayName=l.getAttributeNS(k,"display-name")||
void 0,f.isCommonStyle=l.parentNode===b.rootElement.styles):runtime.log("No style element found for '"+g+"' of family '"+e+"'");d.orderedStyles.push(f)})});return d}function r(a,b){var c={},d=[];b||(b={});a.forEach(function(a){g(a,c)});Object.keys(c).forEach(function(a){b[a]||(b[a]=p(c[a]));d.push(b[a])});return d}function n(a){for(var c=b.rootElement.masterStyles.firstElementChild;c&&(c.namespaceURI!==k||"master-page"!==c.localName||c.getAttributeNS(k,"name")!==a);)c=c.nextElementSibling;return c}
function q(a,b){var c;a&&(c=u.convertMeasure(a,"px"));void 0===c&&b&&(c=u.convertMeasure(b,"px"));return c}var b,a=new odf.StyleInfo,l=odf.Namespaces.svgns,k=odf.Namespaces.stylens,t=odf.Namespaces.textns,s=odf.Namespaces.numberns,w=odf.Namespaces.fons,x=new odf.OdfUtils,v=new core.DomUtils,z=new core.Utils,u=new core.CSSUnits,C={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.getSystemDefaultStyleAttributes=f;this.setOdfContainer=function(a){b=a};this.getFontMap=h;this.getAvailableParagraphStyles=
function(){for(var a=b.rootElement.styles,c,d,e=[],a=a&&a.firstElementChild;a;)"style"===a.localName&&a.namespaceURI===k&&(c=a.getAttributeNS(k,"family"),"paragraph"===c&&(c=a.getAttributeNS(k,"name"),d=a.getAttributeNS(k,"display-name")||c,c&&d&&e.push({name:c,displayName:d}))),a=a.nextElementSibling;return e};this.isStyleUsed=function(c){var d,e=b.rootElement;d=a.hasDerivedStyles(e,odf.Namespaces.lookupNamespaceURI,c);c=(new a.UsedStyleList(e.styles)).uses(c)||(new a.UsedStyleList(e.automaticStyles)).uses(c)||
(new a.UsedStyleList(e.body)).uses(c);return d||c};this.getDefaultStyleElement=d;this.getStyleElement=c;this.getStyleAttributes=e;this.getInheritedStyleAttributes=m;this.getFirstCommonParentStyleNameOrSelf=function(a){var d=b.rootElement.styles,e;if(e=c(a,"paragraph",[b.rootElement.automaticStyles]))if(a=e.getAttributeNS(k,"parent-style-name"),!a)return null;return(e=c(a,"paragraph",[d]))?a:null};this.hasParagraphStyle=function(a){return Boolean(c(a,"paragraph"))};this.getAppliedStyles=r;this.getAppliedStylesForElement=
function(a,b){return r([a],b)[0]};this.updateStyle=function(a,c){var d,e;v.mapObjOntoNode(a,c,odf.Namespaces.lookupNamespaceURI);(d=c["style:text-properties"]&&c["style:text-properties"]["style:font-name"])&&!h().hasOwnProperty(d)&&(e=a.ownerDocument.createElementNS(k,"style:font-face"),e.setAttributeNS(k,"style:name",d),e.setAttributeNS(l,"svg:font-family",d),b.rootElement.fontFaceDecls.appendChild(e))};this.createDerivedStyleObject=function(a,d,k){var g=c(a,d);runtime.assert(Boolean(g),"No style element found for '"+
a+"' of family '"+d+"'");a=g.parentNode===b.rootElement.styles?{"style:parent-style-name":a}:e(g);a["style:family"]=d;z.mergeObjects(a,k);return a};this.getDefaultTabStopDistance=function(){for(var a=d("paragraph"),a=a&&a.firstElementChild,b;a;)a.namespaceURI===k&&"paragraph-properties"===a.localName&&(b=a.getAttributeNS(k,"tab-stop-distance")),a=a.nextElementSibling;b||(b="1.25cm");return x.parseNonNegativeLength(b)};this.getMasterPageElement=n;this.getContentSize=function(a,d){var e,g,f,l,h,m,p,
r,t,s;a:{g=c(a,d);runtime.assert("paragraph"===d||"table"===d,"styleFamily must be either paragraph or table");if(g){if(g=g.getAttributeNS(k,"master-page-name"))(e=n(g))||runtime.log("WARN: No master page definition found for "+g);e||(e=n("Standard"));e||(e=b.rootElement.masterStyles.getElementsByTagNameNS(k,"master-page")[0])||runtime.log("WARN: Document has no master pages defined");if(e)for(g=e.getAttributeNS(k,"page-layout-name"),f=v.getElementsByTagNameNS(b.rootElement.automaticStyles,k,"page-layout"),
l=0;l<f.length;l+=1)if(e=f[l],e.getAttributeNS(k,"name")===g)break a}e=null}e||(e=v.getDirectChild(b.rootElement.styles,k,"default-page-layout"));(e=v.getDirectChild(e,k,"page-layout-properties"))?("landscape"===e.getAttributeNS(k,"print-orientation")?(g="29.7cm",f="21.001cm"):(g="21.001cm",f="29.7cm"),g=q(e.getAttributeNS(w,"page-width"),g),f=q(e.getAttributeNS(w,"page-height"),f),l=q(e.getAttributeNS(w,"margin")),void 0===l?(l=q(e.getAttributeNS(w,"margin-left"),"2cm"),h=q(e.getAttributeNS(w,"margin-right"),
"2cm"),m=q(e.getAttributeNS(w,"margin-top"),"2cm"),p=q(e.getAttributeNS(w,"margin-bottom"),"2cm")):l=h=m=p=l,r=q(e.getAttributeNS(w,"padding")),void 0===r?(r=q(e.getAttributeNS(w,"padding-left"),"0cm"),t=q(e.getAttributeNS(w,"padding-right"),"0cm"),s=q(e.getAttributeNS(w,"padding-top"),"0cm"),e=q(e.getAttributeNS(w,"padding-bottom"),"0cm")):r=t=s=e=r):(g=q("21.001cm"),f=q("29.7cm"),l=h=m=p=l=q("2cm"),r=t=s=e=r=q("0cm"));return{width:g-l-h-r-t,height:f-m-p-s-e}}};(function(){var f=odf.Namespaces.stylens,h=odf.Namespaces.textns,d={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(c){this.derivedStyles={};this.element=c};odf.StyleTree=function(c,e){function m(c){var b,a,d,e={};if(!c)return e;for(c=c.firstElementChild;c;){if(a=c.namespaceURI!==f||"style"!==c.localName&&
"default-style"!==c.localName?c.namespaceURI===h&&"list-style"===c.localName?"list":c.namespaceURI!==f||"page-layout"!==c.localName&&"default-page-layout"!==c.localName?void 0:"page":c.getAttributeNS(f,"family"))(b=c.getAttributeNS(f,"name"))||(b=""),e.hasOwnProperty(a)?d=e[a]:e[a]=d={},d[b]=c;c=c.nextElementSibling}return e}function g(c,b){if(c.hasOwnProperty(b))return c[b];var a=null,d=Object.keys(c),e;for(e=0;e<d.length&&!(a=g(c[d[e]].derivedStyles,b));e+=1);return a}function p(c,b,a){var d,e,
h;if(!b.hasOwnProperty(c))return null;d=new odf.StyleTreeNode(b[c]);e=d.element.getAttributeNS(f,"parent-style-name");h=null;e&&(h=g(a,e)||p(e,b,a));h?h.derivedStyles[c]=d:a[c]=d;delete b[c];return d}function r(c,b){c&&Object.keys(c).forEach(function(a){p(a,c,b)})}var n={};this.getStyleTree=function(){return n};(function(){var g,b,a;b=m(c);a=m(e);Object.keys(d).forEach(function(c){g=n[c]={};r(b[c],g);r(a[c],g)})})()}})();(function(){var f=odf.Namespaces.fons,h=odf.Namespaces.stylens,d=odf.Namespaces.textns,c={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function e(c){var b=n.parseLength(c);return b?r.convert(b.value,b.unit,"px"):(runtime.log("Could not parse value '"+c+"'."),0)}function m(c,b){try{c.insertRule(b,c.cssRules.length)}catch(a){runtime.log("cannot load rule: "+b+" - "+a)}}function g(c){return c.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function p(c,
b,a,g){b='text|list[text|style-name="'+b+'"]';for(var k=a.getAttributeNS(d,"level"),n,p,r,x,v,z,k=k&&parseInt(k,10);1<k;)b+=" > text|list-item > text|list",k-=1;(k=a.getElementsByTagNameNS(h,"list-level-properties")[0])?(n=k.getAttributeNS(d,"list-level-position-and-space-mode"),r=k.getAttributeNS(f,"text-align")||"left","label-alignment"===n?(p=k.getElementsByTagNameNS(h,"list-level-label-alignment")[0],a=p.getAttributeNS(f,"margin-left")||"0px",z=p.getAttributeNS(f,"text-indent")||"0px",p=p.getAttributeNS(d,
"label-followed-by"),k=e(a)):(a=k.getAttributeNS(d,"space-before")||"0px",x=k.getAttributeNS(d,"min-label-width")||"0px",v=k.getAttributeNS(d,"min-label-distance")||"0px",k=e(a)+e(x))):(v=x="0px",k=e("0px")+e(x));switch(r){case "end":r="right";break;case "start":r="left"}a=b+" > text|list-item{";a+="margin-left: "+k+"px;";a+="}";m(c,a);a=b+" > text|list-item > text|list{";a+="margin-left: "+-k+"px;";a+="}";m(c,a);a=b+" > text|list-item > *:not(text|list):first-child:before{";a+="text-align: "+r+";";
a+="counter-increment:list;";a+="display: inline-block;";"label-alignment"===n?(a+="margin-left: "+z+";","space"===p?g+=" '\\a0'":"listtab"===p&&(a+="padding-right: 0.2cm;")):(a+="min-width: "+x+";",a+="margin-left: -"+x+";",a+="padding-right: "+v+";");a+="\n"+g+";\n";a+="}";m(c,a)}var r=new core.CSSUnits,n=new odf.OdfUtils;this.applyListStyles=function(e,b){var a,f;(a=b.list)&&Object.keys(a).forEach(function(b){f=a[b];for(var m=f.element.firstChild,n,r;m;){if(m.namespaceURI===d)if(n=m,"list-level-style-number"===
m.localName){var x=n;r=x.getAttributeNS(h,"num-format");var v=x.getAttributeNS(h,"num-suffix")||"",x=x.getAttributeNS(h,"num-prefix")||"",z="";x&&(z+='"'+g(x)+'"\n');z=c.hasOwnProperty(r)?z+(" counter(list, "+c[r]+")"):r?z+(' "'+r+'"'):z+' ""';r="content:"+z+' "'+g(v)+'"';p(e,b,n,r)}else"list-level-style-image"===m.localName?(r="content: none",p(e,b,n,r)):"list-level-style-bullet"===m.localName&&(r=n.getAttributeNS(d,"bullet-char"),r='content: "'+g(r)+'"',p(e,b,n,r));m=m.nextSibling}})}}})();odf.Style2CSS=function(){function f(a,b,c){var d=[];c=c.derivedStyles;var e;var g=k[a],l;void 0===g?b=null:(l=b?"["+g+'|style-name="'+b+'"]':"","presentation"===g&&(g="draw",l=b?'[presentation|style-name="'+b+'"]':""),b=g+"|"+t[a].join(l+","+g+"|")+l);null!==b&&d.push(b);for(e in c)c.hasOwnProperty(e)&&(b=f(a,e,c[e]),d=d.concat(b));return d}function h(a,b){var c="",d,e,k;for(d=0;d<b.length;d+=1)if(e=b[d],k=a.getAttributeNS(e[0],e[1])){k=k.trim();if(J.hasOwnProperty(e[1])){var g=k.indexOf(" "),f=void 0,
l=void 0;-1!==g?(f=k.substring(0,g),l=k.substring(g)):(f=k,l="");(f=U.parseLength(f))&&"pt"===f.unit&&0.75>f.value&&(k="0.75pt"+l)}e[2]&&(c+=e[2]+":"+k+";")}return c}function d(a){return(a=l.getDirectChild(a,r,"text-properties"))?U.parseFoFontSize(a.getAttributeNS(g,"font-size")):null}function c(a,b,c,d){return b+b+c+c+d+d}function e(k,n,t,J){if("page"===n){var D=J.element;t="";var T,y;y=T="";var P=l.getDirectChild(D,r,"page-layout-properties"),M;if(P)if(M=D.getAttributeNS(r,"name"),t+=h(P,A),(T=
l.getDirectChild(P,r,"background-image"))&&(y=T.getAttributeNS(b,"href"))&&(t=t+("background-image: url('odfkit:"+y+"');")+h(T,w)),"presentation"===W)for(D=(D=l.getDirectChild(D.parentNode.parentNode,p,"master-styles"))&&D.firstElementChild;D;)D.namespaceURI===r&&"master-page"===D.localName&&D.getAttributeNS(r,"page-layout-name")===M&&(y=D.getAttributeNS(r,"name"),T="draw|page[draw|master-page-name="+y+"] {"+t+"}",y="office|body, draw|page[draw|master-page-name="+y+"] {"+h(P,K)+" }",k.insertRule(T,
k.cssRules.length),k.insertRule(y,k.cssRules.length)),D=D.nextElementSibling;else"text"===W&&(T="office|text {"+t+"}",y="office|body {width: "+P.getAttributeNS(g,"page-width")+";}",k.insertRule(T,k.cssRules.length),k.insertRule(y,k.cssRules.length))}else{t=f(n,t,J).join(",");P="";if(M=l.getDirectChild(J.element,r,"text-properties")){y=M;var Y,N,D=Y="";T=1;M=""+h(y,s);N=y.getAttributeNS(r,"text-underline-style");"solid"===N&&(Y+=" underline");N=y.getAttributeNS(r,"text-line-through-style");"solid"===
N&&(Y+=" line-through");Y.length&&(M+="text-decoration:"+Y+";");if(Y=y.getAttributeNS(r,"font-name")||y.getAttributeNS(g,"font-family"))N=H[Y],M+="font-family: "+(N||Y)+";";N=y.parentNode;if(y=d(N)){for(;N;){if(y=d(N)){if("%"!==y.unit){D="font-size: "+y.value*T+y.unit+";";break}T*=y.value/100}y=N;Y=N="";N=null;"default-style"===y.localName?N=null:(N=y.getAttributeNS(r,"parent-style-name"),Y=y.getAttributeNS(r,"family"),N=O.getODFElementsWithXPath(E,N?"//style:*[@style:name='"+N+"'][@style:family='"+
Y+"']":"//style:default-style[@style:family='"+Y+"']",odf.Namespaces.lookupNamespaceURI)[0])}D||(D="font-size: "+parseFloat(aa)*T+B.getUnits(aa)+";");M+=D}P+=M}if(M=l.getDirectChild(J.element,r,"paragraph-properties"))D=M,M=""+h(D,x),(T=l.getDirectChild(D,r,"background-image"))&&(y=T.getAttributeNS(b,"href"))&&(M=M+("background-image: url('odfkit:"+y+"');")+h(T,w)),(D=D.getAttributeNS(g,"line-height"))&&"normal"!==D&&(D=U.parseFoLineHeight(D),M="%"!==D.unit?M+("line-height: "+D.value+D.unit+";"):
M+("line-height: "+D.value/100+";")),P+=M;if(M=l.getDirectChild(J.element,r,"graphic-properties"))y=M,M=""+h(y,v),D=y.getAttributeNS(m,"opacity"),T=y.getAttributeNS(m,"fill"),y=y.getAttributeNS(m,"fill-color"),"solid"===T||"hatch"===T?y&&"none"!==y?(D=isNaN(parseFloat(D))?1:parseFloat(D)/100,T=y.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,c),(y=(T=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(T))?{r:parseInt(T[1],16),g:parseInt(T[2],16),b:parseInt(T[3],16)}:null)&&(M+="background-color: rgba("+
y.r+","+y.g+","+y.b+","+D+");")):M+="background: none;":"none"===T&&(M+="background: none;"),P+=M;if(M=l.getDirectChild(J.element,r,"drawing-page-properties"))D=""+h(M,v),"true"===M.getAttributeNS(a,"background-visible")&&(D+="background: none;"),P+=D;if(M=l.getDirectChild(J.element,r,"table-cell-properties"))M=""+h(M,z),P+=M;if(M=l.getDirectChild(J.element,r,"table-row-properties"))M=""+h(M,C),P+=M;if(M=l.getDirectChild(J.element,r,"table-column-properties"))M=""+h(M,u),P+=M;if(M=l.getDirectChild(J.element,
r,"table-properties"))D=M,M=""+h(D,I),D=D.getAttributeNS(q,"border-model"),"collapsing"===D?M+="border-collapse:collapse;":"separating"===D&&(M+="border-collapse:separate;"),P+=M;0!==P.length&&k.insertRule(t+"{"+P+"}",k.cssRules.length)}for(var da in J.derivedStyles)J.derivedStyles.hasOwnProperty(da)&&e(k,n,da,J.derivedStyles[da])}var m=odf.Namespaces.drawns,g=odf.Namespaces.fons,p=odf.Namespaces.officens,r=odf.Namespaces.stylens,n=odf.Namespaces.svgns,q=odf.Namespaces.tablens,b=odf.Namespaces.xlinkns,
a=odf.Namespaces.presentationns,l=new core.DomUtils,k={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},t={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),
presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background",
"table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),
list:["list-item"]},s=[[g,"color","color"],[g,"background-color","background-color"],[g,"font-weight","font-weight"],[g,"font-style","font-style"]],w=[[r,"repeat","background-repeat"]],x=[[g,"background-color","background-color"],[g,"text-align","text-align"],[g,"text-indent","text-indent"],[g,"padding","padding"],[g,"padding-left","padding-left"],[g,"padding-right","padding-right"],[g,"padding-top","padding-top"],[g,"padding-bottom","padding-bottom"],[g,"border-left","border-left"],[g,"border-right",
"border-right"],[g,"border-top","border-top"],[g,"border-bottom","border-bottom"],[g,"margin","margin"],[g,"margin-left","margin-left"],[g,"margin-right","margin-right"],[g,"margin-top","margin-top"],[g,"margin-bottom","margin-bottom"],[g,"border","border"]],v=[[g,"background-color","background-color"],[g,"min-height","min-height"],[m,"stroke","border"],[n,"stroke-color","border-color"],[n,"stroke-width","border-width"],[g,"border","border"],[g,"border-left","border-left"],[g,"border-right","border-right"],
[g,"border-top","border-top"],[g,"border-bottom","border-bottom"]],z=[[g,"background-color","background-color"],[g,"border-left","border-left"],[g,"border-right","border-right"],[g,"border-top","border-top"],[g,"border-bottom","border-bottom"],[g,"border","border"]],u=[[r,"column-width","width"]],C=[[r,"row-height","height"],[g,"keep-together",null]],I=[[r,"width","width"],[g,"margin-left","margin-left"],[g,"margin-right","margin-right"],[g,"margin-top","margin-top"],[g,"margin-bottom","margin-bottom"]],
A=[[g,"background-color","background-color"],[g,"padding","padding"],[g,"padding-left","padding-left"],[g,"padding-right","padding-right"],[g,"padding-top","padding-top"],[g,"padding-bottom","padding-bottom"],[g,"border","border"],[g,"border-left","border-left"],[g,"border-right","border-right"],[g,"border-top","border-top"],[g,"border-bottom","border-bottom"],[g,"margin","margin"],[g,"margin-left","margin-left"],[g,"margin-right","margin-right"],[g,"margin-top","margin-top"],[g,"margin-bottom","margin-bottom"]],
K=[[g,"page-width","width"],[g,"page-height","height"]],J={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,"stroke-width":!0},H={},U=new odf.OdfUtils,W,E,aa,O=xmldom.XPath,B=new core.CSSUnits;this.style2css=function(a,b,c,d,g){var f,l,h;for(E=b;c.cssRules.length;)c.deleteRule(c.cssRules.length-1);odf.Namespaces.forEachPrefix(function(a,b){f="@namespace "+a+" url("+b+");";try{c.insertRule(f,c.cssRules.length)}catch(d){}});H=d;W=a;aa=runtime.getWindow().getComputedStyle(document.body,
null).getPropertyValue("font-size")||"12pt";for(h in k)if(k.hasOwnProperty(h))for(l in a=g[h],a)a.hasOwnProperty(l)&&e(c,h,l,a[l])}};(function(){function f(h,d){var c=this;this.getDistance=function(d){var f=c.x-d.x;d=c.y-d.y;return Math.sqrt(f*f+d*d)};this.getCenter=function(d){return new f((c.x+d.x)/2,(c.y+d.y)/2)};c.x=h;c.y=d}gui.ZoomHelper=function(){function h(a,b,c,d){a=d?"translate3d("+a+"px, "+b+"px, 0) scale3d("+c+", "+c+", 1)":"translate("+a+"px, "+b+"px) scale("+c+")";n.style.WebkitTransform=a;n.style.MozTransform=a;n.style.msTransform=a;n.style.OTransform=a;n.style.transform=a}function d(b){b?h(-q.x,-q.y,a,!0):(h(0,
0,a,!0),h(0,0,a,!1))}function c(a){if(l&&x){var b=l.style.overflow,c=l.classList.contains("webodf-customScrollbars");a&&c||!a&&!c||(a?(l.classList.add("webodf-customScrollbars"),l.style.overflow="hidden",runtime.requestAnimationFrame(function(){l.style.overflow=b})):l.classList.remove("webodf-customScrollbars"))}}function e(a){return new f(a.pageX-n.offsetLeft,a.pageY-n.offsetTop)}function m(a){var c=a.touches.length,d=0<c?e(a.touches[0]):null;a=1<c?e(a.touches[1]):null;d&&a?(b=d,w=s.PINCH):d&&(b=
d,w=s.SCROLL)}function g(d){var g=d.touches.length,m=0<g?e(d.touches[0]):null,g=1<g?e(d.touches[1]):null;m&&g?(d.preventDefault(),w===s.SCROLL&&(w=s.PINCH)):m&&(w===s.PINCH?(w=s.SCROLL,h(0,0,a,!0),l.scrollLeft=q.x,l.scrollTop=q.y,k.style.overflow=v||"",c(!0)):(b&&(q.x-=m.x-b.x,q.y-=m.y-b.y,q=new f(Math.min(Math.max(q.x,n.offsetLeft),(n.offsetLeft+n.offsetWidth)*a-l.clientWidth),Math.min(Math.max(q.y,n.offsetTop),(n.offsetTop+n.offsetHeight)*a-l.clientHeight)),l.scrollLeft=q.x,l.scrollTop=q.y),b=m))}
function p(){w=s.NONE}function r(){l&&(l.removeEventListener("touchstart",m,!1),l.removeEventListener("touchmove",g,!1),l.removeEventListener("touchend",p,!1))}var n,q,b,a,l,k,t=new core.EventNotifier([gui.ZoomHelper.signalZoomChanged]),s={NONE:0,SCROLL:1,PINCH:2},w=s.NONE,x=runtime.getWindow().hasOwnProperty("ontouchstart"),v="";this.subscribe=function(a,b){t.subscribe(a,b)};this.unsubscribe=function(a,b){t.unsubscribe(a,b)};this.getZoomLevel=function(){return a};this.setZoomLevel=function(b){n&&
(a=b,d(!1),t.emit(gui.ZoomHelper.signalZoomChanged,a))};this.destroy=function(a){r();c(!1);a()};this.setZoomableElement=function(a){r();n=a;l=n.offsetParent;k=n.parentElement;d(!1);l&&(l.addEventListener("touchstart",m,!1),l.addEventListener("touchmove",g,!1),l.addEventListener("touchend",p,!1));c(!0)};a=1;q=new f(0,0)};gui.ZoomHelper.signalZoomChanged="zoomChanged"})();ops.Canvas=function(){};ops.Canvas.prototype.getZoomLevel=function(){};ops.Canvas.prototype.getElement=function(){};ops.Canvas.prototype.getSizer=function(){};ops.Canvas.prototype.getZoomHelper=function(){};(function(){function f(){function a(d){c=!0;runtime.setTimeout(function(){try{d()}catch(e){runtime.log(String(e))}c=!1;0<b.length&&a(b.pop())},10)}var b=[],c=!1;this.clearQueue=function(){b.length=0};this.addToQueue=function(d){if(0===b.length&&!c)return a(d);b.push(d)}}function h(a){function b(){for(;0<c.cssRules.length;)c.deleteRule(0);c.insertRule("#shadowContent draw|page {display:none;}",0);c.insertRule("office|presentation draw|page {display:none;}",1);c.insertRule("#shadowContent draw|page:nth-of-type("+
d+") {display:block;}",2);c.insertRule("office|presentation draw|page:nth-of-type("+d+") {display:block;}",3)}var c=a.sheet,d=1;this.showFirstPage=function(){d=1;b()};this.showNextPage=function(){d+=1;b()};this.showPreviousPage=function(){1<d&&(d-=1,b())};this.showPage=function(a){0<a&&(d=a,b())};this.css=a;this.destroy=function(b){a.parentNode.removeChild(a);b()}}function d(a){for(;a.firstChild;)a.removeChild(a.firstChild)}function c(a){a=a.sheet;for(var b=a.cssRules;b.length;)a.deleteRule(b.length-
1)}function e(a,b,c){var d=new odf.Style2CSS,e=new odf.ListStyleToCss;c=c.sheet;var k=(new odf.StyleTree(a.rootElement.styles,a.rootElement.automaticStyles)).getStyleTree();d.style2css(a.getDocumentType(),a.rootElement,c,b.getFontMap(),k);e.applyListStyles(c,k)}function m(a,b){(new odf.FontLoader).loadFonts(a,b.sheet)}function g(a,b,c){var d=null;a=a.rootElement.body.getElementsByTagNameNS(W,c+"-decl");c=b.getAttributeNS(W,"use-"+c+"-name");var e;if(c&&0<a.length)for(b=0;b<a.length;b+=1)if(e=a[b],
e.getAttributeNS(W,"name")===c){d=e.textContent;break}return d}function p(a,b,c,e){var k=a.ownerDocument;b=a.getElementsByTagNameNS(b,c);for(a=0;a<b.length;a+=1)d(b[a]),e&&(c=b[a],c.appendChild(k.createTextNode(e)))}function r(a,b,c){b.setAttributeNS("urn:webodf:names:helper","styleid",a);var d,e=b.getAttributeNS(J,"anchor-type"),k=b.getAttributeNS(A,"x"),g=b.getAttributeNS(A,"y"),f=b.getAttributeNS(A,"width"),l=b.getAttributeNS(A,"height"),h=b.getAttributeNS(u,"min-height"),m=b.getAttributeNS(u,
"min-width");if("as-char"===e)d="display: inline-block;";else if(e||k||g)d="position: absolute;";else if(f||l||h||m)d="display: block;";k&&(d+="left: "+k+";");g&&(d+="top: "+g+";");f&&(d+="width: "+f+";");l&&(d+="height: "+l+";");h&&(d+="min-height: "+h+";");m&&(d+="min-width: "+m+";");d&&(d="draw|"+b.localName+'[webodfhelper|styleid="'+a+'"] {'+d+"}",c.insertRule(d,c.cssRules.length))}function n(a){for(a=a.firstChild;a;){if(a.namespaceURI===C&&"binary-data"===a.localName)return"data:image/png;base64,"+
a.textContent.replace(/[\r\n\s]/g,"");a=a.nextSibling}return""}function q(a,b,c,d){function e(b){b&&(b='draw|image[webodfhelper|styleid="'+a+'"] {'+("background-image: url("+b+");")+"}",d.insertRule(b,d.cssRules.length))}function k(a){e(a.url)}c.setAttributeNS("urn:webodf:names:helper","styleid",a);var g=c.getAttributeNS(H,"href"),f;if(g)try{f=b.getPart(g),f.onchange=k,f.load()}catch(l){runtime.log("slight problem: "+String(l))}else g=n(c),e(g)}function b(a){var b=a.ownerDocument;B.getElementsByTagNameNS(a,
J,"line-break").forEach(function(a){a.hasChildNodes()||a.appendChild(b.createElement("br"))})}function a(a){var b=a.ownerDocument;B.getElementsByTagNameNS(a,J,"s").forEach(function(a){for(var c,d;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(b.createTextNode(" "));d=parseInt(a.getAttributeNS(J,"c"),10);if(1<d)for(a.removeAttributeNS(J,"c"),c=1;c<d;c+=1)a.parentNode.insertBefore(a.cloneNode(!0),a)})}function l(a){B.getElementsByTagNameNS(a,J,"tab").forEach(function(a){a.textContent="\t"})}
function k(a,b){function c(a,d){var g=f.documentElement.namespaceURI;"video/"===d.substr(0,6)?(e=f.createElementNS(g,"video"),e.setAttribute("controls","controls"),k=f.createElementNS(g,"source"),a&&k.setAttribute("src",a),k.setAttribute("type",d),e.appendChild(k),b.parentNode.appendChild(e)):b.innerHtml="Unrecognised Plugin"}function d(a){c(a.url,a.mimetype)}var e,k,g,f=b.ownerDocument,l;if(g=b.getAttributeNS(H,"href"))try{l=a.getPart(g),l.onchange=d,l.load()}catch(h){runtime.log("slight problem: "+
String(h))}else runtime.log("using MP4 data fallback"),g=n(b),c(g,"video/mp4")}function t(a,b){try{a.insertRule(b,a.cssRules.length)}catch(c){runtime.log("cannot load rule: "+b+" - "+c)}}function s(a){return a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function w(a){var b=a.getElementsByTagName("head")[0],c,d;c=a.styleSheets.length;for(d=b.firstElementChild;d&&("style"!==d.localName||!d.hasAttribute("webodfcss"));)d=d.nextElementSibling;if(d)return c=parseInt(d.getAttribute("webodfcss"),10),d.setAttribute("webodfcss",
c+1),d;"string"===String(typeof webodf_css)?c=webodf_css:(d="webodf.css",runtime.currentDirectory&&(d=runtime.currentDirectory(),0<d.length&&"/"!==d.substr(-1)&&(d+="/"),d+="../webodf.css"),c=runtime.readFileSync(d,"utf-8"));d=a.createElementNS(b.namespaceURI,"style");d.setAttribute("media","screen, print, handheld, projection");d.setAttribute("type","text/css");d.setAttribute("webodfcss","1");d.appendChild(a.createTextNode(c));b.appendChild(d);return d}function x(a){var b=parseInt(a.getAttribute("webodfcss"),
10);1===b?a.parentNode.removeChild(a):a.setAttribute("count",b-1)}function v(a){var b=a.getElementsByTagName("head")[0],c=a.createElementNS(b.namespaceURI,"style"),d="";c.setAttribute("type","text/css");c.setAttribute("media","screen, print, handheld, projection");odf.Namespaces.forEachPrefix(function(a,b){d+="@namespace "+a+" url("+b+");\n"});d+="@namespace webodfhelper url(urn:webodf:names:helper);\n";c.appendChild(a.createTextNode(d));b.appendChild(c);return c}var z=odf.Namespaces.drawns,u=odf.Namespaces.fons,
C=odf.Namespaces.officens,I=odf.Namespaces.stylens,A=odf.Namespaces.svgns,K=odf.Namespaces.tablens,J=odf.Namespaces.textns,H=odf.Namespaces.xlinkns,U=odf.Namespaces.xmlns,W=odf.Namespaces.presentationns,E=runtime.getWindow(),aa=xmldom.XPath,O=new odf.OdfUtils,B=new core.DomUtils;odf.OdfCanvas=function(n){function A(a,b,c){function d(a,b,c,e){ma.addToQueue(function(){q(a,b,c,e)})}var e,k;e=b.getElementsByTagNameNS(z,"image");for(b=0;b<e.length;b+=1)k=e.item(b),d("image"+String(b),a,k,c)}function u(a,
b){function c(a,b){ma.addToQueue(function(){k(a,b)})}var d,e,g;e=b.getElementsByTagNameNS(z,"plugin");for(d=0;d<e.length;d+=1)g=e.item(d),c(a,g)}function H(){var a;a=Q.firstChild;var b=fa.getZoomLevel();a&&(Q.style.WebkitTransformOrigin="0% 0%",Q.style.MozTransformOrigin="0% 0%",Q.style.msTransformOrigin="0% 0%",Q.style.OTransformOrigin="0% 0%",Q.style.transformOrigin="0% 0%",$&&((a=$.getMinimumHeightForAnnotationPane())?Q.style.minHeight=a:Q.style.removeProperty("min-height")),n.style.width=Math.round(b*
Q.offsetWidth)+"px",n.style.height=Math.round(b*Q.offsetHeight)+"px",n.style.display="inline-block")}function D(c,e){var k=ka.sheet;d(n);Q=Y.createElementNS(n.namespaceURI,"div");Q.style.display="inline-block";Q.style.background="white";Q.style.setProperty("float","left","important");Q.appendChild(e);n.appendChild(Q);V=Y.createElementNS(n.namespaceURI,"div");V.id="annotationsPane";ha=Y.createElementNS(n.namespaceURI,"div");ha.id="shadowContent";ha.style.position="absolute";ha.style.top=0;ha.style.left=
0;c.getContentElement().appendChild(ha);var f=e.body,h,m=[],q;for(h=f.firstElementChild;h&&h!==f;)if(h.namespaceURI===z&&(m[m.length]=h),h.firstElementChild)h=h.firstElementChild;else{for(;h&&h!==f&&!h.nextElementSibling;)h=h.parentNode;h&&h.nextElementSibling&&(h=h.nextElementSibling)}for(q=0;q<m.length;q+=1)h=m[q],r("frame"+String(q),h,k);m=aa.getODFElementsWithXPath(f,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI);for(h=0;h<m.length;h+=1)f=m[h],f.setAttributeNS&&f.setAttributeNS("urn:webodf:names:helper",
"containsparagraphanchor",!0);f=da;h=ha;var w,x,v,H;H=0;var y,B;q=c.rootElement.ownerDocument;if((m=e.body.firstElementChild)&&m.namespaceURI===C&&("presentation"===m.localName||"drawing"===m.localName))for(m=m.firstElementChild;m;){if(w=(w=m.getAttributeNS(z,"master-page-name"))?f.getMasterPageElement(w):null){x=m.getAttributeNS("urn:webodf:names:helper","styleid");v=q.createElementNS(z,"draw:page");B=w.firstElementChild;for(y=0;B;)"true"!==B.getAttributeNS(W,"placeholder")&&(H=B.cloneNode(!0),v.appendChild(H),
r(x+"_"+y,H,k)),B=B.nextElementSibling,y+=1;B=y=H=void 0;var D=v.getElementsByTagNameNS(z,"frame");for(H=0;H<D.length;H+=1)y=D[H],(B=y.getAttributeNS(W,"class"))&&!/^(date-time|footer|header|page-number)$/.test(B)&&y.parentNode.removeChild(y);h.appendChild(v);H=String(h.getElementsByTagNameNS(z,"page").length);p(v,J,"page-number",H);p(v,W,"header",g(c,m,"header"));p(v,W,"footer",g(c,m,"footer"));r(x,v,k);v.setAttributeNS(z,"draw:master-page-name",w.getAttributeNS(I,"name"))}m=m.nextElementSibling}f=
n.namespaceURI;m=e.body.getElementsByTagNameNS(K,"table-cell");for(h=0;h<m.length;h+=1)q=m.item(h),q.hasAttributeNS(K,"number-columns-spanned")&&q.setAttributeNS(f,"colspan",q.getAttributeNS(K,"number-columns-spanned")),q.hasAttributeNS(K,"number-rows-spanned")&&q.setAttributeNS(f,"rowspan",q.getAttributeNS(K,"number-rows-spanned"));b(e.body);a(e.body);l(e.body);A(c,e.body,k);u(c,e.body);w=e.body;f=n.namespaceURI;m={};q={};var N;x=E.document.getElementsByTagNameNS(J,"list-style");for(h=0;h<x.length;h+=
1)y=x.item(h),(B=y.getAttributeNS(I,"name"))&&(q[B]=y);w=w.getElementsByTagNameNS(J,"list");for(h=0;h<w.length;h+=1)if(y=w.item(h),x=y.getAttributeNS(U,"id")){v=y.getAttributeNS(J,"continue-list");y.setAttributeNS(f,"id",x);H="text|list#"+x+" > text|list-item > *:first-child:before {";if(B=y.getAttributeNS(J,"style-name")){y=q[B];N=O.getFirstNonWhitespaceChild(y);y=void 0;if(N)if("list-level-style-number"===N.localName){B=N;N=B.getAttributeNS(I,"num-format");y=B.getAttributeNS(I,"num-suffix")||"";
B=B.getAttributeNS(I,"num-prefix")||"";var D="",D={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"},L=void 0;B&&(L='"'+s(B)+'"\n');L=D.hasOwnProperty(N)?L+(" counter(list, "+D[N]+")"):N?L+("'"+N+"';"):L+' ""';y&&(L+=' "'+s(y)+'"');y=D="content:"+L+";"}else"list-level-style-image"===N.localName?y="content: none;":"list-level-style-bullet"===N.localName&&(N=N.getAttributeNS(J,"bullet-char"),y='content: "'+s(N)+'"\n;');N=y;N="\n"+N+"\n"}if(v){for(y=m[v];y;)y=m[y];H+="counter-increment:"+
v+";";N?(N=N.replace("list",v),H+=N):H+="content:counter("+v+");"}else v="",N?(N=N.replace("list",x),H+=N):H+="content: counter("+x+");",H+="counter-increment:"+x+";",t(k,"text|list#"+x+" {counter-reset:"+x+"}");H+="}";m[x]=v;H&&t(k,H)}Q.insertBefore(ha,Q.firstChild);fa.setZoomableElement(Q)}function T(a){L?(V.parentNode||Q.appendChild(V),$&&$.forgetAnnotations(),$=new gui.AnnotationViewManager(M,a.body,V,ia),B.getElementsByTagNameNS(a.body,C,"annotation").forEach($.addAnnotation),$.rerenderAnnotations(),
H()):V.parentNode&&(Q.removeChild(V),$.forgetAnnotations(),H())}function y(a){function b(){c(ea);c(qa);c(ka);d(n);n.style.display="inline-block";var k=N.rootElement;n.ownerDocument.importNode(k,!0);da.setOdfContainer(N);m(N,ea);e(N,da,qa);D(N,k);T(k);a||ma.addToQueue(function(){var a=[N];if(la.hasOwnProperty("statereadychange")){var b=la.statereadychange,c;for(c=0;c<b.length;c+=1)b[c].apply(null,a)}})}N.state===odf.OdfContainer.DONE?b():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),
oa=runtime.setTimeout(function G(){N.state===odf.OdfContainer.DONE?b():(runtime.log("will be back later..."),oa=runtime.setTimeout(G,500))},100))}function P(a){ma.clearQueue();n.innerHTML=runtime.tr("Loading File")+"...";n.removeAttribute("style");N=new odf.OdfContainer(a,function(a){N=a;y(!1)})}runtime.assert(null!==n&&void 0!==n,"odf.OdfCanvas constructor needs DOM element");runtime.assert(null!==n.ownerDocument&&void 0!==n.ownerDocument,"odf.OdfCanvas constructor needs DOM");var M=this,Y=n.ownerDocument,
N,da=new odf.Formatting,S,Q=null,V=null,L=!1,ia=!1,$=null,ba,ea,qa,ka,ha,la={},oa,pa,ja=!1,na=!1,ma=new f,fa=new gui.ZoomHelper;this.refreshCSS=function(){ja=!0;pa.trigger()};this.refreshSize=function(){pa.trigger()};this.odfContainer=function(){return N};this.setOdfContainer=function(a,b){N=a;y(!0===b)};this.load=this.load=P;this.save=function(a){N.save(a)};this.addListener=function(a,b){switch(a){case "click":var c=n,d=a;c.addEventListener?c.addEventListener(d,b,!1):c.attachEvent?c.attachEvent("on"+
d,b):c["on"+d]=b;break;default:c=la.hasOwnProperty(a)?la[a]:la[a]=[],b&&-1===c.indexOf(b)&&c.push(b)}};this.getFormatting=function(){return da};this.getAnnotationViewManager=function(){return $};this.refreshAnnotations=function(){T(N.rootElement)};this.rerenderAnnotations=function(){$&&(na=!0,pa.trigger())};this.getSizer=function(){return Q};this.enableAnnotations=function(a,b){a!==L&&(L=a,ia=b,N&&T(N.rootElement))};this.addAnnotation=function(a){$&&($.addAnnotation(a),H())};this.forgetAnnotations=
function(){$&&($.forgetAnnotations(),H())};this.getZoomHelper=function(){return fa};this.setZoomLevel=function(a){fa.setZoomLevel(a)};this.getZoomLevel=function(){return fa.getZoomLevel()};this.fitToContainingElement=function(a,b){var c=fa.getZoomLevel(),d=n.offsetHeight/c,c=a/(n.offsetWidth/c);b/d<c&&(c=b/d);fa.setZoomLevel(c)};this.fitToWidth=function(a){var b=n.offsetWidth/fa.getZoomLevel();fa.setZoomLevel(a/b)};this.fitSmart=function(a,b){var c,d;d=fa.getZoomLevel();c=n.offsetWidth/d;d=n.offsetHeight/
d;c=a/c;void 0!==b&&b/d<c&&(c=b/d);fa.setZoomLevel(Math.min(1,c))};this.fitToHeight=function(a){var b=n.offsetHeight/fa.getZoomLevel();fa.setZoomLevel(a/b)};this.showFirstPage=function(){S.showFirstPage()};this.showNextPage=function(){S.showNextPage()};this.showPreviousPage=function(){S.showPreviousPage()};this.showPage=function(a){S.showPage(a);H()};this.getElement=function(){return n};this.addCssForFrameWithImage=function(a){var b=a.getAttributeNS(z,"name"),c=a.firstElementChild;r(b,a,ka.sheet);
c&&q(b+"img",N,c,ka.sheet)};this.destroy=function(a){var b=Y.getElementsByTagName("head")[0],c=[S.destroy,pa.destroy];runtime.clearTimeout(oa);V&&V.parentNode&&V.parentNode.removeChild(V);fa.destroy(function(){Q&&(n.removeChild(Q),Q=null)});x(ba);b.removeChild(ea);b.removeChild(qa);b.removeChild(ka);core.Async.destroyAll(c,a)};ba=w(Y);S=new h(v(Y));ea=v(Y);qa=v(Y);ka=v(Y);pa=core.Task.createRedrawTask(function(){ja&&(e(N,da,qa),ja=!1);na&&($&&$.rerenderAnnotations(),na=!1);H()});fa.subscribe(gui.ZoomHelper.signalZoomChanged,
H)}})();odf.StepUtils=function(){this.getContentBounds=function(f){var h=f.container(),d,c;runtime.assert(f.isStep(),"Step iterator must be on a step");h.nodeType===Node.TEXT_NODE&&0<f.offset()?d=f.offset():(h=f.leftNode())&&h.nodeType===Node.TEXT_NODE&&(d=h.length);h&&(h.nodeType===Node.TEXT_NODE?(runtime.assert(0<d,"Empty text node found"),c={container:h,startOffset:d-1,endOffset:d}):c={container:h,startOffset:0,endOffset:h.childNodes.length});return c}};ops.MemberProperties=function(){};
ops.Member=function(f,h){var d=new ops.MemberProperties;this.getMemberId=function(){return f};this.getProperties=function(){return d};this.setProperties=function(c){Object.keys(c).forEach(function(e){d[e]=c[e]})};this.removeProperties=function(c){Object.keys(c).forEach(function(c){"fullName"!==c&&"color"!==c&&"imageUrl"!==c&&d.hasOwnProperty(c)&&delete d[c]})};runtime.assert(Boolean(f),"No memberId was supplied!");h.fullName||(h.fullName=runtime.tr("Unknown Author"));h.color||(h.color="black");h.imageUrl||
(h.imageUrl="avatar-joe.png");d=h};gui.SelectionMover=function(f,h){function d(){q.setUnfilteredPosition(f.getNode(),0);return q}function c(a,b){var c,d=null;a&&0<a.length&&(c=b?a.item(a.length-1):a.item(0));c&&(d={top:c.top,left:b?c.right:c.left,bottom:c.bottom});return d}function e(a,b,d,g){var f=a.nodeType;d.setStart(a,b);d.collapse(!g);g=c(d.getClientRects(),!0===g);!g&&0<b&&(d.setStart(a,b-1),d.setEnd(a,b),g=c(d.getClientRects(),!0));g||(f===Node.ELEMENT_NODE&&0<b&&a.childNodes.length>=b?g=e(a,b-1,d,!0):a.nodeType===Node.TEXT_NODE&&
0<b?g=e(a,b-1,d,!0):a.previousSibling?g=e(a.previousSibling,a.previousSibling.nodeType===Node.TEXT_NODE?a.previousSibling.textContent.length:a.previousSibling.childNodes.length,d,!0):a.parentNode&&a.parentNode!==h?g=e(a.parentNode,0,d,!1):(d.selectNode(h),g=c(d.getClientRects(),!1)));runtime.assert(Boolean(g),"No visible rectangle found");return g}function m(a,c,e){for(var g=d(),f=new core.LoopWatchDog(1E4),h=0,m=0;0<a&&g.nextPosition();)f.check(),e.acceptPosition(g)===b&&(h+=1,c.acceptPosition(g)===
b&&(m+=h,h=0,a-=1));return m}function g(a,c,e){for(var g=d(),f=new core.LoopWatchDog(1E4),h=0,m=0;0<a&&g.previousPosition();)f.check(),e.acceptPosition(g)===b&&(h+=1,c.acceptPosition(g)===b&&(m+=h,h=0,a-=1));return m}function p(a,c){var k=d(),g=0,f=0,m=0>a?-1:1;for(a=Math.abs(a);0<a;){for(var n=c,p=m,q=k,r=q.container(),C=0,I=null,A=void 0,K=10,J=void 0,H=0,U=void 0,W=void 0,E=void 0,J=void 0,aa=h.ownerDocument.createRange(),O=new core.LoopWatchDog(1E4),J=e(r,q.unfilteredDomOffset(),aa),U=J.top,W=
J.left,E=U;!0===(0>p?q.previousPosition():q.nextPosition());)if(O.check(),n.acceptPosition(q)===b&&(C+=1,r=q.container(),J=e(r,q.unfilteredDomOffset(),aa),J.top!==U)){if(J.top!==E&&E!==U)break;E=J.top;J=Math.abs(W-J.left);if(null===I||J<K)I=r,A=q.unfilteredDomOffset(),K=J,H=C}null!==I?(q.setUnfilteredPosition(I,A),C=H):C=0;aa.detach();g+=C;if(0===g)break;f+=g;a-=1}return f*m}function r(a,c){var k,g,f,m,p=d(),q=n.getParagraphElement(p.getCurrentNode()),r=0,u=h.ownerDocument.createRange();0>a?(k=p.previousPosition,
g=-1):(k=p.nextPosition,g=1);for(f=e(p.container(),p.unfilteredDomOffset(),u);k.call(p);)if(c.acceptPosition(p)===b){if(n.getParagraphElement(p.getCurrentNode())!==q)break;m=e(p.container(),p.unfilteredDomOffset(),u);if(m.bottom!==f.bottom&&(f=m.top>=f.top&&m.bottom<f.bottom||m.top<=f.top&&m.bottom>f.bottom,!f))break;r+=g;f=m}u.detach();return r}var n=new odf.OdfUtils,q,b=core.PositionFilter.FilterResult.FILTER_ACCEPT;this.getStepCounter=function(){return{convertForwardStepsBetweenFilters:m,convertBackwardStepsBetweenFilters:g,
countLinesSteps:p,countStepsToLineBoundary:r}};(function(){q=gui.SelectionMover.createPositionIterator(h);var a=h.ownerDocument.createRange();a.setStart(q.container(),q.unfilteredDomOffset());a.collapse(!0);f.setSelectedRange(a)})()};
gui.SelectionMover.createPositionIterator=function(f){var h=new function(){this.acceptNode=function(d){return d&&"urn:webodf:names:cursor"!==d.namespaceURI&&"urn:webodf:names:editinfo"!==d.namespaceURI?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT}};return new core.PositionIterator(f,5,h,!1)};ops.Document=function(){};ops.Document.prototype.getMemberIds=function(){};ops.Document.prototype.removeCursor=function(f){};ops.Document.prototype.getDocumentElement=function(){};ops.Document.prototype.getRootNode=function(){};ops.Document.prototype.getDOMDocument=function(){};ops.Document.prototype.cloneDocumentElement=function(){};ops.Document.prototype.setDocumentElement=function(f){};ops.Document.prototype.subscribe=function(f,h){};ops.Document.prototype.unsubscribe=function(f,h){};
ops.Document.prototype.getCanvas=function(){};ops.Document.prototype.createRootFilter=function(f){};ops.Document.signalCursorAdded="cursor/added";ops.Document.signalCursorRemoved="cursor/removed";ops.Document.signalCursorMoved="cursor/moved";ops.Document.signalMemberAdded="member/added";ops.Document.signalMemberUpdated="member/updated";ops.Document.signalMemberRemoved="member/removed";ops.OdtCursor=function(f,h){var d=this,c={},e,m,g,p=new core.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){g.remove()};this.subscribe=function(c,d){p.subscribe(c,d)};this.unsubscribe=function(c,d){p.unsubscribe(c,d)};this.getStepCounter=function(){return m.getStepCounter()};this.getMemberId=function(){return f};this.getNode=function(){return g.getNode()};this.getAnchorNode=function(){return g.getAnchorNode()};this.getSelectedRange=function(){return g.getSelectedRange()};
this.setSelectedRange=function(c,e){g.setSelectedRange(c,e);p.emit(ops.OdtCursor.signalCursorUpdated,d)};this.hasForwardSelection=function(){return g.hasForwardSelection()};this.getDocument=function(){return h};this.getSelectionType=function(){return e};this.setSelectionType=function(d){c.hasOwnProperty(d)?e=d:runtime.log("Invalid selection type: "+d)};this.resetSelectionType=function(){d.setSelectionType(ops.OdtCursor.RangeSelection)};g=new core.Cursor(h.getDOMDocument(),f);m=new gui.SelectionMover(g,
h.getRootNode());c[ops.OdtCursor.RangeSelection]=!0;c[ops.OdtCursor.RegionSelection]=!0;d.resetSelectionType()};ops.OdtCursor.RangeSelection="Range";ops.OdtCursor.RegionSelection="Region";ops.OdtCursor.signalCursorUpdated="cursorUpdated";(function(){var f=0;ops.StepsCache=function(h,d,c){function e(a,b){var d=this;this.nodeId=a;this.steps=-1;this.node=b;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setPositionBeforeElement(b);c(d.steps,a)}}function m(a,b,d){var e=this;this.nodeId=a;this.steps=b;this.node=d;this.previousBookmark=this.nextBookmark=null;this.setIteratorPosition=function(a){a.setUnfilteredPosition(d,0);c(e.steps,a)}}function g(a,b){var c="["+a.nodeId;b&&(c+=" => "+b.nodeId);return c+
"]"}function p(){for(var a=w,b,c,d,e=new core.LoopWatchDog(0,1E5),f={};a;){e.check();(b=a.previousBookmark)?runtime.assert(b.nextBookmark===a,"Broken bookmark link to previous @"+g(b,a)):(runtime.assert(a===w,"Broken bookmark link @"+g(a)),runtime.assert(void 0===x||w===w||w.steps<=x,"Base point is damaged @"+g(a)));(c=a.nextBookmark)&&runtime.assert(c.previousBookmark===a,"Broken bookmark link to next @"+g(a,c));if(void 0===x||a===w||a.steps<=x)runtime.assert(s.containsNode(h,a.node),"Disconnected node is being reported as undamaged @"+
g(a)),b&&(d=a.node.compareDocumentPosition(b.node),runtime.assert(0===d||0!==(d&z),"Bookmark order with previous does not reflect DOM order @"+g(b,a))),c&&s.containsNode(h,c.node)&&(d=a.node.compareDocumentPosition(c.node),runtime.assert(0===d||0!==(d&v),"Bookmark order with next does not reflect DOM order @"+g(a,c)));a=a.nextBookmark}Object.keys(k).forEach(function(a){var b=k[a];(void 0===x||a<=x)&&runtime.assert(b.steps<=a,"Bookmark step of "+b.steps+" exceeds cached step lookup for "+a+" @"+g(b));
runtime.assert(!1===f.hasOwnProperty(b.nodeId),"Bookmark "+g(b)+" appears twice in cached step lookup at steps "+f[b.nodeId]+" and "+a);f[b.nodeId]=a})}function r(a){var b="";a.nodeType===Node.ELEMENT_NODE&&(b=a.getAttributeNS(l,"nodeId")||"");return b}function n(a){var b=f.toString();a.setAttributeNS(l,"nodeId",b);f+=1;return b}function q(a){var b,c,e=new core.LoopWatchDog(0,1E4);void 0!==x&&a>x&&(a=x);for(b=Math.floor(a/d)*d;!c&&0<=b;)c=k[b],b-=d;for(c=c||w;c.nextBookmark&&c.nextBookmark.steps<=
a;)e.check(),c=c.nextBookmark;runtime.assert(-1===a||c.steps<=a,"Bookmark @"+g(c)+" at step "+c.steps+" exceeds requested step of "+a);return c}function b(a){a.previousBookmark&&(a.previousBookmark.nextBookmark=a.nextBookmark);a.nextBookmark&&(a.nextBookmark.previousBookmark=a.previousBookmark)}function a(a){for(var b,c=null;!c&&a&&a!==h;)(b=r(a))&&(c=t[b])&&c.node!==a&&(runtime.log("Cloned node detected. Creating new bookmark"),c=null,a.removeAttributeNS(l,"nodeId")),a=a.parentNode;return c}var l=
"urn:webodf:names:steps",k={},t={},s=new core.DomUtils,w,x,v=Node.DOCUMENT_POSITION_FOLLOWING,z=Node.DOCUMENT_POSITION_PRECEDING,u;this.updateBookmark=function(a,c){var g,f=Math.ceil(a/d)*d,l,m,p;if(void 0!==x&&x<a){l=q(x);for(m=l.nextBookmark;m&&m.steps<=a;)g=m.nextBookmark,p=Math.ceil(m.steps/d)*d,k[p]===m&&delete k[p],s.containsNode(h,m.node)?m.steps=a+1:(b(m),delete t[m.nodeId]),m=g;x=a}else l=q(a);m=r(c)||n(c);g=t[m];g?g.node!==c&&(runtime.log("Cloned node detected. Creating new bookmark"),m=
n(c),g=t[m]=new e(m,c)):g=t[m]=new e(m,c);m=g;m.steps!==a&&(g=Math.ceil(m.steps/d)*d,g!==f&&k[g]===m&&delete k[g],m.steps=a);if(l!==m&&l.nextBookmark!==m){if(l.steps===m.steps)for(;0!==(m.node.compareDocumentPosition(l.node)&v)&&l!==w;)l=l.previousBookmark;l!==m&&l.nextBookmark!==m&&(b(m),g=l.nextBookmark,m.nextBookmark=l.nextBookmark,m.previousBookmark=l,l.nextBookmark=m,g&&(g.previousBookmark=m))}l=k[f];if(!l||m.steps>l.steps)k[f]=m;u()};this.setToClosestStep=function(a,b){var c;u();c=q(a);c.setIteratorPosition(b);
return c.steps};this.setToClosestDomPoint=function(b,c,d){var e,g;u();if(b===h&&0===c)e=w;else if(b===h&&c===h.childNodes.length)for(g in e=w,k)k.hasOwnProperty(g)&&(b=k[g],b.steps>e.steps&&(e=b));else if(e=a(b.childNodes.item(c)||b),!e)for(d.setUnfilteredPosition(b,c);!e&&d.previousNode();)e=a(d.getCurrentNode());e=e||w;void 0!==x&&e.steps>x&&(e=q(x));e.setIteratorPosition(d);return e.steps};this.damageCacheAfterStep=function(a){0>a&&(a=-1);void 0===x?x=a:a<x&&(x=a);u()};(function(){var a=r(h)||
n(h);w=new m(a,0,h);u=ops.StepsCache.ENABLE_CACHE_VERIFICATION?p:function(){}})()};ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1;ops.StepsCache.Bookmark=function(){};ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(f){}})();(function(){ops.OdtStepsTranslator=function(f,h,d,c){function e(a,b,c){var d=b.getCurrentNode();b.isBeforeNode()&&q.isParagraph(d)&&(c||(a+=1),n.updateBookmark(a,d))}function m(a,b){do{if(d.acceptPosition(b)===l){e(a,b,!0);break}e(a-1,b,!1)}while(b.nextPosition())}function g(){var b=f();b!==r&&(r&&runtime.log("Undo detected. Resetting steps cache"),r=b,n=new ops.StepsCache(r,c,m),a=h(r))}function p(a,b){if(!b||d.acceptPosition(a)===l)return!0;for(;a.previousPosition();)if(d.acceptPosition(a)===l){if(b(0,
a.container(),a.unfilteredDomOffset()))return!0;break}for(;a.nextPosition();)if(d.acceptPosition(a)===l){if(b(1,a.container(),a.unfilteredDomOffset()))return!0;break}return!1}var r,n,q=new odf.OdfUtils,b=new core.DomUtils,a,l=core.PositionFilter.FilterResult.FILTER_ACCEPT;this.convertStepsToDomPoint=function(b){var c,f;if(isNaN(b))throw new TypeError("Requested steps is not numeric ("+b+")");if(0>b)throw new RangeError("Requested steps is negative ("+b+")");g();for(c=n.setToClosestStep(b,a);c<b&&
a.nextPosition();)(f=d.acceptPosition(a)===l)&&(c+=1),e(c,a,f);if(c!==b)throw new RangeError("Requested steps ("+b+") exceeds available steps ("+c+")");return{node:a.container(),offset:a.unfilteredDomOffset()}};this.convertDomPointToSteps=function(c,f,h){var m;g();b.containsNode(r,c)||(f=0>b.comparePoints(r,0,c,f),c=r,f=f?0:r.childNodes.length);a.setUnfilteredPosition(c,f);p(a,h)||a.setUnfilteredPosition(c,f);h=a.container();f=a.unfilteredDomOffset();c=n.setToClosestDomPoint(h,f,a);if(0>b.comparePoints(a.container(),
a.unfilteredDomOffset(),h,f))return 0<c?c-1:c;for(;(a.container()!==h||a.unfilteredDomOffset()!==f)&&a.nextPosition();)(m=d.acceptPosition(a)===l)&&(c+=1),e(c,a,m);return c+0};this.prime=function(){var b,c;g();for(b=n.setToClosestStep(0,a);a.nextPosition();)(c=d.acceptPosition(a)===l)&&(b+=1),e(b,a,c)};this.handleStepsInserted=function(a){g();n.damageCacheAfterStep(a.position)};this.handleStepsRemoved=function(a){g();n.damageCacheAfterStep(a.position-1)};g()};ops.OdtStepsTranslator.PREVIOUS_STEP=
0;ops.OdtStepsTranslator.NEXT_STEP=1})();ops.Operation=function(){};ops.Operation.prototype.init=function(f){};ops.Operation.prototype.execute=function(f){};ops.Operation.prototype.spec=function(){};ops.TextPositionFilter=function(f){function h(c,e,f){var h,b;if(e){if(d.isInlineRoot(e)&&d.isGroupingElement(f))return g;h=d.lookLeftForCharacter(e);if(1===h||2===h&&(d.scanRightForAnyCharacter(f)||d.scanRightForAnyCharacter(d.nextNode(c))))return m}else if(d.isInlineRoot(c.previousSibling)&&d.isGroupingElement(c))return m;h=null===e&&d.isParagraph(c);b=d.lookRightForCharacter(f);if(h)return b?m:d.scanRightForAnyCharacter(f)?g:m;if(!b)return g;e=e||d.previousNode(c);return d.scanLeftForAnyCharacter(e)?
g:m}var d=new odf.OdfUtils,c=Node.ELEMENT_NODE,e=Node.TEXT_NODE,m=core.PositionFilter.FilterResult.FILTER_ACCEPT,g=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(p){var r=p.container(),n=r.nodeType,q,b,a;if(n!==c&&n!==e)return g;if(n===e){if(!d.isGroupingElement(r.parentNode)||d.isWithinTrackedChanges(r.parentNode,f()))return g;n=p.unfilteredDomOffset();q=r.data;runtime.assert(n!==q.length,"Unexpected offset.");if(0<n){p=q[n-1];if(!d.isODFWhitespace(p))return m;if(1<n)if(p=
q[n-2],!d.isODFWhitespace(p))b=m;else{if(!d.isODFWhitespace(q.substr(0,n)))return g}else a=d.previousNode(r),d.scanLeftForNonSpace(a)&&(b=m);if(b===m)return d.isTrailingWhitespace(r,n)?g:m;b=q[n];return d.isODFWhitespace(b)?g:d.scanLeftForAnyCharacter(d.previousNode(r))?g:m}a=p.leftNode();b=r;r=r.parentNode;b=h(r,a,b)}else!d.isGroupingElement(r)||d.isWithinTrackedChanges(r,f())?b=g:(a=p.leftNode(),b=p.rightNode(),b=h(r,a,b));return b}};ops.OdtDocument=function(f){function h(){var a=f.odfContainer().getContentElement(),b=a&&a.localName;runtime.assert("text"===b,"Unsupported content element type '"+b+"' for OdtDocument");return a}function d(){return a.getDocumentElement().ownerDocument}function c(a){for(;a&&!(a.namespaceURI===odf.Namespaces.officens&&"text"===a.localName||a.namespaceURI===odf.Namespaces.officens&&"annotation"===a.localName);)a=a.parentNode;return a}function e(a){this.acceptPosition=function(b){b=b.container();var d;
d="string"===typeof a?s[a].getNode():a;return c(b)===c(d)?v:z}}function m(a,b,c,d){d=gui.SelectionMover.createPositionIterator(d);var e;1===c.length?e=c[0]:(e=new core.PositionFilterChain,c.forEach(e.addFilter));c=new core.StepIterator(e,d);c.setPosition(a,b);return c}function g(a){var b=gui.SelectionMover.createPositionIterator(h());a=C.convertStepsToDomPoint(a);b.setUnfilteredPosition(a.node,a.offset);return b}function p(a){return k.getParagraphElement(a)}function r(a,b){return f.getFormatting().getStyleElement(a,
b)}function n(a){return r(a,"paragraph")}function q(a){var b,c=[],d,e=2;runtime.assert(a.isStep(),"positionIterator is not at a step");do{if(b=l.getContentBounds(a))if(b=b.container,k.isDowngradableSpaceElement(b)){for(d=b.lastChild;b.firstChild;)c.push(b.firstChild),b.parentNode.insertBefore(b.firstChild,b);b.parentNode.removeChild(b);a.setPosition(d,d.nodeType===Node.TEXT_NODE?d.length:d.childNodes.length);a.roundToPreviousStep()}e-=1}while(0<e&&a.nextStep());c.forEach(t.normalizeTextNodes)}function b(a,
b,c){a=a.childNodes.item(b)||a;return(a=p(a))&&t.containsNode(c,a)?a:c}var a=this,l,k,t,s={},w={},x=new core.EventNotifier([ops.Document.signalMemberAdded,ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,ops.Document.signalCursorRemoved,ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,
ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,ops.OdtDocument.signalMetadataUpdated]),v=core.PositionFilter.FilterResult.FILTER_ACCEPT,z=core.PositionFilter.FilterResult.FILTER_REJECT,u,C,I;this.getDocumentElement=function(){return f.odfContainer().rootElement};this.getDOMDocument=
function(){return this.getDocumentElement().ownerDocument};this.cloneDocumentElement=function(){var b=a.getDocumentElement(),c=f.getAnnotationViewManager();c&&c.forgetAnnotations();b=b.cloneNode(!0);f.refreshAnnotations();return b};this.setDocumentElement=function(a){var b=f.odfContainer();b.setRootElement(a);f.setOdfContainer(b,!0);f.refreshCSS()};this.getDOMDocument=d;this.getRootElement=c;this.createStepIterator=m;this.getIteratorAtPosition=g;this.convertCursorStepToDomPoint=function(a){return C.convertStepsToDomPoint(a)};
this.convertDomPointToCursorStep=function(a,b,c){return C.convertDomPointToSteps(a,b,c)};this.convertDomToCursorRange=function(a){var b;b=C.convertDomPointToSteps(a.anchorNode,a.anchorOffset);a=a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset?b:C.convertDomPointToSteps(a.focusNode,a.focusOffset);return{position:b,length:a-b}};this.convertCursorToDomRange=function(a,b){var c=d().createRange(),e,g;e=C.convertStepsToDomPoint(a);b?(g=C.convertStepsToDomPoint(a+b),0<b?(c.setStart(e.node,e.offset),
c.setEnd(g.node,g.offset)):(c.setStart(g.node,g.offset),c.setEnd(e.node,e.offset))):c.setStart(e.node,e.offset);return c};this.getStyleElement=r;this.upgradeWhitespacesAtPosition=function(a){var b=g(a),b=new core.StepIterator(u,b),c,d=2;runtime.assert(b.isStep(),"positionIterator is not at a step (requested step: "+a+")");do{if(c=l.getContentBounds(b))if(a=c.container,c=c.startOffset,a.nodeType===Node.TEXT_NODE&&k.isSignificantWhitespace(a,c)){runtime.assert(" "===a.data[c],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");
var e=a.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),f=a.parentNode,h=a;e.appendChild(a.ownerDocument.createTextNode(" "));1===a.length?f.replaceChild(e,a):(a.deleteData(c,1),0<c&&(c<a.length&&a.splitText(c),h=a.nextSibling),f.insertBefore(e,h));a=e;b.setPosition(a,a.childNodes.length);b.roundToPreviousStep()}d-=1}while(0<d&&b.nextStep())};this.downgradeWhitespaces=q;this.downgradeWhitespacesAtPosition=function(a){a=g(a);a=new core.StepIterator(u,a);q(a)};this.getParagraphStyleElement=
n;this.getParagraphElement=p;this.getParagraphStyleAttributes=function(a){return(a=n(a))?f.getFormatting().getInheritedStyleAttributes(a,!1):null};this.getTextNodeAtStep=function(b,c){var e=g(b),k=e.container(),f,l=0,h=null;k.nodeType===Node.TEXT_NODE?(f=k,l=e.unfilteredDomOffset(),0<f.length&&(0<l&&(f=f.splitText(l)),f.parentNode.insertBefore(d().createTextNode(""),f),f=f.previousSibling,l=0)):(f=d().createTextNode(""),l=0,k.insertBefore(f,e.rightNode()));if(c){if(s[c]&&a.getCursorPosition(c)===
b){for(h=s[c].getNode();h.nextSibling&&"cursor"===h.nextSibling.localName;)h.parentNode.insertBefore(h.nextSibling,h);0<f.length&&f.nextSibling!==h&&(f=d().createTextNode(""),l=0);h.parentNode.insertBefore(f,h)}}else for(;f.nextSibling&&"cursor"===f.nextSibling.localName;)f.parentNode.insertBefore(f.nextSibling,f);for(;f.previousSibling&&f.previousSibling.nodeType===Node.TEXT_NODE;)e=f.previousSibling,e.appendData(f.data),l=e.length,f=e,f.parentNode.removeChild(f.nextSibling);for(;f.nextSibling&&
f.nextSibling.nodeType===Node.TEXT_NODE;)e=f.nextSibling,f.appendData(e.data),f.parentNode.removeChild(e);return{textNode:f,offset:l}};this.fixCursorPositions=function(){Object.keys(s).forEach(function(d){var e=s[d],g=c(e.getNode()),f=a.createRootFilter(g),k,l,h,n=!1;h=e.getSelectedRange();k=b(h.startContainer,h.startOffset,g);l=m(h.startContainer,h.startOffset,[u,f],k);h.collapsed?g=l:(k=b(h.endContainer,h.endOffset,g),g=m(h.endContainer,h.endOffset,[u,f],k));l.isStep()&&g.isStep()?l.container()!==
g.container()||l.offset()!==g.offset()||h.collapsed&&e.getAnchorNode()===e.getNode()||(n=!0,h.setStart(l.container(),l.offset()),h.collapse(!0)):(n=!0,runtime.assert(l.roundToClosestStep(),"No walkable step found for cursor owned by "+d),h.setStart(l.container(),l.offset()),runtime.assert(g.roundToClosestStep(),"No walkable step found for cursor owned by "+d),h.setEnd(g.container(),g.offset()));n&&(e.setSelectedRange(h,e.hasForwardSelection()),a.emit(ops.Document.signalCursorMoved,e))})};this.getCursorPosition=
function(a){return(a=s[a])?C.convertDomPointToSteps(a.getNode(),0):0};this.getCursorSelection=function(a){a=s[a];var b=0,c=0;a&&(b=C.convertDomPointToSteps(a.getNode(),0),c=C.convertDomPointToSteps(a.getAnchorNode(),0));return{position:c,length:b-c}};this.getPositionFilter=function(){return u};this.getOdfCanvas=function(){return f};this.getCanvas=function(){return f};this.getRootNode=h;this.addMember=function(a){runtime.assert(void 0===w[a.getMemberId()],"This member already exists");w[a.getMemberId()]=
a};this.getMember=function(a){return w.hasOwnProperty(a)?w[a]:null};this.removeMember=function(a){delete w[a]};this.getCursor=function(a){return s[a]};this.getMemberIds=function(){var a=[],b;for(b in s)s.hasOwnProperty(b)&&a.push(s[b].getMemberId());return a};this.addCursor=function(b){runtime.assert(Boolean(b),"OdtDocument::addCursor without cursor");var c=b.getMemberId(),d=a.convertCursorToDomRange(0,0);runtime.assert("string"===typeof c,"OdtDocument::addCursor has cursor without memberid");runtime.assert(!s[c],
"OdtDocument::addCursor is adding a duplicate cursor with memberid "+c);b.setSelectedRange(d,!0);s[c]=b};this.removeCursor=function(b){var c=s[b];return c?(c.removeFromDocument(),delete s[b],a.emit(ops.Document.signalCursorRemoved,b),!0):!1};this.moveCursor=function(b,c,d,e){b=s[b];c=a.convertCursorToDomRange(c,d);b&&(b.setSelectedRange(c,0<=d),b.setSelectionType(e||ops.OdtCursor.RangeSelection))};this.getFormatting=function(){return f.getFormatting()};this.emit=function(a,b){x.emit(a,b)};this.subscribe=
function(a,b){x.subscribe(a,b)};this.unsubscribe=function(a,b){x.unsubscribe(a,b)};this.createRootFilter=function(a){return new e(a)};this.close=function(a){a()};this.destroy=function(a){a()};u=new ops.TextPositionFilter(h);k=new odf.OdfUtils;t=new core.DomUtils;l=new odf.StepUtils;C=new ops.OdtStepsTranslator(h,gui.SelectionMover.createPositionIterator,u,500);x.subscribe(ops.OdtDocument.signalStepsInserted,C.handleStepsInserted);x.subscribe(ops.OdtDocument.signalStepsRemoved,C.handleStepsRemoved);
x.subscribe(ops.OdtDocument.signalOperationEnd,function(b){var c=b.spec(),d=c.memberid,e=(new Date(c.timestamp)).toISOString(),g=f.odfContainer(),k={setProperties:{},removedProperties:[]};b.isEdit&&("UpdateMetadata"===c.optype&&(k.setProperties=JSON.parse(JSON.stringify(c.setProperties)),c.removedProperties&&(k.removedProperties=c.removedProperties.attributes.split(","))),c=a.getMember(d).getProperties().fullName,g.setMetadata({"dc:creator":c,"dc:date":e},null),k.setProperties["dc:creator"]=c,k.setProperties["dc:date"]=
e,I||(k.setProperties["meta:editing-cycles"]=g.incrementEditingCycles(),g.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),I=b,a.emit(ops.OdtDocument.signalMetadataUpdated,k))});x.subscribe(ops.OdtDocument.signalProcessingBatchEnd,core.Task.processTasks)};ops.OdtDocument.signalParagraphChanged="paragraph/changed";ops.OdtDocument.signalTableAdded="table/added";ops.OdtDocument.signalCommonStyleCreated="style/created";ops.OdtDocument.signalCommonStyleDeleted="style/deleted";
ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified";ops.OdtDocument.signalOperationStart="operation/start";ops.OdtDocument.signalOperationEnd="operation/end";ops.OdtDocument.signalProcessingBatchStart="router/batchstart";ops.OdtDocument.signalProcessingBatchEnd="router/batchend";ops.OdtDocument.signalUndoStackChanged="undo/changed";ops.OdtDocument.signalStepsInserted="steps/inserted";ops.OdtDocument.signalStepsRemoved="steps/removed";ops.OdtDocument.signalMetadataUpdated="metadata/updated";ops.OpAddAnnotation=function(){function f(c,d,e){var g=c.getTextNodeAtStep(e,h);g&&(c=g.textNode,e=c.parentNode,g.offset!==c.length&&c.splitText(g.offset),e.insertBefore(d,c.nextSibling),0===c.length&&e.removeChild(c))}var h,d,c,e,m,g;this.init=function(g){h=g.memberid;d=parseInt(g.timestamp,10);c=parseInt(g.position,10);e=parseInt(g.length,10)||0;m=g.name};this.isEdit=!0;this.group=void 0;this.execute=function(p){var r=p.getCursor(h),n,q;q=new core.DomUtils;g=p.getDOMDocument();var b=new Date(d),
a,l,k,t;a=g.createElementNS(odf.Namespaces.officens,"office:annotation");a.setAttributeNS(odf.Namespaces.officens,"office:name",m);n=g.createElementNS(odf.Namespaces.dcns,"dc:creator");n.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",h);n.textContent=p.getMember(h).getProperties().fullName;l=g.createElementNS(odf.Namespaces.dcns,"dc:date");l.appendChild(g.createTextNode(b.toISOString()));b=g.createElementNS(odf.Namespaces.textns,"text:list");k=g.createElementNS(odf.Namespaces.textns,
"text:list-item");t=g.createElementNS(odf.Namespaces.textns,"text:p");k.appendChild(t);b.appendChild(k);a.appendChild(n);a.appendChild(l);a.appendChild(b);e&&(n=g.createElementNS(odf.Namespaces.officens,"office:annotation-end"),n.setAttributeNS(odf.Namespaces.officens,"office:name",m),a.annotationEndElement=n,f(p,n,c+e));f(p,a,c);p.emit(ops.OdtDocument.signalStepsInserted,{position:c});r&&(n=g.createRange(),q=q.getElementsByTagNameNS(a,odf.Namespaces.textns,"p")[0],n.selectNodeContents(q),r.setSelectedRange(n,
!1),r.setSelectionType(ops.OdtCursor.RangeSelection),p.emit(ops.Document.signalCursorMoved,r));p.getOdfCanvas().addAnnotation(a);p.fixCursorPositions();return!0};this.spec=function(){return{optype:"AddAnnotation",memberid:h,timestamp:d,position:c,length:e,name:m}}};ops.OpAddCursor=function(){var f,h;this.init=function(d){f=d.memberid;h=d.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(d){var c=d.getCursor(f);if(c)return!1;c=new ops.OdtCursor(f,d);d.addCursor(c);d.emit(ops.Document.signalCursorAdded,c);return!0};this.spec=function(){return{optype:"AddCursor",memberid:f,timestamp:h}}};ops.OpAddMember=function(){var f,h,d;this.init=function(c){f=c.memberid;h=parseInt(c.timestamp,10);d=c.setProperties};this.isEdit=!1;this.group=void 0;this.execute=function(c){var e;if(c.getMember(f))return!1;e=new ops.Member(f,d);c.addMember(e);c.emit(ops.Document.signalMemberAdded,e);return!0};this.spec=function(){return{optype:"AddMember",memberid:f,timestamp:h,setProperties:d}}};ops.OpAddStyle=function(){var f,h,d,c,e,m,g=odf.Namespaces.stylens;this.init=function(g){f=g.memberid;h=g.timestamp;d=g.styleName;c=g.styleFamily;e="true"===g.isAutomaticStyle||!0===g.isAutomaticStyle;m=g.setProperties};this.isEdit=!0;this.group=void 0;this.execute=function(f){var h=f.getOdfCanvas().odfContainer(),n=f.getFormatting(),q=f.getDOMDocument().createElementNS(g,"style:style");if(!q)return!1;m&&n.updateStyle(q,m);q.setAttributeNS(g,"style:family",c);q.setAttributeNS(g,"style:name",d);e?
h.rootElement.automaticStyles.appendChild(q):h.rootElement.styles.appendChild(q);f.getOdfCanvas().refreshCSS();e||f.emit(ops.OdtDocument.signalCommonStyleCreated,{name:d,family:c});return!0};this.spec=function(){return{optype:"AddStyle",memberid:f,timestamp:h,styleName:d,styleFamily:c,isAutomaticStyle:e,setProperties:m}}};odf.ObjectNameGenerator=function(f,h){function d(a,b){var c={};this.generateName=function(){var d=b(),e=0,g;do g=a+e,e+=1;while(c[g]||d[g]);c[g]=!0;return g}}function c(){var a={};[f.rootElement.automaticStyles,f.rootElement.styles].forEach(function(b){for(b=b.firstElementChild;b;)b.namespaceURI===e&&"style"===b.localName&&(a[b.getAttributeNS(e,"name")]=!0),b=b.nextElementSibling});return a}var e=odf.Namespaces.stylens,m=odf.Namespaces.drawns,g=odf.Namespaces.xlinkns,p=new core.DomUtils,r=(new core.Utils).hashString(h),
n=null,q=null,b=null,a={},l={};this.generateStyleName=function(){null===n&&(n=new d("auto"+r+"_",function(){return c()}));return n.generateName()};this.generateFrameName=function(){null===q&&(p.getElementsByTagNameNS(f.rootElement.body,m,"frame").forEach(function(b){a[b.getAttributeNS(m,"name")]=!0}),q=new d("fr"+r+"_",function(){return a}));return q.generateName()};this.generateImageName=function(){null===b&&(p.getElementsByTagNameNS(f.rootElement.body,m,"image").forEach(function(a){a=a.getAttributeNS(g,
"href");a=a.substring(9,a.lastIndexOf("."));l[a]=!0}),b=new d("img"+r+"_",function(){return l}));return b.generateName()}};odf.TextStyleApplicator=function(f,h,d){function c(c){function d(a,b){return"object"===typeof a&&"object"===typeof b?Object.keys(a).every(function(c){return d(a[c],b[c])}):a===b}var b={};this.isStyleApplied=function(a){a=h.getAppliedStylesForElement(a,b);return d(c,a)}}function e(c){var e={};this.applyStyleToContainer=function(b){var a;a=b.getAttributeNS(p,"style-name");var g=b.ownerDocument;a=a||"";if(!e.hasOwnProperty(a)){var k=a,m;m=a?h.createDerivedStyleObject(a,"text",c):c;g=g.createElementNS(r,
"style:style");h.updateStyle(g,m);g.setAttributeNS(r,"style:name",f.generateStyleName());g.setAttributeNS(r,"style:family","text");g.setAttributeNS("urn:webodf:names:scope","scope","document-content");d.appendChild(g);e[k]=g}a=e[a].getAttributeNS(r,"name");b.setAttributeNS(p,"text:style-name",a)}}function m(c,d){var b=c.ownerDocument,a=c.parentNode,e,f,h,m=new core.LoopWatchDog(1E4);f=[];f.push(c);for(h=c.nextSibling;h&&g.rangeContainsNode(d,h);)m.check(),f.push(h),h=h.nextSibling;"span"!==a.localName||
a.namespaceURI!==p?(e=b.createElementNS(p,"text:span"),a.insertBefore(e,c),b=!1):(c.previousSibling&&!g.rangeContainsNode(d,a.firstChild)?(e=a.cloneNode(!1),a.parentNode.insertBefore(e,a.nextSibling)):e=a,b=!0);f.forEach(function(a){a.parentNode!==e&&e.appendChild(a)});if(h&&b)for(f=e.cloneNode(!1),e.parentNode.insertBefore(f,e.nextSibling);h;)m.check(),b=h.nextSibling,f.appendChild(h),h=b;return e}var g=new core.DomUtils,p=odf.Namespaces.textns,r=odf.Namespaces.stylens;this.applyStyle=function(d,
g,b){var a={},f,k,h,p;runtime.assert(b&&b.hasOwnProperty("style:text-properties"),"applyStyle without any text properties");a["style:text-properties"]=b["style:text-properties"];h=new e(a);p=new c(a);d.forEach(function(a){f=p.isStyleApplied(a);!1===f&&(k=m(a,g),h.applyStyleToContainer(k))})}};ops.OpApplyDirectStyling=function(){function f(c,d,e){var b=c.getOdfCanvas().odfContainer(),a=p.splitBoundaries(d),f=g.getTextNodes(d,!1);(new odf.TextStyleApplicator(new odf.ObjectNameGenerator(b,h),c.getFormatting(),b.rootElement.automaticStyles)).applyStyle(f,d,e);a.forEach(p.normalizeTextNodes)}var h,d,c,e,m,g=new odf.OdfUtils,p=new core.DomUtils;this.init=function(g){h=g.memberid;d=g.timestamp;c=parseInt(g.position,10);e=parseInt(g.length,10);m=g.setProperties};this.isEdit=!0;this.group=void 0;
this.execute=function(p){var n=p.convertCursorToDomRange(c,e),q=g.getParagraphElements(n);f(p,n,m);n.detach();p.getOdfCanvas().refreshCSS();p.fixCursorPositions();q.forEach(function(b){p.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:b,memberId:h,timeStamp:d})});p.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"ApplyDirectStyling",memberid:h,timestamp:d,position:c,length:e,setProperties:m}}};ops.OpApplyHyperlink=function(){function f(c){for(;c;){if(p.isHyperlink(c))return!0;c=c.parentNode}return!1}var h,d,c,e,m,g=new core.DomUtils,p=new odf.OdfUtils;this.init=function(g){h=g.memberid;d=g.timestamp;c=g.position;e=g.length;m=g.hyperlink};this.isEdit=!0;this.group=void 0;this.execute=function(r){var n=r.getDOMDocument(),q=r.convertCursorToDomRange(c,e),b=g.splitBoundaries(q),a=[],l=p.getTextNodes(q,!1);if(0===l.length)return!1;l.forEach(function(b){var c=p.getParagraphElement(b);runtime.assert(!1===
f(b),"The given range should not contain any link.");var d=m,e=n.createElementNS(odf.Namespaces.textns,"text:a");e.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple");e.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",d);b.parentNode.insertBefore(e,b);e.appendChild(b);-1===a.indexOf(c)&&a.push(c)});b.forEach(g.normalizeTextNodes);q.detach();r.getOdfCanvas().refreshSize();r.getOdfCanvas().rerenderAnnotations();a.forEach(function(a){r.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:a,
memberId:h,timeStamp:d})});return!0};this.spec=function(){return{optype:"ApplyHyperlink",memberid:h,timestamp:d,position:c,length:e,hyperlink:m}}};ops.OpInsertImage=function(){var f,h,d,c,e,m,g,p,r=odf.Namespaces.drawns,n=odf.Namespaces.svgns,q=odf.Namespaces.textns,b=odf.Namespaces.xlinkns;this.init=function(a){f=a.memberid;h=a.timestamp;d=a.position;c=a.filename;e=a.frameWidth;m=a.frameHeight;g=a.frameStyleName;p=a.frameName};this.isEdit=!0;this.group=void 0;this.execute=function(a){var l=a.getOdfCanvas(),k=a.getTextNodeAtStep(d,f),t,s;if(!k)return!1;t=k.textNode;s=a.getParagraphElement(t);var k=k.offset!==t.length?t.splitText(k.offset):t.nextSibling,
w=a.getDOMDocument(),x=w.createElementNS(r,"draw:image"),w=w.createElementNS(r,"draw:frame");x.setAttributeNS(b,"xlink:href",c);x.setAttributeNS(b,"xlink:type","simple");x.setAttributeNS(b,"xlink:show","embed");x.setAttributeNS(b,"xlink:actuate","onLoad");w.setAttributeNS(r,"draw:style-name",g);w.setAttributeNS(r,"draw:name",p);w.setAttributeNS(q,"text:anchor-type","as-char");w.setAttributeNS(n,"svg:width",e);w.setAttributeNS(n,"svg:height",m);w.appendChild(x);t.parentNode.insertBefore(w,k);a.emit(ops.OdtDocument.signalStepsInserted,
{position:d});0===t.length&&t.parentNode.removeChild(t);l.addCssForFrameWithImage(w);l.refreshCSS();a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:s,memberId:f,timeStamp:h});l.rerenderAnnotations();return!0};this.spec=function(){return{optype:"InsertImage",memberid:f,timestamp:h,filename:c,position:d,frameWidth:e,frameHeight:m,frameStyleName:g,frameName:p}}};ops.OpInsertTable=function(){function f(d,b){var a;if(1===n.length)a=n[0];else if(3===n.length)switch(d){case 0:a=n[0];break;case c-1:a=n[2];break;default:a=n[1]}else a=n[d];if(1===a.length)return a[0];if(3===a.length)switch(b){case 0:return a[0];case e-1:return a[2];default:return a[1]}return a[b]}var h,d,c,e,m,g,p,r,n;this.init=function(f){h=f.memberid;d=f.timestamp;m=f.position;c=f.initialRows;e=f.initialColumns;g=f.tableName;p=f.tableStyleName;r=f.tableColumnStyleName;n=f.tableCellStyleMatrix};
this.isEdit=!0;this.group=void 0;this.execute=function(n){var b=n.getTextNodeAtStep(m),a=n.getRootNode();if(b){var l=n.getDOMDocument(),k=l.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),t=l.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column"),s,w,x,v;p&&k.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",p);g&&k.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",g);t.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0",
"table:number-columns-repeated",e);r&&t.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",r);k.appendChild(t);for(x=0;x<c;x+=1){t=l.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row");for(v=0;v<e;v+=1)s=l.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(w=f(x,v))&&s.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",w),w=l.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0",
"text:p"),s.appendChild(w),t.appendChild(s);k.appendChild(t)}b=n.getParagraphElement(b.textNode);a.insertBefore(k,b.nextSibling);n.emit(ops.OdtDocument.signalStepsInserted,{position:m});n.getOdfCanvas().refreshSize();n.emit(ops.OdtDocument.signalTableAdded,{tableElement:k,memberId:h,timeStamp:d});n.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertTable",memberid:h,timestamp:d,position:m,initialRows:c,initialColumns:e,tableName:g,tableStyleName:p,tableColumnStyleName:r,
tableCellStyleMatrix:n}}};ops.OpInsertText=function(){var f,h,d,c,e,m=new odf.OdfUtils;this.init=function(g){f=g.memberid;h=g.timestamp;d=g.position;e=g.text;c="true"===g.moveCursor||!0===g.moveCursor};this.isEdit=!0;this.group=void 0;this.execute=function(g){var p,r,n,q=null,b=g.getDOMDocument(),a,l=0,k,t=g.getCursor(f),s;g.upgradeWhitespacesAtPosition(d);if(p=g.getTextNodeAtStep(d)){r=p.textNode;q=r.nextSibling;n=r.parentNode;a=g.getParagraphElement(r);for(s=0;s<e.length;s+=1)if("\t"===e[s]||"\t"!==e[s]&&m.isODFWhitespace(e[s])&&
(0===s||s===e.length-1||"\t"!==e[s-1]&&m.isODFWhitespace(e[s-1])))0===l?(p.offset!==r.length&&(q=r.splitText(p.offset)),0<s&&r.appendData(e.substring(0,s))):l<s&&(l=e.substring(l,s),n.insertBefore(b.createTextNode(l),q)),l=s+1,"\t"===e[s]?(k=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab"),k.appendChild(b.createTextNode("\t"))):(" "!==e[s]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+e.charCodeAt(s)+")"),
k=b.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s"),k.appendChild(b.createTextNode(" "))),n.insertBefore(k,q);0===l?r.insertData(p.offset,e):l<e.length&&(p=e.substring(l),n.insertBefore(b.createTextNode(p),q));n=r.parentNode;q=r.nextSibling;n.removeChild(r);n.insertBefore(r,q);0===r.length&&r.parentNode.removeChild(r);g.emit(ops.OdtDocument.signalStepsInserted,{position:d});t&&c&&(g.moveCursor(f,d+e.length,0),g.emit(ops.Document.signalCursorMoved,t));g.downgradeWhitespacesAtPosition(d);
g.downgradeWhitespacesAtPosition(d+e.length);g.getOdfCanvas().refreshSize();g.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:a,memberId:f,timeStamp:h});g.getOdfCanvas().rerenderAnnotations();return!0}return!1};this.spec=function(){return{optype:"InsertText",memberid:f,timestamp:h,position:d,text:e,moveCursor:c}}};odf.CollapsingRules=function(f){function h(d){return c.isODFNode(d)||"br"===d.localName&&c.isLineBreak(d.parentNode)||d.nodeType===Node.TEXT_NODE&&c.isODFNode(d.parentNode)}function d(m){var g;m.nodeType===Node.TEXT_NODE?(g=m.parentNode,g.removeChild(m)):g=e.removeUnwantedNodes(m,h);return g&&!c.isParagraph(g)&&g!==f&&c.hasNoODFContent(g)?d(g):g}var c=new odf.OdfUtils,e=new core.DomUtils;this.mergeChildrenIntoParent=d};ops.OpMergeParagraph=function(){function f(a){a.collapsed||(q.splitBoundaries(a),a=n.getTextElements(a,!1,!0),a.forEach(function(a){runtime.assert(a.nodeType===Node.TEXT_NODE,"Expected node type 3 (Node.TEXT_NODE), found node type "+a.nodeType);0<a.length?(runtime.assert(n.isODFWhitespace(a.data),"Non-whitespace node found between paragraph boundary and first or last step"),runtime.assert(!1===n.isSignificantWhitespace(a,0),"Significant whitespace node found between paragraph boundary and first or last step")):
runtime.log("WARN: Empty text node found during merge operation");a.parentNode.removeChild(a)}))}function h(a,b){var c=b.ownerDocument.createRange();a.setPosition(b,0);a.roundToNextStep();c.setStart(b,0);c.setEnd(a.container(),a.offset());f(c);a.setPosition(b,b.childNodes.length);a.roundToPreviousStep();c.setStart(a.container(),a.offset());c.setEnd(b,b.childNodes.length);f(c)}function d(a,b){var c=a.convertCursorStepToDomPoint(b),c=n.getParagraphElement(c.node,c.offset);runtime.assert(Boolean(c),
"Paragraph not found at step "+b);return c}var c,e,m,g,p,r,n=new odf.OdfUtils,q=new core.DomUtils,b=odf.Namespaces.textns;this.init=function(a){c=a.memberid;e=a.timestamp;m=a.moveCursor;g=a.paragraphStyleName;p=parseInt(a.sourceStartPosition,10);r=parseInt(a.destinationStartPosition,10)};this.isEdit=!0;this.group=void 0;this.execute=function(a){var f,k,t=a.getCursor(c);f=a.getRootNode();var s=new odf.CollapsingRules(f),w=a.createStepIterator(f,0,[a.getPositionFilter()],f),x;runtime.assert(r<p,"Destination paragraph ("+
r+") must be before source paragraph ("+p+")");k=d(a,r);f=d(a,p);w.setPosition(f,0);w.previousStep();runtime.assert(q.containsNode(k,w.container()),"Destination paragraph must be adjacent to the source paragraph");h(w,k);x=k.childNodes.length;h(w,f);var v;for(v=f.firstChild;v;)"editinfo"===v.localName||n.isGroupingElement(v)&&n.hasNoODFContent(v)?f.removeChild(v):k.appendChild(v),v=f.firstChild;s.mergeChildrenIntoParent(f);a.emit(ops.OdtDocument.signalStepsRemoved,{position:p-1});w.setPosition(k,
x);w.roundToClosestStep();w.previousStep()||w.roundToNextStep();a.downgradeWhitespaces(w);g?k.setAttributeNS(b,"text:style-name",g):k.removeAttributeNS(b,"style-name");t&&m&&(a.moveCursor(c,p-1,0),a.emit(ops.Document.signalCursorMoved,t));a.fixCursorPositions();a.getOdfCanvas().refreshSize();a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:k,memberId:c,timeStamp:e});a.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"MergeParagraph",memberid:c,timestamp:e,
moveCursor:m,paragraphStyleName:g,sourceStartPosition:p,destinationStartPosition:r}}};ops.OpMoveCursor=function(){var f,h,d,c,e;this.init=function(m){f=m.memberid;h=m.timestamp;d=m.position;c=m.length||0;e=m.selectionType||ops.OdtCursor.RangeSelection};this.isEdit=!1;this.group=void 0;this.execute=function(h){var g=h.getCursor(f),p;if(!g)return!1;p=h.convertCursorToDomRange(d,c);g.setSelectedRange(p,0<=c);g.setSelectionType(e);h.emit(ops.Document.signalCursorMoved,g);return!0};this.spec=function(){return{optype:"MoveCursor",memberid:f,timestamp:h,position:d,length:c,selectionType:e}}};ops.OpRemoveAnnotation=function(){var f,h,d,c,e;this.init=function(m){f=m.memberid;h=m.timestamp;d=parseInt(m.position,10);c=parseInt(m.length,10);e=new core.DomUtils};this.isEdit=!0;this.group=void 0;this.execute=function(c){function g(c){h.parentNode.insertBefore(c,h)}for(var f=c.getIteratorAtPosition(d).container(),h;f.namespaceURI!==odf.Namespaces.officens||"annotation"!==f.localName;)f=f.parentNode;if(null===f)return!1;h=f;f=h.annotationEndElement;c.getOdfCanvas().forgetAnnotations();e.getElementsByTagNameNS(h,
"urn:webodf:names:cursor","cursor").forEach(g);e.getElementsByTagNameNS(h,"urn:webodf:names:cursor","anchor").forEach(g);h.parentNode.removeChild(h);f&&f.parentNode.removeChild(f);c.emit(ops.OdtDocument.signalStepsRemoved,{position:0<d?d-1:d});c.fixCursorPositions();c.getOdfCanvas().refreshAnnotations();return!0};this.spec=function(){return{optype:"RemoveAnnotation",memberid:f,timestamp:h,position:d,length:c}}};ops.OpRemoveBlob=function(){var f,h,d;this.init=function(c){f=c.memberid;h=c.timestamp;d=c.filename};this.isEdit=!0;this.group=void 0;this.execute=function(c){c.getOdfCanvas().odfContainer().removeBlob(d);return!0};this.spec=function(){return{optype:"RemoveBlob",memberid:f,timestamp:h,filename:d}}};ops.OpRemoveCursor=function(){var f,h;this.init=function(d){f=d.memberid;h=d.timestamp};this.isEdit=!1;this.group=void 0;this.execute=function(d){return d.removeCursor(f)?!0:!1};this.spec=function(){return{optype:"RemoveCursor",memberid:f,timestamp:h}}};ops.OpRemoveHyperlink=function(){var f,h,d,c,e=new core.DomUtils,m=new odf.OdfUtils;this.init=function(e){f=e.memberid;h=e.timestamp;d=e.position;c=e.length};this.isEdit=!0;this.group=void 0;this.execute=function(g){var p=g.convertCursorToDomRange(d,c),r=m.getHyperlinkElements(p);runtime.assert(1===r.length,"The given range should only contain a single link.");r=e.mergeIntoParent(r[0]);p.detach();g.getOdfCanvas().refreshSize();g.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:m.getParagraphElement(r),
memberId:f,timeStamp:h});g.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"RemoveHyperlink",memberid:f,timestamp:h,position:d,length:c}}};ops.OpRemoveMember=function(){var f,h;this.init=function(d){f=d.memberid;h=parseInt(d.timestamp,10)};this.isEdit=!1;this.group=void 0;this.execute=function(d){if(!d.getMember(f))return!1;d.removeMember(f);d.emit(ops.Document.signalMemberRemoved,f);return!0};this.spec=function(){return{optype:"RemoveMember",memberid:f,timestamp:h}}};ops.OpRemoveStyle=function(){var f,h,d,c;this.init=function(e){f=e.memberid;h=e.timestamp;d=e.styleName;c=e.styleFamily};this.isEdit=!0;this.group=void 0;this.execute=function(e){var f=e.getStyleElement(d,c);if(!f)return!1;f.parentNode.removeChild(f);e.getOdfCanvas().refreshCSS();e.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:d,family:c});return!0};this.spec=function(){return{optype:"RemoveStyle",memberid:f,timestamp:h,styleName:d,styleFamily:c}}};ops.OpRemoveText=function(){var f,h,d,c,e,m;this.init=function(g){runtime.assert(0<=g.length,"OpRemoveText only supports positive lengths");f=g.memberid;h=g.timestamp;d=parseInt(g.position,10);c=parseInt(g.length,10);e=new odf.OdfUtils;m=new core.DomUtils};this.isEdit=!0;this.group=void 0;this.execute=function(g){var p,r,n,q=g.getCursor(f),b=new odf.CollapsingRules(g.getRootNode());g.upgradeWhitespacesAtPosition(d);g.upgradeWhitespacesAtPosition(d+c);p=g.convertCursorToDomRange(d,c);m.splitBoundaries(p);
r=e.getTextElements(p,!1,!0);n=e.getParagraphElement(p.startContainer,p.startOffset);runtime.assert(void 0!==n,"Attempting to remove text outside a paragraph element");p.detach();r.forEach(function(a){a.parentNode?(runtime.assert(m.containsNode(n,a),"RemoveText only supports removing elements within the same paragraph"),b.mergeChildrenIntoParent(a)):runtime.log("WARN: text element has already been removed from it's container")});g.emit(ops.OdtDocument.signalStepsRemoved,{position:d});g.downgradeWhitespacesAtPosition(d);
g.fixCursorPositions();g.getOdfCanvas().refreshSize();g.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:n,memberId:f,timeStamp:h});q&&(q.resetSelectionType(),g.emit(ops.Document.signalCursorMoved,q));g.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"RemoveText",memberid:f,timestamp:h,position:d,length:c}}};ops.OpSetBlob=function(){var f,h,d,c,e;this.init=function(m){f=m.memberid;h=m.timestamp;d=m.filename;c=m.mimetype;e=m.content};this.isEdit=!0;this.group=void 0;this.execute=function(f){f.getOdfCanvas().odfContainer().setBlob(d,c,e);return!0};this.spec=function(){return{optype:"SetBlob",memberid:f,timestamp:h,filename:d,mimetype:c,content:e}}};ops.OpSetParagraphStyle=function(){function f(c,d,e){var f=[c.getPositionFilter()],h=e.container();e=e.unfilteredDomOffset();return!1===c.createStepIterator(h,e,f,d).previousStep()}var h,d,c,e;this.init=function(f){h=f.memberid;d=f.timestamp;c=f.position;e=f.styleName};this.isEdit=!0;this.group=void 0;this.execute=function(m){var g,p;g=m.getIteratorAtPosition(c);return(p=m.getParagraphElement(g.container()))?(runtime.assert(f(m,p,g),"SetParagraphStyle position should be the first position in the paragraph"),
e?p.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",e):p.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),m.getOdfCanvas().refreshSize(),m.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:p,timeStamp:d,memberId:h}),m.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=function(){return{optype:"SetParagraphStyle",memberid:h,timestamp:d,position:c,styleName:e}}};ops.OpSplitParagraph=function(){var f,h,d,c,e,m,g,p=odf.Namespaces.textns;this.init=function(p){f=p.memberid;h=p.timestamp;c=p.position;d=p.sourceParagraphPosition;m=p.paragraphStyleName;e="true"===p.moveCursor||!0===p.moveCursor;g=new odf.OdfUtils};this.isEdit=!0;this.group=void 0;this.execute=function(d){var n,q,b,a,l,k,t,s=d.getCursor(f);d.upgradeWhitespacesAtPosition(c);n=d.getTextNodeAtStep(c);if(!n)return!1;q=d.getParagraphElement(n.textNode);if(!q)return!1;b=g.isListItem(q.parentNode)?q.parentNode:
q;0===n.offset?(t=n.textNode.previousSibling,k=null):(t=n.textNode,k=n.offset>=n.textNode.length?null:n.textNode.splitText(n.offset));for(a=n.textNode;a!==b;){a=a.parentNode;l=a.cloneNode(!1);k&&l.appendChild(k);if(t)for(;t&&t.nextSibling;)l.appendChild(t.nextSibling);else for(;a.firstChild;)l.appendChild(a.firstChild);a.parentNode.insertBefore(l,a.nextSibling);t=a;k=l}g.isListItem(k)&&(k=k.childNodes.item(0));m?k.setAttributeNS(p,"text:style-name",m):k.removeAttributeNS(p,"style-name");0===n.textNode.length&&
n.textNode.parentNode.removeChild(n.textNode);d.emit(ops.OdtDocument.signalStepsInserted,{position:c});s&&e&&(d.moveCursor(f,c+1,0),d.emit(ops.Document.signalCursorMoved,s));d.fixCursorPositions();d.getOdfCanvas().refreshSize();d.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:q,memberId:f,timeStamp:h});d.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:k,memberId:f,timeStamp:h});d.getOdfCanvas().rerenderAnnotations();return!0};this.spec=function(){return{optype:"SplitParagraph",
memberid:f,timestamp:h,position:c,sourceParagraphPosition:d,paragraphStyleName:m,moveCursor:e}}};ops.OpUpdateMember=function(){function f(d){var e="//dc:creator[@editinfo:memberid='"+h+"']";d=xmldom.XPath.getODFElementsWithXPath(d.getRootNode(),e,function(c){return"editinfo"===c?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(c)});for(e=0;e<d.length;e+=1)d[e].textContent=c.fullName}var h,d,c,e;this.init=function(f){h=f.memberid;d=parseInt(f.timestamp,10);c=f.setProperties;e=f.removedProperties};this.isEdit=!1;this.group=void 0;this.execute=function(d){var g=d.getMember(h);if(!g)return!1;
e&&g.removeProperties(e);c&&(g.setProperties(c),c.fullName&&f(d));d.emit(ops.Document.signalMemberUpdated,g);return!0};this.spec=function(){return{optype:"UpdateMember",memberid:h,timestamp:d,setProperties:c,removedProperties:e}}};ops.OpUpdateMetadata=function(){var f,h,d,c;this.init=function(e){f=e.memberid;h=parseInt(e.timestamp,10);d=e.setProperties;c=e.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(e){e=e.getOdfCanvas().odfContainer();var f=null;c&&(f=c.attributes.split(","));e.setMetadata(d,f);return!0};this.spec=function(){return{optype:"UpdateMetadata",memberid:f,timestamp:h,setProperties:d,removedProperties:c}}};ops.OpUpdateParagraphStyle=function(){function f(c,d){var e,g,b=d?d.split(","):[];for(e=0;e<b.length;e+=1)g=b[e].split(":"),c.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(g[0]),g[1])}var h,d,c,e,m,g=odf.Namespaces.stylens;this.init=function(g){h=g.memberid;d=g.timestamp;c=g.styleName;e=g.setProperties;m=g.removedProperties};this.isEdit=!0;this.group=void 0;this.execute=function(d){var h=d.getFormatting(),n,q,b;return(n=""!==c?d.getParagraphStyleElement(c):h.getDefaultStyleElement("paragraph"))?
(q=n.getElementsByTagNameNS(g,"paragraph-properties").item(0),b=n.getElementsByTagNameNS(g,"text-properties").item(0),e&&h.updateStyle(n,e),m&&(h=m["style:paragraph-properties"],q&&h&&(f(q,h.attributes),0===q.attributes.length&&n.removeChild(q)),h=m["style:text-properties"],b&&h&&(f(b,h.attributes),0===b.attributes.length&&n.removeChild(b)),f(n,m.attributes)),d.getOdfCanvas().refreshCSS(),d.emit(ops.OdtDocument.signalParagraphStyleModified,c),d.getOdfCanvas().rerenderAnnotations(),!0):!1};this.spec=
function(){return{optype:"UpdateParagraphStyle",memberid:h,timestamp:d,styleName:c,setProperties:e,removedProperties:m}}};ops.OperationFactory=function(){function f(d){return function(c){return new d}}var h;this.register=function(d,c){h[d]=c};this.create=function(d){var c=null,e=h[d.optype];e&&(c=e(d),c.init(d));return c};h={AddMember:f(ops.OpAddMember),UpdateMember:f(ops.OpUpdateMember),RemoveMember:f(ops.OpRemoveMember),AddCursor:f(ops.OpAddCursor),ApplyDirectStyling:f(ops.OpApplyDirectStyling),SetBlob:f(ops.OpSetBlob),RemoveBlob:f(ops.OpRemoveBlob),InsertImage:f(ops.OpInsertImage),InsertTable:f(ops.OpInsertTable),
InsertText:f(ops.OpInsertText),RemoveText:f(ops.OpRemoveText),MergeParagraph:f(ops.OpMergeParagraph),SplitParagraph:f(ops.OpSplitParagraph),SetParagraphStyle:f(ops.OpSetParagraphStyle),UpdateParagraphStyle:f(ops.OpUpdateParagraphStyle),AddStyle:f(ops.OpAddStyle),RemoveStyle:f(ops.OpRemoveStyle),MoveCursor:f(ops.OpMoveCursor),RemoveCursor:f(ops.OpRemoveCursor),AddAnnotation:f(ops.OpAddAnnotation),RemoveAnnotation:f(ops.OpRemoveAnnotation),UpdateMetadata:f(ops.OpUpdateMetadata),ApplyHyperlink:f(ops.OpApplyHyperlink),
RemoveHyperlink:f(ops.OpRemoveHyperlink)}};ops.OperationRouter=function(){};ops.OperationRouter.prototype.setOperationFactory=function(f){};ops.OperationRouter.prototype.setPlaybackFunction=function(f){};ops.OperationRouter.prototype.push=function(f){};ops.OperationRouter.prototype.close=function(f){};ops.OperationRouter.prototype.subscribe=function(f,h){};ops.OperationRouter.prototype.unsubscribe=function(f,h){};ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){};ops.OperationRouter.prototype.hasSessionHostConnection=function(){};
ops.OperationRouter.signalProcessingBatchStart="router/batchstart";ops.OperationRouter.signalProcessingBatchEnd="router/batchend";ops.TrivialOperationRouter=function(){var f=new core.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),h,d,c=0;this.setOperationFactory=function(c){h=c};this.setPlaybackFunction=function(c){d=c};this.push=function(e){c+=1;f.emit(ops.OperationRouter.signalProcessingBatchStart,{});e.forEach(function(e){e=e.spec();e.timestamp=Date.now();e=h.create(e);e.group="g"+c;d(e)});f.emit(ops.OperationRouter.signalProcessingBatchEnd,{})};this.close=function(c){c()};
this.subscribe=function(c,d){f.subscribe(c,d)};this.unsubscribe=function(c,d){f.unsubscribe(c,d)};this.hasLocalUnsyncedOps=function(){return!1};this.hasSessionHostConnection=function(){return!0}};ops.Session=function(f){function h(c){e.emit(ops.OdtDocument.signalProcessingBatchStart,c)}function d(c){e.emit(ops.OdtDocument.signalProcessingBatchEnd,c)}var c=new ops.OperationFactory,e=new ops.OdtDocument(f),m=null;this.setOperationFactory=function(d){c=d;m&&m.setOperationFactory(c)};this.setOperationRouter=function(g){m&&(m.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,h),m.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,d));m=g;m.subscribe(ops.OperationRouter.signalProcessingBatchStart,
h);m.subscribe(ops.OperationRouter.signalProcessingBatchEnd,d);g.setPlaybackFunction(function(c){e.emit(ops.OdtDocument.signalOperationStart,c);return c.execute(e)?(e.emit(ops.OdtDocument.signalOperationEnd,c),!0):!1});g.setOperationFactory(c)};this.getOperationFactory=function(){return c};this.getOdtDocument=function(){return e};this.enqueue=function(c){m.push(c)};this.close=function(c){m.close(function(d){d?c(d):e.close(c)})};this.destroy=function(c){e.destroy(c)};this.setOperationRouter(new ops.TrivialOperationRouter)};gui.AnnotationController=function(f,h,d){function c(){var b=p.getCursor(d),b=b&&b.getNode(),a=!1;b&&(a=!q.isWithinAnnotation(b,p.getRootNode()));a!==r&&(r=a,n.emit(gui.AnnotationController.annotatableChanged,r))}function e(b){b.getMemberId()===d&&c()}function m(b){b===d&&c()}function g(b){b.getMemberId()===d&&c()}var p=f.getOdtDocument(),r=!1,n=new core.EventNotifier([gui.AnnotationController.annotatableChanged]),q=new odf.OdfUtils;this.isAnnotatable=function(){return r};this.addAnnotation=function(){var b=
new ops.OpAddAnnotation,a=p.getCursorSelection(d),c=a.length,a=a.position;r&&(a=0<=c?a:a+c,c=Math.abs(c),b.init({memberid:d,position:a,length:c,name:d+Date.now()}),f.enqueue([b]))};this.removeAnnotation=function(b){var a,c;a=p.getMember(d).getProperties().fullName;if(!0!==h.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)||a===q.getAnnotationCreator(b))a=p.convertDomPointToCursorStep(b,0)+1,c=p.convertDomPointToCursorStep(b,b.childNodes.length),b=new ops.OpRemoveAnnotation,b.init({memberid:d,
position:a,length:c-a}),c=new ops.OpMoveCursor,c.init({memberid:d,position:0<a?a-1:a,length:0}),f.enqueue([b,c])};this.subscribe=function(b,a){n.subscribe(b,a)};this.unsubscribe=function(b,a){n.unsubscribe(b,a)};this.destroy=function(b){p.unsubscribe(ops.Document.signalCursorAdded,e);p.unsubscribe(ops.Document.signalCursorRemoved,m);p.unsubscribe(ops.Document.signalCursorMoved,g);b()};h.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN);p.subscribe(ops.Document.signalCursorAdded,
e);p.subscribe(ops.Document.signalCursorRemoved,m);p.subscribe(ops.Document.signalCursorMoved,g);c()};gui.AnnotationController.annotatableChanged="annotatable/changed";gui.Avatar=function(f,h){var d=this,c,e,m;this.setColor=function(c){e.style.borderColor=c};this.setImageUrl=function(c){d.isVisible()?e.src=c:m=c};this.isVisible=function(){return"block"===c.style.display};this.show=function(){m&&(e.src=m,m=void 0);c.style.display="block"};this.hide=function(){c.style.display="none"};this.markAsFocussed=function(d){d?c.classList.add("active"):c.classList.remove("active")};this.destroy=function(d){f.removeChild(c);d()};(function(){var d=f.ownerDocument,m=d.documentElement.namespaceURI;
c=d.createElementNS(m,"div");e=d.createElementNS(m,"img");e.width=64;e.height=64;c.appendChild(e);c.style.width="64px";c.style.height="70px";c.style.position="absolute";c.style.top="-80px";c.style.left="-34px";c.style.display=h?"block":"none";c.className="handle";f.appendChild(c)})()};gui.GuiStepUtils=function(){var f=new odf.OdfUtils,h=new odf.StepUtils,d=new core.DomUtils;this.getContentRect=function(c){c=h.getContentBounds(c);var e,m=null;if(c)if(c.container.nodeType===Node.TEXT_NODE)e=c.container.ownerDocument.createRange(),e.setStart(c.container,c.startOffset),e.setEnd(c.container,c.endOffset),(m=0<e.getClientRects().length?e.getBoundingClientRect():null)&&" "===c.container.data.substring(c.startOffset,c.endOffset)&&1>=m.width&&(m=null),e.detach();else if(f.isCharacterElement(c.container)||
f.isCharacterFrame(c.container))m=d.getBoundingClientRect(c.container);return m}};gui.Caret=function(f,h,d){function c(){n.style.opacity="0"===n.style.opacity?"1":"0";v.trigger()}function e(){l.selectNodeContents(a);return l.getBoundingClientRect()}function m(){Object.keys(I).forEach(function(a){A[a]=I[a]})}function g(){var a,c,g,h;if(!1===I.isShown||f.getSelectionType()!==ops.OdtCursor.RangeSelection||!d&&!f.getSelectedRange().collapsed)I.visibility="hidden",n.style.visibility="hidden",v.cancel();else{I.visibility="visible";n.style.visibility="visible";if(!1===I.isFocused)n.style.opacity=
"1",v.cancel();else{if(z||A.visibility!==I.visibility)n.style.opacity="1",v.cancel();v.trigger()}if(C||u||A.visibility!==I.visibility){a=f.getNode();var l;g=t.getBoundingClientRect(k.getSizer());h=!1;if(0<a.getClientRects().length)l=e(),h=!0;else if(w.setPosition(a,0),l=s.getContentRect(w),!l&&w.nextStep()&&(c=s.getContentRect(w))&&(l=c,h=!0),l||(a.setAttributeNS("urn:webodf:names:cursor","caret-sizer-active","true"),l=e(),h=!0),!l)for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+
f.getMemberId());a;){if(0<a.getClientRects().length){l=t.getBoundingClientRect(a);h=!0;break}a=a.parentNode}l=t.translateRect(l,g,k.getZoomLevel());a={top:l.top,height:l.height,right:h?l.left:l.right};8>a.height&&(a={top:a.top-(8-a.height)/2,height:8,right:a.right});r.style.height=a.height+"px";r.style.top=a.top+"px";r.style.left=a.right+"px";b&&(a=runtime.getWindow().getComputedStyle(n,null),a.font?b.style.font=a.font:(b.style.fontStyle=a.fontStyle,b.style.fontVariant=a.fontVariant,b.style.fontWeight=
a.fontWeight,b.style.fontSize=a.fontSize,b.style.lineHeight=a.lineHeight,b.style.fontFamily=a.fontFamily))}if(u){l=f.getDocument().getCanvas().getElement().parentNode;var p;g=l.offsetWidth-l.clientWidth+5;h=l.offsetHeight-l.clientHeight+5;p=n.getBoundingClientRect();a=p.left-g;c=p.top-h;g=p.right+g;h=p.bottom+h;p=l.getBoundingClientRect();c<p.top?l.scrollTop-=p.top-c:h>p.bottom&&(l.scrollTop+=h-p.bottom);a<p.left?l.scrollLeft-=p.left-a:g>p.right&&(l.scrollLeft+=g-p.right)}}A.isFocused!==I.isFocused&&
q.markAsFocussed(I.isFocused);m();C=u=z=!1}function p(b){r.parentNode.removeChild(r);a.parentNode.removeChild(a);b()}var r,n,q,b,a,l,k=f.getDocument().getCanvas(),t=new core.DomUtils,s=new gui.GuiStepUtils,w,x,v,z=!1,u=!1,C=!1,I={isFocused:!1,isShown:!0,visibility:"hidden"},A={isFocused:!I.isFocused,isShown:!I.isShown,visibility:"hidden"};this.handleUpdate=function(){C=!0;"hidden"!==I.visibility&&(I.visibility="hidden",n.style.visibility="hidden",f.getNode().removeAttributeNS("urn:webodf:names:cursor",
"caret-sizer-active"));x.trigger()};this.refreshCursorBlinking=function(){z=!0;x.trigger()};this.setFocus=function(){I.isFocused=!0;x.trigger()};this.removeFocus=function(){I.isFocused=!1;x.trigger()};this.show=function(){I.isShown=!0;x.trigger()};this.hide=function(){I.isShown=!1;x.trigger()};this.setAvatarImageUrl=function(a){q.setImageUrl(a)};this.setColor=function(a){n.style.borderColor=a;q.setColor(a)};this.getCursor=function(){return f};this.getFocusElement=function(){return n};this.toggleHandleVisibility=
function(){q.isVisible()?q.hide():q.show()};this.showHandle=function(){q.show()};this.hideHandle=function(){q.hide()};this.setOverlayElement=function(a){b=a;r.appendChild(a);C=!0;x.trigger()};this.ensureVisible=function(){u=!0;x.trigger()};this.destroy=function(a){core.Async.destroyAll([x.destroy,v.destroy,q.destroy,p],a)};(function(){var b=f.getDocument(),d=[b.createRootFilter(f.getMemberId()),b.getPositionFilter()],e=b.getDOMDocument();l=e.createRange();a=e.createElement("span");a.className="webodf-caretSizer";
a.textContent="|";f.getNode().appendChild(a);r=e.createElement("div");r.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",f.getMemberId());r.className="webodf-caretOverlay";n=e.createElement("div");n.className="caret";r.appendChild(n);q=new gui.Avatar(r,h);k.getSizer().appendChild(r);w=b.createStepIterator(f.getNode(),0,d,b.getRootNode());x=core.Task.createRedrawTask(g);v=core.Task.createTimeoutTask(c,500);x.triggerImmediate()})()};odf.TextSerializer=function(){function f(c){var e="",m=h.filter?h.filter.acceptNode(c):NodeFilter.FILTER_ACCEPT,g=c.nodeType,p;if((m===NodeFilter.FILTER_ACCEPT||m===NodeFilter.FILTER_SKIP)&&d.isTextContentContainingNode(c))for(p=c.firstChild;p;)e+=f(p),p=p.nextSibling;m===NodeFilter.FILTER_ACCEPT&&(g===Node.ELEMENT_NODE&&d.isParagraph(c)?e+="\n":g===Node.TEXT_NODE&&c.textContent&&(e+=c.textContent));return e}var h=this,d=new odf.OdfUtils;this.filter=null;this.writeToString=function(c){if(!c)return"";
c=f(c);"\n"===c[c.length-1]&&(c=c.substr(0,c.length-1));return c}};gui.MimeDataExporter=function(){var f;this.exportRangeToDataTransfer=function(h,d){var c;c=d.startContainer.ownerDocument.createElement("span");c.appendChild(d.cloneContents());c=f.writeToString(c);try{h.setData("text/plain",c)}catch(e){h.setData("Text",c)}};f=new odf.TextSerializer;f.filter=new odf.OdfNodeFilter};gui.Clipboard=function(f){this.setDataFromRange=function(h,d){var c,e=h.clipboardData;c=runtime.getWindow();!e&&c&&(e=c.clipboardData);e?(c=!0,f.exportRangeToDataTransfer(e,d),h.preventDefault()):c=!1;return c}};gui.SessionContext=function(f,h){var d=f.getOdtDocument(),c=new odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var e=d.getCursor(h),f;if(!e)return!1;f=e&&e.getNode();e=d.getMember(h).getProperties().fullName;return(f=c.getParentAnnotation(f,d.getRootNode()))&&c.getAnnotationCreator(f)===e?!0:!1}};gui.StyleSummary=function(f){function h(c,d){var h=c+"|"+d,r;e.hasOwnProperty(h)||(r=[],f.forEach(function(e){e=(e=e[c])&&e[d];-1===r.indexOf(e)&&r.push(e)}),e[h]=r);return e[h]}function d(c,d,e){return function(){var f=h(c,d);return e.length>=f.length&&f.every(function(c){return-1!==e.indexOf(c)})}}function c(c,d){var e=h(c,d);return 1===e.length?e[0]:void 0}var e={};this.getPropertyValues=h;this.getCommonValue=c;this.isBold=d("style:text-properties","fo:font-weight",["bold"]);this.isItalic=d("style:text-properties",
"fo:font-style",["italic"]);this.hasUnderline=d("style:text-properties","style:text-underline-style",["solid"]);this.hasStrikeThrough=d("style:text-properties","style:text-line-through-style",["solid"]);this.fontSize=function(){var d=c("style:text-properties","fo:font-size");return d&&parseFloat(d)};this.fontName=function(){return c("style:text-properties","style:font-name")};this.isAlignedLeft=d("style:paragraph-properties","fo:text-align",["left","start"]);this.isAlignedCenter=d("style:paragraph-properties",
"fo:text-align",["center"]);this.isAlignedRight=d("style:paragraph-properties","fo:text-align",["right","end"]);this.isAlignedJustified=d("style:paragraph-properties","fo:text-align",["justify"]);this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName};this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,isAlignedJustified:this.isAlignedJustified}};gui.DirectFormattingController=function(f,h,d,c,e,m,g){function p(){return P.value().styleSummary}function r(a){var b;a.collapsed?(b=a.startContainer,b.hasChildNodes()&&a.startOffset<b.childNodes.length&&(b=b.childNodes.item(a.startOffset)),a=[b]):a=ga.getTextElements(a,!0,!1);return a}function n(){var a=B.getCursor(c),a=(a=a&&a.getSelectedRange())?r(a):[],a=B.getFormatting().getAppliedStyles(a);a[0]&&T&&(a[0]=X.mergeObjects(a[0],T));return{appliedStyles:a,styleSummary:new gui.StyleSummary(a)}}function q(a,
b){var c={};Object.keys(a).forEach(function(d){var e=a[d](),f=b[d]();e!==f&&(c[d]=f)});return c}function b(){var a,b,c=p();a=q(y.text,c.text);b=q(y.paragraph,c.paragraph);y=c;0<Object.keys(a).length&&ca.emit(gui.DirectFormattingController.textStylingChanged,a);0<Object.keys(b).length&&ca.emit(gui.DirectFormattingController.paragraphStylingChanged,b)}function a(){var a=!0;!0===h.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(a=d.isLocalCursorWithinOwnAnnotation());a!==M&&(M=a,ca.emit(gui.DirectFormattingController.enabledChanged,
M))}function l(b){("string"===typeof b?b:b.getMemberId())===c&&(P.reset(),a())}function k(){P.reset()}function t(a){var b=B.getCursor(c);a=a.paragraphElement;b&&B.getParagraphElement(b.getNode())===a&&P.reset()}function s(a,b){b(!a());return!0}function w(a){if(M){var b=B.getCursorSelection(c),d={"style:text-properties":a};0!==b.length?(a=new ops.OpApplyDirectStyling,a.init({memberid:c,position:b.position,length:b.length,setProperties:d}),f.enqueue([a])):(T=X.mergeObjects(T||{},d),P.reset())}}function x(a,
b){var c={};c[a]=b;w(c)}function v(a){a=a.spec();T&&a.memberid===c&&"SplitParagraph"!==a.optype&&(T=null,P.reset())}function z(a){x("fo:font-weight",a?"bold":"normal")}function u(a){x("fo:font-style",a?"italic":"normal")}function C(a){x("style:text-underline-style",a?"solid":"none")}function I(a){x("style:text-line-through-style",a?"solid":"none")}function A(a){return a===ops.OdtStepsTranslator.NEXT_STEP}function K(a){if(M){var b=B.getCursor(c).getSelectedRange(),b=ga.getParagraphElements(b),d=B.getFormatting(),
g=[],k={},h;b.forEach(function(b){var f=B.convertDomPointToCursorStep(b,0,A),l=b.getAttributeNS(odf.Namespaces.textns,"style-name"),m;b=l?k.hasOwnProperty(l)?k[l]:void 0:h;b||(b=e.generateStyleName(),l?(k[l]=b,m=d.createDerivedStyleObject(l,"paragraph",{})):(h=b,m={}),m=a(m),l=new ops.OpAddStyle,l.init({memberid:c,styleName:b.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:m}),g.push(l));l=new ops.OpSetParagraphStyle;l.init({memberid:c,styleName:b.toString(),position:f});g.push(l)});
f.enqueue(g)}}function J(a){K(function(b){return X.mergeObjects(b,a)})}function H(a){J({"style:paragraph-properties":{"fo:text-align":a}})}function U(a,b){var c=B.getFormatting().getDefaultTabStopDistance(),d=b["style:paragraph-properties"],e;d&&(d=d["fo:margin-left"],e=ga.parseLength(d));return X.mergeObjects(b,{"style:paragraph-properties":{"fo:margin-left":e&&e.unit===c.unit?e.value+a*c.value+e.unit:a*c.value+c.unit}})}function W(a,b){var c=r(a),d=B.getFormatting().getAppliedStyles(c)[0],e=B.getFormatting().getAppliedStylesForElement(b);
if(!d||"text"!==d["style:family"]||!d["style:text-properties"])return!1;if(!e||!e["style:text-properties"])return!0;d=d["style:text-properties"];e=e["style:text-properties"];return!Object.keys(d).every(function(a){return d[a]===e[a]})}function E(){}function aa(){return!1}var O=this,B=f.getOdtDocument(),X=new core.Utils,ga=new odf.OdfUtils,ca=new core.EventNotifier([gui.DirectFormattingController.enabledChanged,gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),
Z=odf.Namespaces.textns,D=core.PositionFilter.FilterResult.FILTER_ACCEPT,T,y,P,M=!1;this.isEnabled=function(){return M};this.formatTextSelection=w;this.createCursorStyleOp=function(a,b,d){var e=null;(d=d?P.value().appliedStyles[0]:T)&&d["style:text-properties"]&&(e=new ops.OpApplyDirectStyling,e.init({memberid:c,position:a,length:b,setProperties:{"style:text-properties":d["style:text-properties"]}}),T=null,P.reset());return e};this.setBold=z;this.setItalic=u;this.setHasUnderline=C;this.setHasStrikethrough=
I;this.setFontSize=function(a){x("fo:font-size",a+"pt")};this.setFontName=function(a){x("style:font-name",a)};this.getAppliedStyles=function(){return P.value().appliedStyles};this.toggleBold=s.bind(O,function(){return p().isBold()},z);this.toggleItalic=s.bind(O,function(){return p().isItalic()},u);this.toggleUnderline=s.bind(O,function(){return p().hasUnderline()},C);this.toggleStrikethrough=s.bind(O,function(){return p().hasStrikeThrough()},I);this.isBold=function(){return p().isBold()};this.isItalic=
function(){return p().isItalic()};this.hasUnderline=function(){return p().hasUnderline()};this.hasStrikeThrough=function(){return p().hasStrikeThrough()};this.fontSize=function(){return p().fontSize()};this.fontName=function(){return p().fontName()};this.isAlignedLeft=function(){return p().isAlignedLeft()};this.isAlignedCenter=function(){return p().isAlignedCenter()};this.isAlignedRight=function(){return p().isAlignedRight()};this.isAlignedJustified=function(){return p().isAlignedJustified()};this.alignParagraphLeft=
function(){H("left");return!0};this.alignParagraphCenter=function(){H("center");return!0};this.alignParagraphRight=function(){H("right");return!0};this.alignParagraphJustified=function(){H("justify");return!0};this.indent=function(){K(U.bind(null,1));return!0};this.outdent=function(){K(U.bind(null,-1));return!0};this.createParagraphStyleOps=function(a){if(!M)return[];var b=B.getCursor(c),d=b.getSelectedRange(),f=[],g,k;b.hasForwardSelection()?(g=b.getAnchorNode(),k=b.getNode()):(g=b.getNode(),k=b.getAnchorNode());
b=B.getParagraphElement(k);runtime.assert(Boolean(b),"DirectFormattingController: Cursor outside paragraph");var h;a:{h=b;var l=gui.SelectionMover.createPositionIterator(h),m=new core.PositionFilterChain;m.addFilter(B.getPositionFilter());m.addFilter(B.createRootFilter(c));for(l.setUnfilteredPosition(d.endContainer,d.endOffset);l.nextPosition();)if(m.acceptPosition(l)===D){h=B.getParagraphElement(l.getCurrentNode())!==h;break a}h=!0}if(!h)return f;k!==g&&(b=B.getParagraphElement(g));if(!T&&!W(d,b))return f;
d=P.value().appliedStyles[0];if(!d)return f;if(g=b.getAttributeNS(Z,"style-name"))d={"style:text-properties":d["style:text-properties"]},d=B.getFormatting().createDerivedStyleObject(g,"paragraph",d);b=e.generateStyleName();g=new ops.OpAddStyle;g.init({memberid:c,styleName:b,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:d});f.push(g);g=new ops.OpSetParagraphStyle;g.init({memberid:c,styleName:b,position:a});f.push(g);return f};this.subscribe=function(a,b){ca.subscribe(a,b)};this.unsubscribe=
function(a,b){ca.unsubscribe(a,b)};this.destroy=function(c){B.unsubscribe(ops.Document.signalCursorAdded,l);B.unsubscribe(ops.Document.signalCursorRemoved,l);B.unsubscribe(ops.Document.signalCursorMoved,l);B.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,k);B.unsubscribe(ops.OdtDocument.signalParagraphChanged,t);B.unsubscribe(ops.OdtDocument.signalOperationEnd,v);B.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,b);h.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,a);c()};(function(){B.subscribe(ops.Document.signalCursorAdded,
l);B.subscribe(ops.Document.signalCursorRemoved,l);B.subscribe(ops.Document.signalCursorMoved,l);B.subscribe(ops.OdtDocument.signalParagraphStyleModified,k);B.subscribe(ops.OdtDocument.signalParagraphChanged,t);B.subscribe(ops.OdtDocument.signalOperationEnd,v);B.subscribe(ops.OdtDocument.signalProcessingBatchEnd,b);h.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,a);P=new core.LazyProperty(n);y=p();a();m||(O.formatTextSelection=E,O.setBold=E,O.setItalic=E,O.setHasUnderline=E,O.setHasStrikethrough=
E,O.setFontSize=E,O.setFontName=E,O.toggleBold=aa,O.toggleItalic=aa,O.toggleUnderline=aa,O.toggleStrikethrough=aa);g||(O.alignParagraphCenter=E,O.alignParagraphJustified=E,O.alignParagraphLeft=E,O.alignParagraphRight=E,O.createParagraphStyleOps=function(){return[]},O.indent=E,O.outdent=E)})()};gui.DirectFormattingController.enabledChanged="enabled/changed";gui.DirectFormattingController.textStylingChanged="textStyling/changed";gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed";gui.KeyboardHandler=function(){function f(c,d){d||(d=h.None);switch(c){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:d|=h.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:d|=h.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:d|=h.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:d|=h.Shift}return c+":"+d}var h=gui.KeyboardHandler.Modifier,d=null,c={};this.setDefault=function(c){d=c};this.bind=function(d,h,g,p){d=f(d,
h);runtime.assert(p||!1===c.hasOwnProperty(d),"tried to overwrite the callback handler of key combo: "+d);c[d]=g};this.unbind=function(d,h){var g=f(d,h);delete c[g]};this.reset=function(){d=null;c={}};this.handleEvent=function(e){var m=e.keyCode,g=h.None;e.metaKey&&(g|=h.Meta);e.ctrlKey&&(g|=h.Ctrl);e.altKey&&(g|=h.Alt);e.shiftKey&&(g|=h.Shift);m=f(m,g);m=c[m];g=!1;m?g=m():null!==d&&(g=d(e));g&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}};
gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12};gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224};gui.HyperlinkClickHandler=function(f,h,d){function c(){var a=f();runtime.assert(Boolean(a.classList),"Document container has no classList element");a.classList.remove("webodf-inactiveLinks")}function e(){var a=f();runtime.assert(Boolean(a.classList),"Document container has no classList element");a.classList.add("webodf-inactiveLinks")}function m(){b.removeEventListener("focus",e,!1);l.forEach(function(a){h.unbind(a.keyCode,a.modifier);d.unbind(a.keyCode,a.modifier)});l.length=0}function g(a){m();
if(a!==p.None){b.addEventListener("focus",e,!1);switch(a){case p.Ctrl:l.push({keyCode:r.Ctrl,modifier:p.None});break;case p.Meta:l.push({keyCode:r.LeftMeta,modifier:p.None}),l.push({keyCode:r.RightMeta,modifier:p.None}),l.push({keyCode:r.MetaInMozilla,modifier:p.None})}l.forEach(function(a){h.bind(a.keyCode,a.modifier,c);d.bind(a.keyCode,a.modifier,e)})}}var p=gui.KeyboardHandler.Modifier,r=gui.KeyboardHandler.KeyCode,n=xmldom.XPath,q=new odf.OdfUtils,b=runtime.getWindow(),a=p.None,l=[];runtime.assert(null!==
b,"Expected to be run in an environment which has a global window, like a browser.");this.handleClick=function(c){var d=c.target||c.srcElement,e,g;c.ctrlKey?e=p.Ctrl:c.metaKey&&(e=p.Meta);if(a===p.None||a===e){a:{for(;null!==d;){if(q.isHyperlink(d))break a;if(q.isParagraph(d))break;d=d.parentNode}d=null}d&&(d=q.getHyperlinkTarget(d),""!==d&&("#"===d[0]?(d=d.substring(1),e=f(),g=n.getODFElementsWithXPath(e,"//text:bookmark-start[@text:name='"+d+"']",odf.Namespaces.lookupNamespaceURI),0===g.length&&
(g=n.getODFElementsWithXPath(e,"//text:bookmark[@text:name='"+d+"']",odf.Namespaces.lookupNamespaceURI)),0<g.length&&g[0].scrollIntoView(!0)):b.open(d),c.preventDefault?c.preventDefault():c.returnValue=!1))}};this.setModifier=function(b){a!==b&&(runtime.assert(b===p.None||b===p.Ctrl||b===p.Meta,"Unsupported KeyboardHandler.Modifier value: "+b),a=b,a!==p.None?e():c(),g(a))};this.getModifier=function(){return a};this.destroy=function(a){e();m();a()}};gui.EventManager=function(f){function h(a){function b(a,c,d){var e,f=!1;e="on"+c;a.attachEvent&&(a.attachEvent(e,d),f=!0);!f&&a.addEventListener&&(a.addEventListener(c,d,!1),f=!0);f&&!z[c]||!a.hasOwnProperty(e)||(a[e]=d)}function c(a,b,d){var e="on"+b;a.detachEvent&&a.detachEvent(e,d);a.removeEventListener&&a.removeEventListener(b,d,!1);a[e]===d&&(a[e]=null)}function d(b){if(-1===f.indexOf(b)){f.push(b);if(e.filters.every(function(a){return a(b)}))try{g.emit(a,b)}catch(c){runtime.log("Error occurred while processing "+
a+":\n"+c.message+"\n"+c.stack)}runtime.setTimeout(function(){f.splice(f.indexOf(b),1)},0)}}var e=this,f=[],g=new core.EventNotifier([a]);this.filters=[];this.subscribe=function(b){g.subscribe(a,b)};this.unsubscribe=function(b){g.unsubscribe(a,b)};this.destroy=function(){c(v,a,d);c(A,a,d);c(K,a,d)};u[a]&&b(v,a,d);b(A,a,d);b(K,a,d)}function d(a,b,c){function d(b){c(b,e,function(b){b.type=a;f.emit(a,b)})}var e={},f=new core.EventNotifier([a]);this.subscribe=function(b){f.subscribe(a,b)};this.unsubscribe=
function(b){f.unsubscribe(a,b)};this.destroy=function(){b.forEach(function(a){J.unsubscribe(a,d)})};(function(){b.forEach(function(a){J.subscribe(a,d)})})()}function c(a){runtime.clearTimeout(a);delete H[a]}function e(a,b){var d=runtime.setTimeout(function(){a();c(d)},b);H[d]=!0;return d}function m(a,b,d){var f=a.touches.length,g=a.touches[0],k=b.timer;"touchmove"===a.type||"touchend"===a.type?k&&c(k):"touchstart"===a.type&&(1!==f?runtime.clearTimeout(k):k=e(function(){d({clientX:g.clientX,clientY:g.clientY,
pageX:g.pageX,pageY:g.pageY,target:a.target||a.srcElement||null,detail:1})},400));b.timer=k}function g(a,b,c){var d=a.touches[0],e=a.target||a.srcElement||null,f=b.target;1!==a.touches.length||"touchend"===a.type?f=null:"touchstart"===a.type&&"webodf-draggable"===e.getAttribute("class")?f=e:"touchmove"===a.type&&f&&(a.preventDefault(),a.stopPropagation(),c({clientX:d.clientX,clientY:d.clientY,pageX:d.pageX,pageY:d.pageY,target:f,detail:1}));b.target=f}function p(a,b,c){var d=a.target||a.srcElement||
null,e=b.dragging;"drag"===a.type?e=!0:"touchend"===a.type&&e&&(e=!1,a=a.changedTouches[0],c({clientX:a.clientX,clientY:a.clientY,pageX:a.pageX,pageY:a.pageY,target:d,detail:1}));b.dragging=e}function r(){K.classList.add("webodf-touchEnabled");J.unsubscribe("touchstart",r)}function n(a){var b=a.scrollX,c=a.scrollY;this.restore=function(){a.scrollX===b&&a.scrollY===c||a.scrollTo(b,c)}}function q(a){var b=a.scrollTop,c=a.scrollLeft;this.restore=function(){if(a.scrollTop!==b||a.scrollLeft!==c)a.scrollTop=
b,a.scrollLeft=c}}function b(a,b){var c=I[a]||C[a]||null;!c&&b&&(c=I[a]=new h(a));return c}function a(a,c){b(a,!0).subscribe(c)}function l(a,c){var d=b(a,!1);d&&d.unsubscribe(c)}function k(){return f.getDOMDocument().activeElement===A}function t(){k()&&A.blur();A.setAttribute("disabled","true")}function s(){A.removeAttribute("disabled")}function w(a){for(var b=[];a;)(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight)&&b.push(new q(a)),a=a.parentNode;b.push(new n(v));return b}function x(){var a;
k()||(a=w(A),s(),A.focus(),a.forEach(function(a){a.restore()}))}var v=runtime.getWindow(),z={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},u={mousedown:!0,mouseup:!0,focus:!0},C={},I={},A,K=f.getCanvas().getElement(),J=this,H={};this.addFilter=function(a,c){b(a,!0).filters.push(c)};this.removeFilter=function(a,c){var d=b(a,!0),e=d.filters.indexOf(c);-1!==e&&d.filters.splice(e,1)};this.subscribe=a;this.unsubscribe=l;this.hasFocus=k;this.focus=x;this.getEventTrap=function(){return A};
this.setEditing=function(a){var b=k();b&&A.blur();a?A.removeAttribute("readOnly"):A.setAttribute("readOnly","true");b&&x()};this.destroy=function(a){l("touchstart",r);Object.keys(H).forEach(function(a){c(parseInt(a,10))});H.length=0;Object.keys(C).forEach(function(a){C[a].destroy()});C={};l("mousedown",t);l("mouseup",s);l("contextmenu",s);Object.keys(I).forEach(function(a){I[a].destroy()});I={};A.parentNode.removeChild(A);a()};(function(){var b=f.getOdfCanvas().getSizer(),c=b.ownerDocument;runtime.assert(Boolean(v),
"EventManager requires a window object to operate correctly");A=c.createElement("input");A.id="eventTrap";A.setAttribute("tabindex","-1");A.setAttribute("readOnly","true");b.appendChild(A);a("mousedown",t);a("mouseup",s);a("contextmenu",s);C.longpress=new d("longpress",["touchstart","touchmove","touchend"],m);C.drag=new d("drag",["touchstart","touchmove","touchend"],g);C.dragstop=new d("dragstop",["drag","touchend"],p);a("touchstart",r)})()};gui.IOSSafariSupport=function(f){function h(){d.innerHeight!==d.outerHeight&&(c.style.display="none",runtime.requestAnimationFrame(function(){c.style.display="block"}))}var d=runtime.getWindow(),c=f.getEventTrap();this.destroy=function(d){f.unsubscribe("focus",h);c.removeAttribute("autocapitalize");c.style.WebkitTransform="";d()};f.subscribe("focus",h);c.setAttribute("autocapitalize","off");c.style.WebkitTransform="translateX(-10000px)"};gui.HyperlinkController=function(f,h,d,c){function e(){var c=!0;!0===h.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(c=d.isLocalCursorWithinOwnAnnotation());c!==n&&(n=c,r.emit(gui.HyperlinkController.enabledChanged,n))}function m(d){d.getMemberId()===c&&e()}var g=new odf.OdfUtils,p=f.getOdtDocument(),r=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),n=!1;this.isEnabled=function(){return n};this.subscribe=function(c,b){r.subscribe(c,b)};this.unsubscribe=function(c,b){r.unsubscribe(c,
b)};this.addHyperlink=function(d,b){if(n){var a=p.getCursorSelection(c),e=new ops.OpApplyHyperlink,g=[];if(0===a.length||b)b=b||d,e=new ops.OpInsertText,e.init({memberid:c,position:a.position,text:b}),a.length=b.length,g.push(e);e=new ops.OpApplyHyperlink;e.init({memberid:c,position:a.position,length:a.length,hyperlink:d});g.push(e);f.enqueue(g)}};this.removeHyperlinks=function(){if(n){var d=gui.SelectionMover.createPositionIterator(p.getRootNode()),b=p.getCursor(c).getSelectedRange(),a=g.getHyperlinkElements(b),
e=b.collapsed&&1===a.length,k=p.getDOMDocument().createRange(),h=[],m,r;0!==a.length&&(a.forEach(function(a){k.selectNodeContents(a);m=p.convertDomToCursorRange({anchorNode:k.startContainer,anchorOffset:k.startOffset,focusNode:k.endContainer,focusOffset:k.endOffset});r=new ops.OpRemoveHyperlink;r.init({memberid:c,position:m.position,length:m.length});h.push(r)}),e||(e=a[0],-1===b.comparePoint(e,0)&&(k.setStart(e,0),k.setEnd(b.startContainer,b.startOffset),m=p.convertDomToCursorRange({anchorNode:k.startContainer,
anchorOffset:k.startOffset,focusNode:k.endContainer,focusOffset:k.endOffset}),0<m.length&&(r=new ops.OpApplyHyperlink,r.init({memberid:c,position:m.position,length:m.length,hyperlink:g.getHyperlinkTarget(e)}),h.push(r))),a=a[a.length-1],d.moveToEndOfNode(a),d=d.unfilteredDomOffset(),1===b.comparePoint(a,d)&&(k.setStart(b.endContainer,b.endOffset),k.setEnd(a,d),m=p.convertDomToCursorRange({anchorNode:k.startContainer,anchorOffset:k.startOffset,focusNode:k.endContainer,focusOffset:k.endOffset}),0<m.length&&
(r=new ops.OpApplyHyperlink,r.init({memberid:c,position:m.position,length:m.length,hyperlink:g.getHyperlinkTarget(a)}),h.push(r)))),f.enqueue(h),k.detach())}};this.destroy=function(c){p.unsubscribe(ops.Document.signalCursorMoved,m);h.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,e);c()};p.subscribe(ops.Document.signalCursorMoved,m);h.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,e);e()};gui.HyperlinkController.enabledChanged="enabled/changed";gui.ImageController=function(f,h,d,c,e){function m(){var c=!0;!0===h.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(c=d.isLocalCursorWithinOwnAnnotation());c!==a&&(a=c,b.emit(gui.ImageController.enabledChanged,a))}function g(a){a.getMemberId()===c&&m()}var p={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},r=odf.Namespaces.textns,n=f.getOdtDocument(),q=n.getFormatting(),b=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),a=!1;this.isEnabled=function(){return a};this.subscribe=
function(a,c){b.subscribe(a,c)};this.unsubscribe=function(a,c){b.unsubscribe(a,c)};this.insertImage=function(b,d,g,h){if(a){runtime.assert(0<g&&0<h,"Both width and height of the image should be greater than 0px.");h={width:g,height:h};if(g=n.getParagraphElement(n.getCursor(c).getNode()).getAttributeNS(r,"style-name")){g=q.getContentSize(g,"paragraph");var m=1,x=1;h.width>g.width&&(m=g.width/h.width);h.height>g.height&&(x=g.height/h.height);g=Math.min(m,x);h={width:h.width*g,height:h.height*g}}g=h.width+
"px";h=h.height+"px";var v=n.getOdfCanvas().odfContainer().rootElement.styles,m=b.toLowerCase(),x=p.hasOwnProperty(m)?p[m]:null,z,m=[];runtime.assert(null!==x,"Image type is not supported: "+b);x="Pictures/"+e.generateImageName()+x;z=new ops.OpSetBlob;z.init({memberid:c,filename:x,mimetype:b,content:d});m.push(z);q.getStyleElement("Graphics","graphic",[v])||(b=new ops.OpAddStyle,b.init({memberid:c,styleName:"Graphics",styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph",
"svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),m.push(b));b=e.generateStyleName();d=new ops.OpAddStyle;d.init({memberid:c,styleName:b,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline",
"style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}});m.push(d);z=new ops.OpInsertImage;z.init({memberid:c,position:n.getCursorPosition(c),
filename:x,frameWidth:g,frameHeight:h,frameStyleName:b,frameName:e.generateFrameName()});m.push(z);f.enqueue(m)}};this.destroy=function(a){n.unsubscribe(ops.Document.signalCursorMoved,g);h.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,m);a()};n.subscribe(ops.Document.signalCursorMoved,g);h.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,m);m()};gui.ImageController.enabledChanged="enabled/changed";gui.ImageSelector=function(f){function h(){var d=f.getSizer(),h=e.createElement("div");h.id="imageSelector";h.style.borderWidth="1px";d.appendChild(h);c.forEach(function(c){var d=e.createElement("div");d.className=c;h.appendChild(d)});return h}var d=odf.Namespaces.svgns,c="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),e=f.getElement().ownerDocument,m=!1;this.select=function(c){var p,r,n=e.getElementById("imageSelector");n||(n=h());m=!0;p=n.parentNode;
r=c.getBoundingClientRect();var q=p.getBoundingClientRect(),b=f.getZoomLevel();p=(r.left-q.left)/b-1;r=(r.top-q.top)/b-1;n.style.display="block";n.style.left=p+"px";n.style.top=r+"px";n.style.width=c.getAttributeNS(d,"width");n.style.height=c.getAttributeNS(d,"height")};this.clearSelection=function(){var c;m&&(c=e.getElementById("imageSelector"))&&(c.style.display="none");m=!1};this.isSelectorElement=function(c){var d=e.getElementById("imageSelector");return d?c===d||c.parentNode===d:!1}};(function(){function f(f){function d(c){g=c.which&&String.fromCharCode(c.which)===m;m=void 0;return!1===g}function c(){g=!1}function e(c){m=c.data;g=!1}var m,g=!1;this.destroy=function(g){f.unsubscribe("textInput",c);f.unsubscribe("compositionend",e);f.removeFilter("keypress",d);g()};f.subscribe("textInput",c);f.subscribe("compositionend",e);f.addFilter("keypress",d)}gui.InputMethodEditor=function(h,d){function c(c){a&&(c?a.getNode().setAttributeNS(b,"composing","true"):(a.getNode().removeAttributeNS(b,
"composing"),t.textContent=""))}function e(){x&&(x=!1,c(!1),z.emit(gui.InputMethodEditor.signalCompositionEnd,{data:v}),v="")}function m(){e();a&&a.getSelectedRange().collapsed?l.value="":l.value=s;l.setSelectionRange(0,l.value.length)}function g(){d.hasFocus()&&w.trigger()}function p(){u=void 0;w.cancel();c(!0);x||z.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function r(a){a=u=a.data;x=!0;v+=a;w.trigger()}function n(a){a.data!==u&&(a=a.data,x=!0,v+=a,w.trigger());u=void 0}function q(){t.textContent=
l.value}var b="urn:webodf:names:cursor",a=null,l=d.getEventTrap(),k=l.ownerDocument,t,s="b",w,x=!1,v="",z=new core.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),u,C=[],I;this.subscribe=z.subscribe;this.unsubscribe=z.unsubscribe;this.registerCursor=function(b){b.getMemberId()===h&&(a=b,a.getNode().appendChild(t),b.subscribe(ops.OdtCursor.signalCursorUpdated,g),d.subscribe("input",q),d.subscribe("compositionupdate",q))};this.removeCursor=function(b){a&&
b===h&&(a.getNode().removeChild(t),a.unsubscribe(ops.OdtCursor.signalCursorUpdated,g),d.unsubscribe("input",q),d.unsubscribe("compositionupdate",q),a=null)};this.destroy=function(a){d.unsubscribe("compositionstart",p);d.unsubscribe("compositionend",r);d.unsubscribe("textInput",n);d.unsubscribe("keypress",e);d.unsubscribe("focus",m);core.Async.destroyAll(I,a)};(function(){d.subscribe("compositionstart",p);d.subscribe("compositionend",r);d.subscribe("textInput",n);d.subscribe("keypress",e);d.subscribe("focus",
m);C.push(new f(d));I=C.map(function(a){return a.destroy});t=k.createElement("span");t.setAttribute("id","composer");w=core.Task.createTimeoutTask(m,1);I.push(w.destroy)})()};gui.InputMethodEditor.signalCompositionStart="input/compositionstart";gui.InputMethodEditor.signalCompositionEnd="input/compositionend"})();gui.MetadataController=function(f,h){function d(c){m.emit(gui.MetadataController.signalMetadataChanged,c)}function c(c){var d=-1===g.indexOf(c);d||runtime.log("Setting "+c+" is restricted.");return d}var e=f.getOdtDocument(),m=new core.EventNotifier([gui.MetadataController.signalMetadataChanged]),g=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(d,e){var g={},m="",b;d&&Object.keys(d).filter(c).forEach(function(a){g[a]=d[a]});
e&&(m=e.filter(c).join(","));if(0<m.length||0<Object.keys(g).length)b=new ops.OpUpdateMetadata,b.init({memberid:h,setProperties:g,removedProperties:0<m.length?{attributes:m}:null}),f.enqueue([b])};this.getMetadata=function(c){var d;runtime.assert("string"===typeof c,"Property must be a string");d=c.split(":");runtime.assert(2===d.length,"Property must be a namespace-prefixed string");c=odf.Namespaces.lookupNamespaceURI(d[0]);runtime.assert(Boolean(c),"Prefix must be for an ODF namespace.");return e.getOdfCanvas().odfContainer().getMetadata(c,
d[1])};this.subscribe=function(c,d){m.subscribe(c,d)};this.unsubscribe=function(c,d){m.unsubscribe(c,d)};this.destroy=function(c){e.unsubscribe(ops.OdtDocument.signalMetadataUpdated,d);c()};e.subscribe(ops.OdtDocument.signalMetadataUpdated,d)};gui.MetadataController.signalMetadataChanged="metadata/changed";gui.PasteController=function(f,h,d,c){function e(){r=!0===h.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?d.isLocalCursorWithinOwnAnnotation():!0}function m(d){d.getMemberId()===c&&e()}function g(c){return c===ops.OdtStepsTranslator.NEXT_STEP}var p=f.getOdtDocument(),r=!1,n=odf.Namespaces.textns;this.isEnabled=function(){return r};this.paste=function(d){if(r){var b=p.getCursorPosition(c),a=p.getCursor(c).getNode(),a=p.getParagraphElement(a),e=a.getAttributeNS(n,"style-name")||"",h=b,m=[],s=p.convertDomPointToCursorStep(a,
0,g);d.replace(/\r/g,"").split("\n").forEach(function(a){var b=new ops.OpInsertText,d=new ops.OpSplitParagraph;b.init({memberid:c,position:h,text:a,moveCursor:!0});m.push(b);h+=a.length;d.init({memberid:c,position:h,paragraphStyleName:e,sourceParagraphPosition:s,moveCursor:!0});m.push(d);s=h+=1});m.pop();f.enqueue(m)}};this.destroy=function(c){p.unsubscribe(ops.Document.signalCursorMoved,m);h.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,e);c()};p.subscribe(ops.Document.signalCursorMoved,m);
h.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,e);e()};odf.WordBoundaryFilter=function(f,h){function d(a,b,c){for(var d=null,e=f.getRootNode(),g;a!==e&&null!==a&&null===d;)g=0>b?a.previousSibling:a.nextSibling,c(g)===NodeFilter.FILTER_ACCEPT&&(d=g),a=a.parentNode;return d}function c(a,b){var c;return null===a?l.NO_NEIGHBOUR:g.isCharacterElement(a)?l.SPACE_CHAR:a.nodeType===e||g.isTextSpan(a)||g.isHyperlink(a)?(c=a.textContent.charAt(b()),r.test(c)?l.SPACE_CHAR:p.test(c)?l.PUNCTUATION_CHAR:l.WORD_CHAR):l.OTHER}var e=Node.TEXT_NODE,m=Node.ELEMENT_NODE,
g=new odf.OdfUtils,p=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,
r=/\s/,n=core.PositionFilter.FilterResult.FILTER_ACCEPT,q=core.PositionFilter.FilterResult.FILTER_REJECT,b=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,a=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,l={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(e){var f=e.container(),g=e.leftNode(),p=e.rightNode(),r=e.unfilteredDomOffset,v=function(){return e.unfilteredDomOffset()-1};f.nodeType===m&&(null===p&&(p=d(f,1,e.getNodeFilter())),null===g&&(g=
d(f,-1,e.getNodeFilter())));f!==p&&(r=function(){return 0});f!==g&&null!==g&&(v=function(){return g.textContent.length-1});f=c(g,v);p=c(p,r);return f===l.WORD_CHAR&&p===l.WORD_CHAR||f===l.PUNCTUATION_CHAR&&p===l.PUNCTUATION_CHAR||h===b&&f!==l.NO_NEIGHBOUR&&p===l.SPACE_CHAR||h===a&&f===l.SPACE_CHAR&&p!==l.NO_NEIGHBOUR?q:n}};odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2};gui.SelectionController=function(f,h){function d(a,b,c){c=new odf.WordBoundaryFilter(s,c);var d=s.getRootElement(a),e=s.createRootFilter(d);return s.createStepIterator(a,b,[v,e,c],d)}function c(a,b){return b?{anchorNode:a.startContainer,anchorOffset:a.startOffset,focusNode:a.endContainer,focusOffset:a.endOffset}:{anchorNode:a.endContainer,anchorOffset:a.endOffset,focusNode:a.startContainer,focusOffset:a.startOffset}}function e(a,b,c){var d=new ops.OpMoveCursor;d.init({memberid:h,position:a,length:b||
0,selectionType:c});return d}function m(a,b,d){var g;g=s.getCursor(h);g=c(g.getSelectedRange(),g.hasForwardSelection());g.focusNode=a;g.focusOffset=b;d||(g.anchorNode=g.focusNode,g.anchorOffset=g.focusOffset);a=s.convertDomToCursorRange(g);f.enqueue([e(a.position,a.length)])}function g(a){var b;b=d(a.startContainer,a.startOffset,C);b.roundToPreviousStep()&&a.setStart(b.container(),b.offset());b=d(a.endContainer,a.endOffset,I);b.roundToNextStep()&&a.setEnd(b.container(),b.offset())}function p(a){var b=
x.getParagraphElements(a),c=b[0],b=b[b.length-1];c&&a.setStart(c,0);b&&(x.isParagraph(a.endContainer)&&0===a.endOffset?a.setEndBefore(b):a.setEnd(b,b.childNodes.length))}function r(a,b,c,d){var e,g;d?(e=c.startContainer,g=c.startOffset):(e=c.endContainer,g=c.endOffset);w.containsNode(a,e)||(g=0>w.comparePoints(a,0,e,g)?0:a.childNodes.length,e=a);a=s.createStepIterator(e,g,b,x.getParagraphElement(e)||a);a.roundToClosestStep()||runtime.assert(!1,"No step found in requested range");d?c.setStart(a.container(),
a.offset()):c.setEnd(a.container(),a.offset())}function n(a){var b=s.getCursorSelection(h),c=s.getCursor(h).getStepCounter();0!==a&&(a=0<a?c.convertForwardStepsBetweenFilters(a,z,v):-c.convertBackwardStepsBetweenFilters(-a,z,v),a=b.length+a,f.enqueue([e(b.position,a)]))}function q(a){var b=s.getCursorPosition(h),c=s.getCursor(h).getStepCounter();0!==a&&(a=0<a?c.convertForwardStepsBetweenFilters(a,z,v):-c.convertBackwardStepsBetweenFilters(-a,z,v),f.enqueue([e(b+a,0)]))}function b(a,b){var c;c=s.getCursor(h).getNode();
c=s.createStepIterator(c,0,[v,u],s.getRootElement(c));c.advanceStep(a)&&m(c.container(),c.offset(),b)}function a(a,b){var c=s.getParagraphElement(s.getCursor(h).getNode()),d=a===K?1:-1;runtime.assert(Boolean(c),"SelectionController: Cursor outside paragraph");c=s.getCursor(h).getStepCounter().countLinesSteps(d,z);b?n(c):q(c)}function l(a,b){var c=a===core.StepDirection.NEXT?1:-1,c=s.getCursor(h).getStepCounter().countStepsToLineBoundary(c,z);b?n(c):q(c)}function k(a,b){var e=s.getCursor(h),e=c(e.getSelectedRange(),
e.hasForwardSelection()),e=d(e.focusNode,e.focusOffset,C);e.advanceStep(a)&&m(e.container(),e.offset(),b)}function t(a,b,d){var e=!1,g=s.getCursor(h),g=c(g.getSelectedRange(),g.hasForwardSelection()),e=s.getRootElement(g.focusNode);runtime.assert(Boolean(e),"SelectionController: Cursor outside root");g=s.createStepIterator(g.focusNode,g.focusOffset,[v,u],e);g.roundToClosestStep();g.advanceStep(a)&&(d=d(g.container()))&&(a===A?(g.setPosition(d,0),e=g.roundToNextStep()):(g.setPosition(d,d.childNodes.length),
e=g.roundToPreviousStep()),e&&m(g.container(),g.offset(),b))}var s=f.getOdtDocument(),w=new core.DomUtils,x=new odf.OdfUtils,v=s.getPositionFilter(),z=new core.PositionFilterChain,u=s.createRootFilter(h),C=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,I=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,A=core.StepDirection.PREVIOUS,K=core.StepDirection.NEXT;this.selectionToRange=function(a){var b=0<=w.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset),c=a.focusNode.ownerDocument.createRange();
b?(c.setStart(a.anchorNode,a.anchorOffset),c.setEnd(a.focusNode,a.focusOffset)):(c.setStart(a.focusNode,a.focusOffset),c.setEnd(a.anchorNode,a.anchorOffset));return{range:c,hasForwardSelection:b}};this.rangeToSelection=c;this.selectImage=function(a){var b=s.getRootElement(a),c=s.createRootFilter(b),b=s.createStepIterator(a,0,[c,s.getPositionFilter()],b),d;b.roundToPreviousStep()||runtime.assert(!1,"No walkable position before frame");c=b.container();d=b.offset();b.setPosition(a,a.childNodes.length);
b.roundToNextStep()||runtime.assert(!1,"No walkable position after frame");a=s.convertDomToCursorRange({anchorNode:c,anchorOffset:d,focusNode:b.container(),focusOffset:b.offset()});a=e(a.position,a.length,ops.OdtCursor.RegionSelection);f.enqueue([a])};this.expandToWordBoundaries=g;this.expandToParagraphBoundaries=p;this.selectRange=function(a,b,d){var k=s.getOdfCanvas().getElement(),l,m=[v];l=w.containsNode(k,a.startContainer);k=w.containsNode(k,a.endContainer);if(l||k)if(l&&k&&(2===d?g(a):3<=d&&
p(a)),(d=b?s.getRootElement(a.startContainer):s.getRootElement(a.endContainer))||(d=s.getRootNode()),m.push(s.createRootFilter(d)),r(d,m,a,!0),r(d,m,a,!1),a=c(a,b),b=s.convertDomToCursorRange(a),a=s.getCursorSelection(h),b.position!==a.position||b.length!==a.length)a=e(b.position,b.length,ops.OdtCursor.RangeSelection),f.enqueue([a])};this.moveCursorToLeft=function(){b(A,!1);return!0};this.moveCursorToRight=function(){b(K,!1);return!0};this.extendSelectionToLeft=function(){b(A,!0);return!0};this.extendSelectionToRight=
function(){b(K,!0);return!0};this.moveCursorUp=function(){a(A,!1);return!0};this.moveCursorDown=function(){a(K,!1);return!0};this.extendSelectionUp=function(){a(A,!0);return!0};this.extendSelectionDown=function(){a(K,!0);return!0};this.moveCursorBeforeWord=function(){k(A,!1);return!0};this.moveCursorPastWord=function(){k(K,!1);return!0};this.extendSelectionBeforeWord=function(){k(A,!0);return!0};this.extendSelectionPastWord=function(){k(K,!0);return!0};this.moveCursorToLineStart=function(){l(A,!1);
return!0};this.moveCursorToLineEnd=function(){l(K,!1);return!0};this.extendSelectionToLineStart=function(){l(A,!0);return!0};this.extendSelectionToLineEnd=function(){l(K,!0);return!0};this.extendSelectionToParagraphStart=function(){t(A,!0,s.getParagraphElement);return!0};this.extendSelectionToParagraphEnd=function(){t(K,!0,s.getParagraphElement);return!0};this.moveCursorToParagraphStart=function(){t(A,!1,s.getParagraphElement);return!0};this.moveCursorToParagraphEnd=function(){t(K,!1,s.getParagraphElement);
return!0};this.moveCursorToDocumentStart=function(){t(A,!1,s.getRootElement);return!0};this.moveCursorToDocumentEnd=function(){t(K,!1,s.getRootElement);return!0};this.extendSelectionToDocumentStart=function(){t(A,!0,s.getRootElement);return!0};this.extendSelectionToDocumentEnd=function(){t(K,!0,s.getRootElement);return!0};this.extendSelectionToEntireDocument=function(){var a=s.getCursor(h),a=s.getRootElement(a.getNode()),b,c,d;runtime.assert(Boolean(a),"SelectionController: Cursor outside root");
d=s.createStepIterator(a,0,[v,u],a);d.roundToClosestStep();b=d.container();c=d.offset();d.setPosition(a,a.childNodes.length);d.roundToClosestStep();a=s.convertDomToCursorRange({anchorNode:b,anchorOffset:c,focusNode:d.container(),focusOffset:d.offset()});f.enqueue([e(a.position,a.length)]);return!0};z.addFilter(v);z.addFilter(s.createRootFilter(h))};gui.TextController=function(f,h,d,c,e,m){function g(){s=!0===h.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)?d.isLocalCursorWithinOwnAnnotation():!0}function p(a){a.getMemberId()===c&&g()}function r(a){return a===ops.OdtStepsTranslator.NEXT_STEP}function n(a,b,c){var d=[l.getPositionFilter()];c&&d.push(l.createRootFilter(a.startContainer));c=l.createStepIterator(a.startContainer,a.startOffset,d,b);c.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range start");
b=l.convertDomPointToCursorStep(c.container(),c.offset());a.collapsed?a=b:(c.setPosition(a.endContainer,a.endOffset),c.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range end"),a=l.convertDomPointToCursorStep(c.container(),c.offset()));return{position:b,length:a-b}}function q(a){var b,d,e,g=k.getParagraphElements(a),f=a.cloneRange(),h=[];b=g[0];1<g.length&&(k.hasNoODFContent(b)&&(b=g[g.length-1]),d=b.getAttributeNS(odf.Namespaces.textns,"style-name")||"");
g.forEach(function(b,g){var k,l;f.setStart(b,0);f.collapse(!0);k=n(f,b,!1).position;0<g&&(l=new ops.OpMergeParagraph,l.init({memberid:c,paragraphStyleName:d,destinationStartPosition:e,sourceStartPosition:k,moveCursor:1===g}),h.unshift(l));e=k;f.selectNodeContents(b);if(k=t.rangeIntersection(f,a))k=n(k,b,!0),0<k.length&&(l=new ops.OpRemoveText,l.init({memberid:c,position:k.position,length:k.length}),h.unshift(l))});return h}function b(a){0>a.length&&(a.position+=a.length,a.length=-a.length);return a}
function a(a){if(!s)return!1;var d,e=l.getCursor(c).getSelectedRange().cloneRange(),g=b(l.getCursorSelection(c)),h;if(0===g.length){g=void 0;d=l.getCursor(c).getNode();h=l.getRootElement(d);var k=[l.getPositionFilter(),l.createRootFilter(h)];h=l.createStepIterator(d,0,k,h);h.roundToClosestStep()&&(a?h.nextStep():h.previousStep())&&(g=b(l.convertDomToCursorRange({anchorNode:d,anchorOffset:0,focusNode:h.container(),focusOffset:h.offset()})),a?(e.setStart(d,0),e.setEnd(h.container(),h.offset())):(e.setStart(h.container(),
h.offset()),e.setEnd(d,0)))}g&&f.enqueue(q(e));return void 0!==g}var l=f.getOdtDocument(),k=new odf.OdfUtils,t=new core.DomUtils,s=!1,w=odf.Namespaces.textns;this.isEnabled=function(){return s};this.enqueueParagraphSplittingOps=function(){if(!s)return!1;var a=l.getCursor(c),d=a.getSelectedRange(),e=b(l.getCursorSelection(c)),g=[],a=l.getParagraphElement(a.getNode()),h=a.getAttributeNS(w,"style-name")||"";0<e.length&&(g=g.concat(q(d)));d=new ops.OpSplitParagraph;d.init({memberid:c,position:e.position,
paragraphStyleName:h,sourceParagraphPosition:l.convertDomPointToCursorStep(a,0,r),moveCursor:!0});g.push(d);m&&(e=m(e.position+1),g=g.concat(e));f.enqueue(g);return!0};this.removeTextByBackspaceKey=function(){return a(!1)};this.removeTextByDeleteKey=function(){return a(!0)};this.removeCurrentSelection=function(){if(!s)return!1;var a=l.getCursor(c).getSelectedRange();f.enqueue(q(a));return!0};this.insertText=function(a){if(s){var d=l.getCursor(c).getSelectedRange(),g=b(l.getCursorSelection(c)),h=[],
k=!1;0<g.length&&(h=h.concat(q(d)),k=!0);d=new ops.OpInsertText;d.init({memberid:c,position:g.position,text:a,moveCursor:!0});h.push(d);e&&(a=e(g.position,a.length,k))&&h.push(a);f.enqueue(h)}};this.destroy=function(a){l.unsubscribe(ops.Document.signalCursorMoved,p);h.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,g);a()};l.subscribe(ops.Document.signalCursorMoved,p);h.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,g);g()};gui.UndoManager=function(){};gui.UndoManager.prototype.subscribe=function(f,h){};gui.UndoManager.prototype.unsubscribe=function(f,h){};gui.UndoManager.prototype.setDocument=function(f){};gui.UndoManager.prototype.setInitialState=function(){};gui.UndoManager.prototype.initialize=function(){};gui.UndoManager.prototype.purgeInitialState=function(){};gui.UndoManager.prototype.setPlaybackFunction=function(f){};gui.UndoManager.prototype.hasUndoStates=function(){};
gui.UndoManager.prototype.hasRedoStates=function(){};gui.UndoManager.prototype.moveForward=function(f){};gui.UndoManager.prototype.moveBackward=function(f){};gui.UndoManager.prototype.onOperationExecuted=function(f){};gui.UndoManager.signalUndoStackChanged="undoStackChanged";gui.UndoManager.signalUndoStateCreated="undoStateCreated";gui.UndoManager.signalUndoStateModified="undoStateModified";gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1};
(function(){var f=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(h,d,c,e){function m(a){return a.target||a.srcElement||null}function g(a,b){var c=B.getDOMDocument(),d=null;c.caretRangeFromPoint?(c=c.caretRangeFromPoint(a,b),d={container:c.startContainer,offset:c.startOffset}):c.caretPositionFromPoint&&(c=c.caretPositionFromPoint(a,b))&&c.offsetNode&&(d={container:c.offsetNode,offset:c.offset});return d}function p(a){var b=B.getCursor(d).getSelectedRange();b.collapsed?
a.preventDefault():T.setDataFromRange(a,b)?ea.removeCurrentSelection():runtime.log("Cut operation failed")}function r(){return!1!==B.getCursor(d).getSelectedRange().collapsed}function n(a){var b=B.getCursor(d).getSelectedRange();b.collapsed?a.preventDefault():T.setDataFromRange(a,b)||runtime.log("Copy operation failed")}function q(a){var b;O.clipboardData&&O.clipboardData.getData?b=O.clipboardData.getData("Text"):a.clipboardData&&a.clipboardData.getData&&(b=a.clipboardData.getData("text/plain"));
b&&(ea.removeCurrentSelection(),pa.paste(b));a.preventDefault?a.preventDefault():a.returnValue=!1}function b(){return!1}function a(a){if(V)V.onOperationExecuted(a)}function l(a){B.emit(ops.OdtDocument.signalUndoStackChanged,a)}function k(){var a;return V?(a=L.hasFocus(),V.moveBackward(1),a&&L.focus(),!0):!1}function t(){var a;return V?(a=L.hasFocus(),V.moveForward(1),a&&L.focus(),!0):!1}function s(a){var b=B.getCursor(d).getSelectedRange(),e=m(a).getAttribute("end");b&&e&&(a=g(a.clientX,a.clientY))&&
(ha.setUnfilteredPosition(a.container,a.offset),S.acceptPosition(ha)===f&&(b=b.cloneRange(),"left"===e?b.setStart(ha.container(),ha.unfilteredDomOffset()):b.setEnd(ha.container(),ha.unfilteredDomOffset()),c.setSelectedRange(b,"right"===e),B.emit(ops.Document.signalCursorMoved,c)))}function w(){R.selectRange(c.getSelectedRange(),c.hasForwardSelection(),1)}function x(){var a=O.getSelection(),b=0<a.rangeCount&&R.selectionToRange(a);Y&&b&&(da=!0,ka.clearSelection(),ha.setUnfilteredPosition(a.focusNode,
a.focusOffset),S.acceptPosition(ha)===f&&(2===na?R.expandToWordBoundaries(b.range):3<=na&&R.expandToParagraphBoundaries(b.range),c.setSelectedRange(b.range,b.hasForwardSelection),B.emit(ops.Document.signalCursorMoved,c)))}function v(a){var b=m(a),c=B.getCursor(d);if(Y=null!==b&&ca.containsNode(B.getOdfCanvas().getElement(),b))da=!1,S=B.createRootFilter(b),na=0===a.button?a.detail:0,c&&a.shiftKey?O.getSelection().collapse(c.getAnchorNode(),0):(a=O.getSelection(),b=c.getSelectedRange(),a.extend?c.hasForwardSelection()?
(a.collapse(b.startContainer,b.startOffset),a.extend(b.endContainer,b.endOffset)):(a.collapse(b.endContainer,b.endOffset),a.extend(b.startContainer,b.startOffset)):(a.removeAllRanges(),a.addRange(b.cloneRange()))),1<na&&x()}function z(a){var b=B.getRootElement(a),c=B.createRootFilter(b),b=B.createStepIterator(a,0,[c,B.getPositionFilter()],b);b.setPosition(a,a.childNodes.length);return b.roundToNextStep()?{container:b.container(),offset:b.offset()}:null}function u(a){var b;b=(b=O.getSelection())?{anchorNode:b.anchorNode,
anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}:null;var c=O.getSelection().isCollapsed,d,e;b.anchorNode||b.focusNode||!(d=g(a.clientX,a.clientY))||(b.anchorNode=d.container,b.anchorOffset=d.offset,b.focusNode=b.anchorNode,b.focusOffset=b.anchorOffset);if(Z.isImage(b.focusNode)&&0===b.focusOffset&&Z.isCharacterFrame(b.focusNode.parentNode)){if(e=b.focusNode.parentNode,d=e.getBoundingClientRect(),a.clientX>d.left&&(d=z(e)))b.focusNode=d.container,b.focusOffset=d.offset,
c&&(b.anchorNode=b.focusNode,b.anchorOffset=b.focusOffset)}else Z.isImage(b.focusNode.firstChild)&&1===b.focusOffset&&Z.isCharacterFrame(b.focusNode)&&(d=z(b.focusNode))&&(b.anchorNode=b.focusNode=d.container,b.anchorOffset=b.focusOffset=d.offset);b.anchorNode&&b.focusNode&&(b=R.selectionToRange(b),R.selectRange(b.range,b.hasForwardSelection,0===a.button?a.detail:0));L.focus()}function C(a){var b;if(b=g(a.clientX,a.clientY))a=b.container,b=b.offset,a={anchorNode:a,anchorOffset:b,focusNode:a,focusOffset:b},
a=R.selectionToRange(a),R.selectRange(a.range,a.hasForwardSelection,2),L.focus()}function I(a){var b=m(a),d,e;la.processRequests();Y&&(Z.isImage(b)&&Z.isCharacterFrame(b.parentNode)&&O.getSelection().isCollapsed?(R.selectImage(b.parentNode),L.focus()):ka.isSelectorElement(b)?L.focus():da?(b=c.getSelectedRange(),d=b.collapsed,Z.isImage(b.endContainer)&&0===b.endOffset&&Z.isCharacterFrame(b.endContainer.parentNode)&&(e=b.endContainer.parentNode,e=z(e))&&(b.setEnd(e.container,e.offset),d&&b.collapse(!1)),
R.selectRange(b,c.hasForwardSelection(),0===a.button?a.detail:0),L.focus()):ua?u(a):Q=runtime.setTimeout(function(){u(a)},0),na=0,da=Y=!1)}function A(a){var b=B.getCursor(d).getSelectedRange();b.collapsed||D.exportRangeToDataTransfer(a.dataTransfer,b)}function K(){Y&&L.focus();na=0;da=Y=!1}function J(a){I(a)}function H(a){var b=m(a),c=null;"annotationRemoveButton"===b.className?(runtime.assert(ia,"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),
c=ca.getElementsByTagNameNS(b.parentNode,odf.Namespaces.officens,"annotation")[0],$.removeAnnotation(c),L.focus()):"webodf-draggable"!==b.getAttribute("class")&&I(a)}function U(a){(a=a.data)&&(-1===a.indexOf("\n")?ea.insertText(a):pa.paste(a))}function W(a){return function(){a();return!0}}function E(a){return function(b){return B.getCursor(d).getSelectionType()===ops.OdtCursor.RangeSelection?a(b):!0}}function aa(b){L.unsubscribe("keydown",y.handleEvent);L.unsubscribe("keypress",P.handleEvent);L.unsubscribe("keyup",
M.handleEvent);L.unsubscribe("copy",n);L.unsubscribe("mousedown",v);L.unsubscribe("mousemove",la.trigger);L.unsubscribe("mouseup",H);L.unsubscribe("contextmenu",J);L.unsubscribe("dragstart",A);L.unsubscribe("dragend",K);L.unsubscribe("click",ma.handleClick);L.unsubscribe("longpress",C);L.unsubscribe("drag",s);L.unsubscribe("dragstop",w);B.unsubscribe(ops.OdtDocument.signalOperationEnd,oa.trigger);B.unsubscribe(ops.Document.signalCursorAdded,ja.registerCursor);B.unsubscribe(ops.Document.signalCursorRemoved,
ja.removeCursor);B.unsubscribe(ops.OdtDocument.signalOperationEnd,a);b()}var O=runtime.getWindow(),B=h.getOdtDocument(),X=new gui.SessionConstraints,ga=new gui.SessionContext(h,d),ca=new core.DomUtils,Z=new odf.OdfUtils,D=new gui.MimeDataExporter,T=new gui.Clipboard(D),y=new gui.KeyboardHandler,P=new gui.KeyboardHandler,M=new gui.KeyboardHandler,Y=!1,N=new odf.ObjectNameGenerator(B.getOdfCanvas().odfContainer(),d),da=!1,S=null,Q,V=null,L=new gui.EventManager(B),ia=e.annotationsEnabled,$=new gui.AnnotationController(h,
X,d),ba=new gui.DirectFormattingController(h,X,ga,d,N,e.directTextStylingEnabled,e.directParagraphStylingEnabled),ea=new gui.TextController(h,X,ga,d,ba.createCursorStyleOp,ba.createParagraphStyleOps),qa=new gui.ImageController(h,X,ga,d,N),ka=new gui.ImageSelector(B.getOdfCanvas()),ha=gui.SelectionMover.createPositionIterator(B.getRootNode()),la,oa,pa=new gui.PasteController(h,X,ga,d),ja=new gui.InputMethodEditor(d,L),na=0,ma=new gui.HyperlinkClickHandler(B.getOdfCanvas().getElement,y,M),fa=new gui.HyperlinkController(h,
X,ga,d),R=new gui.SelectionController(h,d),ta=new gui.MetadataController(h,d),F=gui.KeyboardHandler.Modifier,G=gui.KeyboardHandler.KeyCode,ra=-1!==O.navigator.appVersion.toLowerCase().indexOf("mac"),ua=-1!==["iPad","iPod","iPhone"].indexOf(O.navigator.platform),sa;runtime.assert(null!==O,"Expected to be run in an environment which has a global window, like a browser.");this.undo=k;this.redo=t;this.insertLocalCursor=function(){runtime.assert(void 0===h.getOdtDocument().getCursor(d),"Inserting local cursor a second time.");
var a=new ops.OpAddCursor;a.init({memberid:d});h.enqueue([a]);L.focus()};this.removeLocalCursor=function(){runtime.assert(void 0!==h.getOdtDocument().getCursor(d),"Removing local cursor without inserting before.");var a=new ops.OpRemoveCursor;a.init({memberid:d});h.enqueue([a])};this.startEditing=function(){ja.subscribe(gui.InputMethodEditor.signalCompositionStart,ea.removeCurrentSelection);ja.subscribe(gui.InputMethodEditor.signalCompositionEnd,U);L.subscribe("beforecut",r);L.subscribe("cut",p);
L.subscribe("beforepaste",b);L.subscribe("paste",q);V&&V.initialize();L.setEditing(!0);ma.setModifier(ra?F.Meta:F.Ctrl);y.bind(G.Backspace,F.None,W(ea.removeTextByBackspaceKey),!0);y.bind(G.Delete,F.None,ea.removeTextByDeleteKey);y.bind(G.Tab,F.None,E(function(){ea.insertText("\t");return!0}));ra?(y.bind(G.Clear,F.None,ea.removeCurrentSelection),y.bind(G.B,F.Meta,E(ba.toggleBold)),y.bind(G.I,F.Meta,E(ba.toggleItalic)),y.bind(G.U,F.Meta,E(ba.toggleUnderline)),y.bind(G.L,F.MetaShift,E(ba.alignParagraphLeft)),
y.bind(G.E,F.MetaShift,E(ba.alignParagraphCenter)),y.bind(G.R,F.MetaShift,E(ba.alignParagraphRight)),y.bind(G.J,F.MetaShift,E(ba.alignParagraphJustified)),ia&&y.bind(G.C,F.MetaShift,$.addAnnotation),y.bind(G.Z,F.Meta,k),y.bind(G.Z,F.MetaShift,t)):(y.bind(G.B,F.Ctrl,E(ba.toggleBold)),y.bind(G.I,F.Ctrl,E(ba.toggleItalic)),y.bind(G.U,F.Ctrl,E(ba.toggleUnderline)),y.bind(G.L,F.CtrlShift,E(ba.alignParagraphLeft)),y.bind(G.E,F.CtrlShift,E(ba.alignParagraphCenter)),y.bind(G.R,F.CtrlShift,E(ba.alignParagraphRight)),
y.bind(G.J,F.CtrlShift,E(ba.alignParagraphJustified)),ia&&y.bind(G.C,F.CtrlAlt,$.addAnnotation),y.bind(G.Z,F.Ctrl,k),y.bind(G.Z,F.CtrlShift,t));P.setDefault(E(function(a){var b;b=null===a.which||void 0===a.which?String.fromCharCode(a.keyCode):0!==a.which&&0!==a.charCode?String.fromCharCode(a.which):null;return!b||a.altKey||a.ctrlKey||a.metaKey?!1:(ea.insertText(b),!0)}));P.bind(G.Enter,F.None,E(ea.enqueueParagraphSplittingOps))};this.endEditing=function(){ja.unsubscribe(gui.InputMethodEditor.signalCompositionStart,
ea.removeCurrentSelection);ja.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,U);L.unsubscribe("cut",p);L.unsubscribe("beforecut",r);L.unsubscribe("paste",q);L.unsubscribe("beforepaste",b);L.setEditing(!1);ma.setModifier(F.None);y.bind(G.Backspace,F.None,function(){return!0},!0);y.unbind(G.Delete,F.None);y.unbind(G.Tab,F.None);ra?(y.unbind(G.Clear,F.None),y.unbind(G.B,F.Meta),y.unbind(G.I,F.Meta),y.unbind(G.U,F.Meta),y.unbind(G.L,F.MetaShift),y.unbind(G.E,F.MetaShift),y.unbind(G.R,F.MetaShift),
y.unbind(G.J,F.MetaShift),ia&&y.unbind(G.C,F.MetaShift),y.unbind(G.Z,F.Meta),y.unbind(G.Z,F.MetaShift)):(y.unbind(G.B,F.Ctrl),y.unbind(G.I,F.Ctrl),y.unbind(G.U,F.Ctrl),y.unbind(G.L,F.CtrlShift),y.unbind(G.E,F.CtrlShift),y.unbind(G.R,F.CtrlShift),y.unbind(G.J,F.CtrlShift),ia&&y.unbind(G.C,F.CtrlAlt),y.unbind(G.Z,F.Ctrl),y.unbind(G.Z,F.CtrlShift));P.setDefault(null);P.unbind(G.Enter,F.None)};this.getInputMemberId=function(){return d};this.getSession=function(){return h};this.getSessionConstraints=function(){return X};
this.setUndoManager=function(a){V&&V.unsubscribe(gui.UndoManager.signalUndoStackChanged,l);if(V=a)V.setDocument(B),V.setPlaybackFunction(h.enqueue),V.subscribe(gui.UndoManager.signalUndoStackChanged,l)};this.getUndoManager=function(){return V};this.getMetadataController=function(){return ta};this.getAnnotationController=function(){return $};this.getDirectFormattingController=function(){return ba};this.getHyperlinkClickHandler=function(){return ma};this.getHyperlinkController=function(){return fa};
this.getImageController=function(){return qa};this.getSelectionController=function(){return R};this.getTextController=function(){return ea};this.getEventManager=function(){return L};this.getKeyboardHandlers=function(){return{keydown:y,keypress:P}};this.destroy=function(a){var b=[la.destroy,oa.destroy,ba.destroy,ja.destroy,L.destroy,ma.destroy,fa.destroy,ta.destroy,ea.destroy,aa];sa&&b.unshift(sa.destroy);runtime.clearTimeout(Q);core.Async.destroyAll(b,a)};la=core.Task.createRedrawTask(x);oa=core.Task.createRedrawTask(function(){var a=
B.getCursor(d);if(a&&a.getSelectionType()===ops.OdtCursor.RegionSelection&&(a=Z.getImageElements(a.getSelectedRange())[0])){ka.select(a.parentNode);return}ka.clearSelection()});y.bind(G.Left,F.None,E(R.moveCursorToLeft));y.bind(G.Right,F.None,E(R.moveCursorToRight));y.bind(G.Up,F.None,E(R.moveCursorUp));y.bind(G.Down,F.None,E(R.moveCursorDown));y.bind(G.Left,F.Shift,E(R.extendSelectionToLeft));y.bind(G.Right,F.Shift,E(R.extendSelectionToRight));y.bind(G.Up,F.Shift,E(R.extendSelectionUp));y.bind(G.Down,
F.Shift,E(R.extendSelectionDown));y.bind(G.Home,F.None,E(R.moveCursorToLineStart));y.bind(G.End,F.None,E(R.moveCursorToLineEnd));y.bind(G.Home,F.Ctrl,E(R.moveCursorToDocumentStart));y.bind(G.End,F.Ctrl,E(R.moveCursorToDocumentEnd));y.bind(G.Home,F.Shift,E(R.extendSelectionToLineStart));y.bind(G.End,F.Shift,E(R.extendSelectionToLineEnd));y.bind(G.Up,F.CtrlShift,E(R.extendSelectionToParagraphStart));y.bind(G.Down,F.CtrlShift,E(R.extendSelectionToParagraphEnd));y.bind(G.Home,F.CtrlShift,E(R.extendSelectionToDocumentStart));
y.bind(G.End,F.CtrlShift,E(R.extendSelectionToDocumentEnd));ra?(y.bind(G.Left,F.Alt,E(R.moveCursorBeforeWord)),y.bind(G.Right,F.Alt,E(R.moveCursorPastWord)),y.bind(G.Left,F.Meta,E(R.moveCursorToLineStart)),y.bind(G.Right,F.Meta,E(R.moveCursorToLineEnd)),y.bind(G.Home,F.Meta,E(R.moveCursorToDocumentStart)),y.bind(G.End,F.Meta,E(R.moveCursorToDocumentEnd)),y.bind(G.Left,F.AltShift,E(R.extendSelectionBeforeWord)),y.bind(G.Right,F.AltShift,E(R.extendSelectionPastWord)),y.bind(G.Left,F.MetaShift,E(R.extendSelectionToLineStart)),
y.bind(G.Right,F.MetaShift,E(R.extendSelectionToLineEnd)),y.bind(G.Up,F.AltShift,E(R.extendSelectionToParagraphStart)),y.bind(G.Down,F.AltShift,E(R.extendSelectionToParagraphEnd)),y.bind(G.Up,F.MetaShift,E(R.extendSelectionToDocumentStart)),y.bind(G.Down,F.MetaShift,E(R.extendSelectionToDocumentEnd)),y.bind(G.A,F.Meta,E(R.extendSelectionToEntireDocument))):(y.bind(G.Left,F.Ctrl,E(R.moveCursorBeforeWord)),y.bind(G.Right,F.Ctrl,E(R.moveCursorPastWord)),y.bind(G.Left,F.CtrlShift,E(R.extendSelectionBeforeWord)),
y.bind(G.Right,F.CtrlShift,E(R.extendSelectionPastWord)),y.bind(G.A,F.Ctrl,E(R.extendSelectionToEntireDocument)));ua&&(sa=new gui.IOSSafariSupport(L));L.subscribe("keydown",y.handleEvent);L.subscribe("keypress",P.handleEvent);L.subscribe("keyup",M.handleEvent);L.subscribe("copy",n);L.subscribe("mousedown",v);L.subscribe("mousemove",la.trigger);L.subscribe("mouseup",H);L.subscribe("contextmenu",J);L.subscribe("dragstart",A);L.subscribe("dragend",K);L.subscribe("click",ma.handleClick);L.subscribe("longpress",
C);L.subscribe("drag",s);L.subscribe("dragstop",w);B.subscribe(ops.OdtDocument.signalOperationEnd,oa.trigger);B.subscribe(ops.Document.signalCursorAdded,ja.registerCursor);B.subscribe(ops.Document.signalCursorRemoved,ja.removeCursor);B.subscribe(ops.OdtDocument.signalOperationEnd,a)}})();gui.CaretManager=function(f){function h(b){return a.hasOwnProperty(b)?a[b]:null}function d(){return Object.keys(a).map(function(b){return a[b]})}function c(b){var c=a[b];c&&(delete a[b],b===f.getInputMemberId()&&f.getEventManager().unsubscribe("compositionupdate",c.handleUpdate),c.destroy(function(){}))}function e(a){a=a.getMemberId();a===f.getInputMemberId()&&(a=h(a))&&a.refreshCursorBlinking()}function m(){var a=h(f.getInputMemberId());t=!1;a&&a.ensureVisible()}function g(){var a=h(f.getInputMemberId());
a&&(a.handleUpdate(),t||(t=!0,k=runtime.setTimeout(m,50)))}function p(a){a.memberId===f.getInputMemberId()&&g()}function r(){var a=h(f.getInputMemberId());a&&a.setFocus()}function n(){var a=h(f.getInputMemberId());a&&a.removeFocus()}function q(){var a=h(f.getInputMemberId());a&&a.show()}function b(){var a=h(f.getInputMemberId());a&&a.hide()}var a={},l=runtime.getWindow(),k,t=!1;this.registerCursor=function(b,c,d){var e=b.getMemberId();c=new gui.Caret(b,c,d);d=f.getEventManager();a[e]=c;e===f.getInputMemberId()?
(runtime.log("Starting to track input on new cursor of "+e),b.subscribe(ops.OdtCursor.signalCursorUpdated,g),d.subscribe("compositionupdate",c.handleUpdate),c.setOverlayElement(d.getEventTrap())):b.subscribe(ops.OdtCursor.signalCursorUpdated,c.handleUpdate);return c};this.getCaret=h;this.getCarets=d;this.destroy=function(g){var h=f.getSession().getOdtDocument(),m=f.getEventManager(),t=d().map(function(a){return a.destroy});runtime.clearTimeout(k);h.unsubscribe(ops.OdtDocument.signalParagraphChanged,
p);h.unsubscribe(ops.Document.signalCursorMoved,e);h.unsubscribe(ops.Document.signalCursorRemoved,c);m.unsubscribe("focus",r);m.unsubscribe("blur",n);l.removeEventListener("focus",q,!1);l.removeEventListener("blur",b,!1);a={};core.Async.destroyAll(t,g)};(function(){var a=f.getSession().getOdtDocument(),d=f.getEventManager();a.subscribe(ops.OdtDocument.signalParagraphChanged,p);a.subscribe(ops.Document.signalCursorMoved,e);a.subscribe(ops.Document.signalCursorRemoved,c);d.subscribe("focus",r);d.subscribe("blur",
n);l.addEventListener("focus",q,!1);l.addEventListener("blur",b,!1)})()};gui.EditInfoHandle=function(f){var h=[],d,c=f.ownerDocument,e=c.documentElement.namespaceURI;this.setEdits=function(f){h=f;var g,p,r,n;d.innerHTML="";for(f=0;f<h.length;f+=1)g=c.createElementNS(e,"div"),g.className="editInfo",p=c.createElementNS(e,"span"),p.className="editInfoColor",p.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",h[f].memberid),r=c.createElementNS(e,"span"),r.className="editInfoAuthor",r.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",h[f].memberid),
n=c.createElementNS(e,"span"),n.className="editInfoTime",n.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",h[f].memberid),n.innerHTML=h[f].time,g.appendChild(p),g.appendChild(r),g.appendChild(n),d.appendChild(g)};this.show=function(){d.style.display="block"};this.hide=function(){d.style.display="none"};this.destroy=function(c){f.removeChild(d);c()};d=c.createElementNS(e,"div");d.setAttribute("class","editInfoHandle");d.style.display="none";f.appendChild(d)};ops.EditInfo=function(f,h){function d(){var c=[],d;for(d in e)e.hasOwnProperty(d)&&c.push({memberid:d,time:e[d].time});c.sort(function(c,d){return c.time-d.time});return c}var c,e={};this.getNode=function(){return c};this.getOdtDocument=function(){return h};this.getEdits=function(){return e};this.getSortedEdits=function(){return d()};this.addEdit=function(c,d){e[c]={time:d}};this.clearEdits=function(){e={}};this.destroy=function(d){f.parentNode&&f.removeChild(c);d()};c=h.getDOMDocument().createElementNS("urn:webodf:names:editinfo",
"editinfo");f.insertBefore(c,f.firstChild)};gui.EditInfoMarker=function(f,h){function d(c,b){return runtime.setTimeout(function(){g.style.opacity=c},b)}var c=this,e,m,g,p,r,n;this.addEdit=function(c,b){var a=Date.now()-b;f.addEdit(c,b);m.setEdits(f.getSortedEdits());g.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",c);runtime.clearTimeout(r);runtime.clearTimeout(n);1E4>a?(p=d(1,0),r=d(0.5,1E4-a),n=d(0.2,2E4-a)):1E4<=a&&2E4>a?(p=d(0.5,0),n=d(0.2,2E4-a)):p=d(0.2,0)};this.getEdits=function(){return f.getEdits()};this.clearEdits=
function(){f.clearEdits();m.setEdits([]);g.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&g.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")};this.getEditInfo=function(){return f};this.show=function(){g.style.display="block"};this.hide=function(){c.hideHandle();g.style.display="none"};this.showHandle=function(){m.show()};this.hideHandle=function(){m.hide()};this.destroy=function(c){runtime.clearTimeout(p);runtime.clearTimeout(r);runtime.clearTimeout(n);e.removeChild(g);
m.destroy(function(b){b?c(b):f.destroy(c)})};(function(){var d=f.getOdtDocument().getDOMDocument();g=d.createElementNS(d.documentElement.namespaceURI,"div");g.setAttribute("class","editInfoMarker");g.onmouseover=function(){c.showHandle()};g.onmouseout=function(){c.hideHandle()};e=f.getNode();e.appendChild(g);m=new gui.EditInfoHandle(e);h||c.hide()})()};gui.HyperlinkTooltipView=function(f,h){var d=new core.DomUtils,c=new odf.OdfUtils,e=runtime.getWindow(),m,g,p;runtime.assert(null!==e,"Expected to be run in an environment which has a global window, like a browser.");this.showTooltip=function(r){var n=r.target||r.srcElement,q=f.getSizer(),b=f.getZoomLevel(),a;a:{for(;n;){if(c.isHyperlink(n))break a;if(c.isParagraph(n)||c.isInlineRoot(n))break;n=n.parentNode}n=null}if(n){d.containsNode(q,p)||q.appendChild(p);a=g;var l;switch(h()){case gui.KeyboardHandler.Modifier.Ctrl:l=
runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:l=runtime.tr("\u2318-click to follow link");break;default:l=""}a.textContent=l;m.textContent=c.getHyperlinkTarget(n);p.style.display="block";a=e.innerWidth-p.offsetWidth-15;n=r.clientX>a?a:r.clientX+15;a=e.innerHeight-p.offsetHeight-10;r=r.clientY>a?a:r.clientY+10;q=q.getBoundingClientRect();n=(n-q.left)/b;r=(r-q.top)/b;p.style.left=n+"px";p.style.top=r+"px"}};this.hideTooltip=function(){p.style.display="none"};this.destroy=
function(c){p.parentNode&&p.parentNode.removeChild(p);c()};(function(){var c=f.getElement().ownerDocument;m=c.createElement("span");g=c.createElement("span");m.className="webodf-hyperlinkTooltipLink";g.className="webodf-hyperlinkTooltipText";p=c.createElement("div");p.className="webodf-hyperlinkTooltip";p.appendChild(m);p.appendChild(g);f.getElement().appendChild(p)})()};gui.ShadowCursor=function(f){var h=f.getDOMDocument().createRange(),d=!0;this.removeFromDocument=function(){};this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId};this.getSelectedRange=function(){return h};this.setSelectedRange=function(c,e){h=c;d=!1!==e};this.hasForwardSelection=function(){return d};this.getDocument=function(){return f};this.getSelectionType=function(){return ops.OdtCursor.RangeSelection};h.setStart(f.getRootNode(),0)};gui.ShadowCursor.ShadowCursorMemberId="";gui.SelectionView=function(f){};gui.SelectionView.prototype.rerender=function(){};gui.SelectionView.prototype.show=function(){};gui.SelectionView.prototype.hide=function(){};gui.SelectionView.prototype.destroy=function(f){};gui.SelectionViewManager=function(f){function h(){return Object.keys(d).map(function(c){return d[c]})}var d={};this.getSelectionView=function(c){return d.hasOwnProperty(c)?d[c]:null};this.getSelectionViews=h;this.removeSelectionView=function(c){d.hasOwnProperty(c)&&(d[c].destroy(function(){}),delete d[c])};this.hideSelectionView=function(c){d.hasOwnProperty(c)&&d[c].hide()};this.showSelectionView=function(c){d.hasOwnProperty(c)&&d[c].show()};this.rerenderSelectionViews=function(){Object.keys(d).forEach(function(c){d[c].rerender()})};
this.registerCursor=function(c,e){var h=c.getMemberId(),g=new f(c);e?g.show():g.hide();return d[h]=g};this.destroy=function(c){function d(g,h){h?c(h):g<f.length?f[g].destroy(function(c){d(g+1,c)}):c()}var f=h();d(0,void 0)}};gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0};
(function(){gui.SessionView=function(f,h,d,c,e,m){function g(){var a=document.getElementsByTagName("head").item(0),b=document.createElement("style");b.type="text/css";b.media="screen, print, handheld, projection";a.appendChild(b);return b}function p(a,b,c){function d(b,c,e){c=b+'[editinfo|memberid="'+a+'"]'+e+c;a:{var g=s.firstChild;for(b=b+'[editinfo|memberid="'+a+'"]'+e+"{";g;){if(g.nodeType===Node.TEXT_NODE&&0===g.data.indexOf(b)){b=g;break a}g=g.nextSibling}b=null}b?b.data=c:s.appendChild(document.createTextNode(c))}
d("div.editInfoMarker","{ background-color: "+c+"; }","");d("span.editInfoColor","{ background-color: "+c+"; }","");d("span.editInfoAuthor",'{ content: "'+b+'"; }',":before");d("dc|creator","{ background-color: "+c+"; }","");d(".webodf-selectionOverlay","{ fill: "+c+"; stroke: "+c+";}","");a!==gui.ShadowCursor.ShadowCursorMemberId&&a!==h||d(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable")}function r(a){var b,c;for(c in v)v.hasOwnProperty(c)&&(b=v[c],a?
b.show():b.hide())}function n(a){e.getCarets().forEach(function(b){a?b.showHandle():b.hideHandle()})}function q(a){var b=a.getMemberId();a=a.getProperties();p(b,a.fullName,a.color);h===b&&p("","",a.color)}function b(a){var b=a.getMemberId(),c=d.getOdtDocument().getMember(b).getProperties();e.registerCursor(a,u,C);m.registerCursor(a,!0);if(a=e.getCaret(b))a.setAvatarImageUrl(c.imageUrl),a.setColor(c.color);runtime.log("+++ View here +++ eagerly created an Caret for '"+b+"'! +++")}function a(a){a=a.getMemberId();
var b=m.getSelectionView(h),c=m.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),d=e.getCaret(h);a===h?(c.hide(),b&&b.show(),d&&d.show()):a===gui.ShadowCursor.ShadowCursorMemberId&&(c.show(),b&&b.hide(),d&&d.hide())}function l(a){m.removeSelectionView(a)}function k(a){var b=a.paragraphElement,c=a.memberId;a=a.timeStamp;var e,g="",f=b.getElementsByTagNameNS(x,"editinfo").item(0);f?(g=f.getAttributeNS(x,"id"),e=v[g]):(g=Math.random().toString(),e=new ops.EditInfo(b,d.getOdtDocument()),e=new gui.EditInfoMarker(e,
z),f=b.getElementsByTagNameNS(x,"editinfo").item(0),f.setAttributeNS(x,"id",g),v[g]=e);e.addEdit(c,new Date(a))}function t(){var a;""!==w.innerHTML&&(w.innerHTML="");!0===c.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(a=d.getOdtDocument().getMember(h))&&(a=a.getProperties().fullName,w.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+a+"']) .annotationRemoveButton { display: none; }")))}var s,w,x="urn:webodf:names:editinfo",v={},z=void 0!==f.editInfoMarkersInitiallyVisible?
Boolean(f.editInfoMarkersInitiallyVisible):!0,u=void 0!==f.caretAvatarsInitiallyVisible?Boolean(f.caretAvatarsInitiallyVisible):!0,C=void 0!==f.caretBlinksOnRangeSelect?Boolean(f.caretBlinksOnRangeSelect):!0;this.showEditInfoMarkers=function(){z||(z=!0,r(z))};this.hideEditInfoMarkers=function(){z&&(z=!1,r(z))};this.showCaretAvatars=function(){u||(u=!0,n(u))};this.hideCaretAvatars=function(){u&&(u=!1,n(u))};this.getSession=function(){return d};this.getCaret=function(a){return e.getCaret(a)};this.destroy=
function(e){var g=d.getOdtDocument(),f=Object.keys(v).map(function(a){return v[a]});g.unsubscribe(ops.Document.signalMemberAdded,q);g.unsubscribe(ops.Document.signalMemberUpdated,q);g.unsubscribe(ops.Document.signalCursorAdded,b);g.unsubscribe(ops.Document.signalCursorRemoved,l);g.unsubscribe(ops.OdtDocument.signalParagraphChanged,k);g.unsubscribe(ops.Document.signalCursorMoved,a);g.unsubscribe(ops.OdtDocument.signalParagraphChanged,m.rerenderSelectionViews);g.unsubscribe(ops.OdtDocument.signalTableAdded,
m.rerenderSelectionViews);g.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,m.rerenderSelectionViews);c.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,t);g.unsubscribe(ops.Document.signalMemberAdded,t);g.unsubscribe(ops.Document.signalMemberUpdated,t);s.parentNode.removeChild(s);w.parentNode.removeChild(w);(function H(a,b){b?e(b):a<f.length?f[a].destroy(function(b){H(a+1,b)}):e()})(0,void 0)};(function(){var e=d.getOdtDocument();e.subscribe(ops.Document.signalMemberAdded,
q);e.subscribe(ops.Document.signalMemberUpdated,q);e.subscribe(ops.Document.signalCursorAdded,b);e.subscribe(ops.Document.signalCursorRemoved,l);e.subscribe(ops.OdtDocument.signalParagraphChanged,k);e.subscribe(ops.Document.signalCursorMoved,a);e.subscribe(ops.OdtDocument.signalParagraphChanged,m.rerenderSelectionViews);e.subscribe(ops.OdtDocument.signalTableAdded,m.rerenderSelectionViews);e.subscribe(ops.OdtDocument.signalParagraphStyleModified,m.rerenderSelectionViews);c.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,
t);e.subscribe(ops.Document.signalMemberAdded,t);e.subscribe(ops.Document.signalMemberUpdated,t);s=g();s.appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);"));s.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);"));w=g();t()})()}})();gui.SvgSelectionView=function(f){function h(){var b=a.getRootNode();l!==b&&(l=b,k=a.getCanvas().getSizer(),k.appendChild(s),s.setAttribute("class","webodf-selectionOverlay"),x.setAttribute("class","webodf-draggable"),v.setAttribute("class","webodf-draggable"),x.setAttribute("end","left"),v.setAttribute("end","right"),x.setAttribute("r",8),v.setAttribute("r",8),s.appendChild(w),s.appendChild(x),s.appendChild(v))}function d(a){a=a.getBoundingClientRect();return Boolean(a&&0!==a.height)}function c(a){var b=
z.getTextElements(a,!0,!1),c=a.cloneRange(),e=a.cloneRange();a=a.cloneRange();if(!b.length)return null;var g;a:{g=0;var f=b[g],h=c.startContainer===f?c.startOffset:0,k=h;c.setStart(f,h);for(c.setEnd(f,k);!d(c);){if(f.nodeType===Node.ELEMENT_NODE&&k<f.childNodes.length)k=f.childNodes.length;else if(f.nodeType===Node.TEXT_NODE&&k<f.length)k+=1;else if(b[g])f=b[g],g+=1,h=k=0;else{g=!1;break a}c.setStart(f,h);c.setEnd(f,k)}g=!0}if(!g)return null;a:{g=b.length-1;f=b[g];k=h=e.endContainer===f?e.endOffset:
f.nodeType===Node.TEXT_NODE?f.length:f.childNodes.length;e.setStart(f,h);for(e.setEnd(f,k);!d(e);){if(f.nodeType===Node.ELEMENT_NODE&&0<h)h=0;else if(f.nodeType===Node.TEXT_NODE&&0<h)h-=1;else if(b[g])f=b[g],g-=1,h=k=f.length||f.childNodes.length;else{b=!1;break a}e.setStart(f,h);e.setEnd(f,k)}b=!0}if(!b)return null;a.setStart(c.startContainer,c.startOffset);a.setEnd(e.endContainer,e.endOffset);return{firstRange:c,lastRange:e,fillerRange:a}}function e(a,b){var c={};c.top=Math.min(a.top,b.top);c.left=
Math.min(a.left,b.left);c.right=Math.max(a.right,b.right);c.bottom=Math.max(a.bottom,b.bottom);c.width=c.right-c.left;c.height=c.bottom-c.top;return c}function m(a,b){b&&0<b.width&&0<b.height&&(a=a?e(a,b):b);return a}function g(b){function c(a){A.setUnfilteredPosition(a,0);return v.acceptNode(a)===K&&s.acceptPosition(A)===K?K:J}function d(a){var b=null;c(a)===K&&(b=u.getBoundingClientRect(a));return b}var e=b.commonAncestorContainer,g=b.startContainer,f=b.endContainer,h=b.startOffset,k=b.endOffset,
l,n,p=null,q,r=t.createRange(),s,v=new odf.OdfNodeFilter,w;if(g===e||f===e)return r=b.cloneRange(),p=r.getBoundingClientRect(),r.detach(),p;for(b=g;b.parentNode!==e;)b=b.parentNode;for(n=f;n.parentNode!==e;)n=n.parentNode;s=a.createRootFilter(g);for(e=b.nextSibling;e&&e!==n;)q=d(e),p=m(p,q),e=e.nextSibling;if(z.isParagraph(b))p=m(p,u.getBoundingClientRect(b));else if(b.nodeType===Node.TEXT_NODE)e=b,r.setStart(e,h),r.setEnd(e,e===n?k:e.length),q=r.getBoundingClientRect(),p=m(p,q);else for(w=t.createTreeWalker(b,
NodeFilter.SHOW_TEXT,c,!1),e=w.currentNode=g;e&&e!==f;)r.setStart(e,h),r.setEnd(e,e.length),q=r.getBoundingClientRect(),p=m(p,q),l=e,h=0,e=w.nextNode();l||(l=g);if(z.isParagraph(n))p=m(p,u.getBoundingClientRect(n));else if(n.nodeType===Node.TEXT_NODE)e=n,r.setStart(e,e===b?h:0),r.setEnd(e,k),q=r.getBoundingClientRect(),p=m(p,q);else for(w=t.createTreeWalker(n,NodeFilter.SHOW_TEXT,c,!1),e=w.currentNode=f;e&&e!==l;)if(r.setStart(e,0),r.setEnd(e,k),q=r.getBoundingClientRect(),p=m(p,q),e=w.previousNode())k=
e.length;return p}function p(a,b){var c=a.getBoundingClientRect(),d={width:0};d.top=c.top;d.bottom=c.bottom;d.height=c.height;d.left=d.right=b?c.right:c.left;return d}function r(){var a=f.getSelectedRange(),b;if(b=I&&f.getSelectionType()===ops.OdtCursor.RangeSelection&&!a.collapsed){h();var d=u.getBoundingClientRect(k),l=C.getZoomLevel(),a=c(a),m,n,q,r,t,A;if(a){b=a.firstRange;m=a.lastRange;n=a.fillerRange;q=u.translateRect(p(b,!1),d,l);t=u.translateRect(p(m,!0),d,l);r=(r=g(n))?u.translateRect(r,
d,l):e(q,t);A=r.left;r=q.left+Math.max(0,r.width-(q.left-r.left));d=Math.min(q.top,t.top);l=t.top+t.height;A=[{x:q.left,y:d+q.height},{x:q.left,y:d},{x:r,y:d},{x:r,y:l-t.height},{x:t.right,y:l-t.height},{x:t.right,y:l},{x:A,y:l},{x:A,y:d+q.height},{x:q.left,y:d+q.height}];r="";var z;for(z=0;z<A.length;z+=1)r+=A[z].x+","+A[z].y+" ";w.setAttribute("points",r);x.setAttribute("cx",q.left);x.setAttribute("cy",d+q.height/2);v.setAttribute("cx",t.right);v.setAttribute("cy",l-t.height/2);b.detach();m.detach();
n.detach()}b=Boolean(a)}s.style.display=b?"block":"none"}function n(a){I&&a===f&&H.trigger()}function q(a){a=8/a;x.setAttribute("r",a);v.setAttribute("r",a)}function b(a){k.removeChild(s);k.classList.remove("webodf-virtualSelections");f.getDocument().unsubscribe(ops.Document.signalCursorMoved,n);C.unsubscribe(gui.ZoomHelper.signalZoomChanged,q);a()}var a=f.getDocument(),l,k,t=a.getDOMDocument(),s=t.createElementNS("http://www.w3.org/2000/svg","svg"),w=t.createElementNS("http://www.w3.org/2000/svg",
"polygon"),x=t.createElementNS("http://www.w3.org/2000/svg","circle"),v=t.createElementNS("http://www.w3.org/2000/svg","circle"),z=new odf.OdfUtils,u=new core.DomUtils,C=a.getCanvas().getZoomHelper(),I=!0,A=gui.SelectionMover.createPositionIterator(a.getRootNode()),K=NodeFilter.FILTER_ACCEPT,J=NodeFilter.FILTER_REJECT,H;this.rerender=function(){I&&H.trigger()};this.show=function(){I=!0;H.trigger()};this.hide=function(){I=!1;H.trigger()};this.destroy=function(a){core.Async.destroyAll([H.destroy,b],
a)};(function(){var a=f.getMemberId();H=core.Task.createRedrawTask(r);h();s.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",a);k.classList.add("webodf-virtualSelections");f.getDocument().subscribe(ops.Document.signalCursorMoved,n);C.subscribe(gui.ZoomHelper.signalZoomChanged,q);q(C.getZoomLevel())})()};gui.UndoStateRules=function(){function f(c,d){var g=c.length;this.previous=function(){for(g-=1;0<=g;g-=1)if(d(c[g]))return c[g];return null}}function h(c){c=c.spec();var d;c.hasOwnProperty("position")&&(d=c.position);return d}function d(c){return c.isEdit}function c(c,d,g){if(!g)return g=h(c)-h(d),0===g||1===Math.abs(g);c=h(c);d=h(d);g=h(g);return c-d===d-g}this.isEditOperation=d;this.isPartOfOperationSet=function(e,h){var g=void 0!==e.group,p;if(!e.isEdit||0===h.length)return!0;p=h[h.length-1];if(g&&
e.group===p.group)return!0;a:switch(e.spec().optype){case "RemoveText":case "InsertText":p=!0;break a;default:p=!1}if(p&&h.some(d)){if(g){var r;g=e.spec().optype;p=new f(h,d);var n=p.previous(),q=null,b,a;runtime.assert(Boolean(n),"No edit operations found in state");a=n.group;runtime.assert(void 0!==a,"Operation has no group");for(b=1;n&&n.group===a;){if(g===n.spec().optype){r=n;break}n=p.previous()}if(r){for(n=p.previous();n;){if(n.group!==a){if(2===b)break;a=n.group;b+=1}if(g===n.spec().optype){q=
n;break}n=p.previous()}r=c(e,r,q)}else r=!1;return r}r=e.spec().optype;g=new f(h,d);p=g.previous();runtime.assert(Boolean(p),"No edit operations found in state");r=r===p.spec().optype?c(e,p,g.previous()):!1;return r}return!1}};gui.TrivialUndoManager=function(f){function h(a){0<a.length&&(z=!0,l(a),z=!1)}function d(){x.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:r.hasUndoStates(),redoAvailable:r.hasRedoStates()})}function c(){t!==a&&t!==s[s.length-1]&&s.push(t)}function e(a){var b=a.previousSibling||a.nextSibling;a.parentNode.removeChild(a);q.normalizeTextNodes(b)}function m(a){return Object.keys(a).map(function(b){return a[b]})}function g(a){function b(a){var f=a.spec();if(e[f.memberid])switch(f.optype){case "AddCursor":c[f.memberid]||
(c[f.memberid]=a,delete e[f.memberid],g-=1);break;case "MoveCursor":d[f.memberid]||(d[f.memberid]=a)}}var c={},d={},e={},g,f=a.pop();k.getMemberIds().forEach(function(a){e[a]=!0});for(g=Object.keys(e).length;f&&0<g;)f.reverse(),f.forEach(b),f=a.pop();return m(c).concat(m(d))}function p(){var f=b=k.cloneDocumentElement();q.getElementsByTagNameNS(f,n,"cursor").forEach(e);q.getElementsByTagNameNS(f,n,"anchor").forEach(e);c();t=a=g([a].concat(s));s.length=0;w.length=0;d()}var r=this,n="urn:webodf:names:cursor",
q=new core.DomUtils,b,a=[],l,k,t=[],s=[],w=[],x=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.TrivialUndoManager.signalDocumentRootReplaced]),v=f||new gui.UndoStateRules,z=!1;this.subscribe=function(a,b){x.subscribe(a,b)};this.unsubscribe=function(a,b){x.unsubscribe(a,b)};this.hasUndoStates=function(){return 0<s.length};this.hasRedoStates=function(){return 0<w.length};this.setDocument=function(a){k=
a};this.purgeInitialState=function(){s.length=0;w.length=0;a.length=0;t.length=0;b=null;d()};this.setInitialState=p;this.initialize=function(){b||p()};this.setPlaybackFunction=function(a){l=a};this.onOperationExecuted=function(b){z||(v.isEditOperation(b)&&(t===a||0<w.length)||!v.isPartOfOperationSet(b,t)?(w.length=0,c(),t=[b],s.push(t),x.emit(gui.UndoManager.signalUndoStateCreated,{operations:t}),d()):(t.push(b),x.emit(gui.UndoManager.signalUndoStateModified,{operations:t})))};this.moveForward=function(a){for(var b=
0,c;a&&w.length;)c=w.pop(),s.push(c),h(c),a-=1,b+=1;b&&(t=s[s.length-1],d());return b};this.moveBackward=function(c){for(var e=0;c&&s.length;)w.push(s.pop()),c-=1,e+=1;e&&(k.getMemberIds().forEach(function(a){k.removeCursor(a)}),k.setDocumentElement(b.cloneNode(!0)),x.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),h(a),s.forEach(h),t=s[s.length-1]||a,d());return e}};gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced";odf.LazyStyleProperties=function(f,h){var d={};this.value=function(c){var e;d.hasOwnProperty(c)?e=d[c]:(e=h[c](),void 0===e&&f&&(e=f.value(c)),d[c]=e);return e};this.reset=function(c){f=c;d={}}};
odf.StyleParseUtils=function(){function f(d){var c,e;d=(d=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(d))?{value:parseFloat(d[1]),unit:d[3]}:null;e=d&&d.unit;"px"===e?c=d.value:"cm"===e?c=96*(d.value/2.54):"mm"===e?c=96*(d.value/25.4):"in"===e?c=96*d.value:"pt"===e?c=d.value/0.75:"pc"===e&&(c=16*d.value);return c}var h=odf.Namespaces.stylens;this.parseLength=f;this.parsePositiveLengthOrPercent=function(d,c,e){var h;d&&(h=parseFloat(d.substr(0,
d.indexOf("%"))),isNaN(h)&&(h=void 0));var g;void 0!==h?(e&&(g=e.value(c)),h=void 0===g?void 0:h*(g/100)):h=f(d);return h};this.getPropertiesElement=function(d,c,e){for(c=e?e.nextElementSibling:c.firstElementChild;null!==c&&(c.localName!==d||c.namespaceURI!==h);)c=c.nextElementSibling;return c}};odf.GraphicProperties=function(f,h,d){var c=this,e=odf.Namespaces.stylens,m=odf.Namespaces.svgns;this.verticalPos=function(){return c.data.value("verticalPos")};this.verticalRel=function(){return c.data.value("verticalRel")};this.horizontalPos=function(){return c.data.value("horizontalPos")};this.horizontalRel=function(){return c.data.value("horizontalRel")};this.strokeWidth=function(){return c.data.value("strokeWidth")};c.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{verticalPos:function(){var c=
f.getAttributeNS(e,"vertical-pos");return""===c?void 0:c},verticalRel:function(){var c=f.getAttributeNS(e,"vertical-rel");return""===c?void 0:c},horizontalPos:function(){var c=f.getAttributeNS(e,"horizontal-pos");return""===c?void 0:c},horizontalRel:function(){var c=f.getAttributeNS(e,"horizontal-rel");return""===c?void 0:c},strokeWidth:function(){var c=f.getAttributeNS(m,"stroke-width");return h.parseLength(c)}})};
odf.ComputedGraphicProperties=function(){var f;this.setGraphicProperties=function(h){f=h};this.verticalPos=function(){return f&&f.verticalPos()||"from-top"};this.verticalRel=function(){return f&&f.verticalRel()||"page"};this.horizontalPos=function(){return f&&f.horizontalPos()||"from-left"};this.horizontalRel=function(){return f&&f.horizontalRel()||"page"}};odf.PageLayoutProperties=function(f,h,d){var c=this,e=odf.Namespaces.fons;this.pageHeight=function(){return c.data.value("pageHeight")||1123};this.pageWidth=function(){return c.data.value("pageWidth")||794};c.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{pageHeight:function(){var c;f&&(c=f.getAttributeNS(e,"page-height"),c=h.parseLength(c));return c},pageWidth:function(){var c;f&&(c=f.getAttributeNS(e,"page-width"),c=h.parseLength(c));return c}})};
odf.PageLayout=function(f,h,d){var c=null;f&&(c=h.getPropertiesElement("page-layout-properties",f));this.pageLayout=new odf.PageLayoutProperties(c,h,d&&d.pageLayout)};odf.PageLayoutCache=function(){};odf.PageLayoutCache.prototype.getPageLayout=function(f){};odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){};odf.ParagraphProperties=function(f,h,d){var c=this,e=odf.Namespaces.fons;this.marginTop=function(){return c.data.value("marginTop")};c.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{marginTop:function(){var c=f.getAttributeNS(e,"margin-top");return h.parsePositiveLengthOrPercent(c,"marginTop",d&&d.data)}})};
odf.ComputedParagraphProperties=function(){var f={},h=[];this.setStyleChain=function(d){h=d;f={}};this.marginTop=function(){var d,c;if(f.hasOwnProperty("marginTop"))d=f.marginTop;else{for(c=0;void 0===d&&c<h.length;c+=1)d=h[c].marginTop();f.marginTop=d}return d||0}};odf.TextProperties=function(f,h,d){var c=this,e=odf.Namespaces.fons;this.fontSize=function(){return c.data.value("fontSize")};c.data=new odf.LazyStyleProperties(void 0===d?void 0:d.data,{fontSize:function(){var c=f.getAttributeNS(e,"font-size");return h.parsePositiveLengthOrPercent(c,"fontSize",d&&d.data)}})};
odf.ComputedTextProperties=function(){var f={},h=[];this.setStyleChain=function(d){h=d;f={}};this.fontSize=function(){var d,c;if(f.hasOwnProperty("fontSize"))d=f.fontSize;else{for(c=0;void 0===d&&c<h.length;c+=1)d=h[c].fontSize();f.fontSize=d}return d||12}};odf.MasterPage=function(f,h){var d;f?(d=f.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=h.getPageLayout(d)):this.pageLayout=h.getDefaultPageLayout()};odf.MasterPageCache=function(){};odf.MasterPageCache.prototype.getMasterPage=function(f){};
odf.StylePileEntry=function(f,h,d,c){this.masterPage=function(){var c=f.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),h=null;c&&(h=d.getMasterPage(c));return h};(function(d){var m=f.getAttributeNS(odf.Namespaces.stylens,"family"),g=null;if("graphic"===m||"chart"===m)d.graphic=void 0===c?void 0:c.graphic,g=h.getPropertiesElement("graphic-properties",f,g),null!==g&&(d.graphic=new odf.GraphicProperties(g,h,d.graphic));if("paragraph"===m||"table-cell"===m||"graphic"===m||"presentation"===
m||"chart"===m)d.paragraph=void 0===c?void 0:c.paragraph,g=h.getPropertiesElement("paragraph-properties",f,g),null!==g&&(d.paragraph=new odf.ParagraphProperties(g,h,d.paragraph));if("text"===m||"paragraph"===m||"table-cell"===m||"graphic"===m||"presentation"===m||"chart"===m)d.text=void 0===c?void 0:c.text,g=h.getPropertiesElement("text-properties",f,g),null!==g&&(d.text=new odf.TextProperties(g,h,d.text))})(this)};
odf.StylePile=function(f,h){function d(d,b){var a,e;d.hasAttributeNS(c,"parent-style-name")&&(e=d.getAttributeNS(c,"parent-style-name"),-1===b.indexOf(e)&&(a=n(e,b)));return new odf.StylePileEntry(d,f,h,a)}var c=odf.Namespaces.stylens,e={},m={},g,p={},r={},n;n=function(c,b){var a=p[c],g;!a&&(g=e[c])&&(b.push(c),a=d(g,b),p[c]=a);return a};this.getStyle=function(c){var b=r[c]||p[c],a,g=[];b||(a=m[c],a||(a=e[c])&&g.push(c),a&&(b=d(a,g)));return b};this.addCommonStyle=function(d){var b;d.hasAttributeNS(c,
"name")&&(b=d.getAttributeNS(c,"name"),e.hasOwnProperty(b)||(e[b]=d))};this.addAutomaticStyle=function(d){var b;d.hasAttributeNS(c,"name")&&(b=d.getAttributeNS(c,"name"),m.hasOwnProperty(b)||(m[b]=d))};this.setDefaultStyle=function(c){void 0===g&&(g=d(c,[]))};this.getDefaultStyle=function(){return g}};odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties;this.graphic=new odf.ComputedGraphicProperties};
odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties;this.paragraph=new odf.ComputedParagraphProperties};odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties};
odf.StyleCache=function(f){function h(a,b,c,d){b=c.getAttributeNS(b,"class-names");var e;if(b)for(b=b.split(" "),e=0;e<b.length;e+=1)if(c=b[e])d.push(a),d.push(c)}function d(a,b){var c=s.getStyleName("paragraph",a);void 0!==c&&(b.push("paragraph"),b.push(c));a.namespaceURI!==k||"h"!==a.localName&&"p"!==a.localName||h("paragraph",k,a,b);return b}function c(a,b,c){var d=[],e,g,f,h;for(e=0;e<a.length;e+=2)f=a[e],h=a[e+1],f=p[f],h=f.getStyle(h),void 0!==h&&(h=h[b],void 0!==h&&h!==g&&(d.push(h),g=h));
f=p[c];if(h=f.getDefaultStyle())h=h[b],void 0!==h&&h!==g&&d.push(h);return d}function e(a,b){var c=s.getStyleName("text",a),g=a.parentElement;void 0!==c&&(b.push("text"),b.push(c));"span"===a.localName&&a.namespaceURI===k&&h("text",k,a,b);if(!g||g===f)return b;g.namespaceURI!==k||"p"!==g.localName&&"h"!==g.localName?e(g,b):d(g,b);return b}function m(a){a=a.getAttributeNS(t,"family");return p[a]}var g=this,p,r,n,q,b,a,l,k=odf.Namespaces.textns,t=odf.Namespaces.stylens,s=new odf.StyleInfo,w=new odf.StyleParseUtils,
x,v,z,u,C,I;this.getComputedGraphicStyle=function(a){var b=[];a=s.getStyleName("graphic",a);void 0!==a&&(b.push("graphic"),b.push(a));a=b.join("/");var d=q[a];runtime.assert(0===b.length%2,"Invalid style chain.");void 0===d&&(d=new odf.ComputedGraphicStyle,d.graphic.setGraphicProperties(c(b,"graphic","graphic")[0]),d.text.setStyleChain(c(b,"text","graphic")),d.paragraph.setStyleChain(c(b,"paragraph","graphic")),q[a]=d);return d};this.getComputedParagraphStyle=function(a){a=d(a,[]);var b=a.join("/"),
e=n[b];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===e&&(e=new odf.ComputedParagraphStyle,e.text.setStyleChain(c(a,"text","paragraph")),e.paragraph.setStyleChain(c(a,"paragraph","paragraph")),n[b]=e);return e};this.getComputedTextStyle=function(a){a=e(a,[]);var b=a.join("/"),d=r[b];runtime.assert(0===a.length%2,"Invalid style chain.");void 0===d&&(d=new odf.ComputedTextStyle,d.text.setStyleChain(c(a,"text","text")),r[b]=d);return d};this.getPageLayout=function(a){var b=I[a];b||((b=
C[a])?(b=new odf.PageLayout(b,w,u),I[a]=b):b=u);return b};this.getDefaultPageLayout=function(){return u};this.getMasterPage=function(a){var b=v[a];void 0===b&&((b=x[a])?(b=new odf.MasterPage(b,g),v[a]=b):b=null);return b};this.getDefaultMasterPage=function(){return z};this.update=function(){var c,d,e=null,h=null;r={};n={};q={};x={};v={};I={};C={};b=new odf.StylePile(w,g);a=new odf.StylePile(w,g);l=new odf.StylePile(w,g);p={text:b,paragraph:a,graphic:l};for(c=f.styles.firstElementChild;c;)c.namespaceURI===
t&&((d=m(c))?"style"===c.localName?d.addCommonStyle(c):"default-style"===c.localName&&d.setDefaultStyle(c):"default-page-layout"===c.localName&&(e=c)),c=c.nextElementSibling;u=new odf.PageLayout(e,w);for(c=f.automaticStyles.firstElementChild;c;)c.namespaceURI===t&&((d=m(c))&&"style"===c.localName?d.addAutomaticStyle(c):"page-layout"===c.localName&&(C[c.getAttributeNS(t,"name")]=c)),c=c.nextElementSibling;for(c=f.masterStyles.firstElementChild;c;)c.namespaceURI===t&&"master-page"===c.localName&&(h=
h||c,d=c,e=d.getAttributeNS(t,"name"),0<e.length&&!x.hasOwnProperty(e)&&(x[e]=d)),c=c.nextElementSibling;z=new odf.MasterPage(h,g)}};ops.OperationTransformMatrix=function(){function f(b){b.position+=b.length;b.length*=-1}function h(b){var a=0>b.length;a&&f(b);return a}function d(b,a){function c(e){b[e]===a&&d.push(e)}var d=[];b&&["style:parent-style-name","style:next-style-name"].forEach(c);return d}function c(b,a){function c(d){b[d]===a&&delete b[d]}b&&["style:parent-style-name","style:next-style-name"].forEach(c)}function e(b){var a={};Object.keys(b).forEach(function(c){a[c]="object"===typeof b[c]?e(b[c]):b[c]});return a}function m(b,
a,c,d){var e,g=!1,f=!1,h,m=[];d&&d.attributes&&(m=d.attributes.split(","));b&&(c||0<m.length)&&Object.keys(b).forEach(function(a){var d=b[a],e;"object"!==typeof d&&(c&&(e=c[a]),void 0!==e?(delete b[a],f=!0,e===d&&(delete c[a],g=!0)):-1!==m.indexOf(a)&&(delete b[a],f=!0))});if(a&&a.attributes&&(c||0<m.length)){h=a.attributes.split(",");for(d=0;d<h.length;d+=1)if(e=h[d],c&&void 0!==c[e]||m&&-1!==m.indexOf(e))h.splice(d,1),d-=1,f=!0;0<h.length?a.attributes=h.join(","):delete a.attributes}return{majorChanged:g,
minorChanged:f}}function g(b){for(var a in b)if(b.hasOwnProperty(a))return!0;return!1}function p(b){for(var a in b)if(b.hasOwnProperty(a)&&("attributes"!==a||0<b.attributes.length))return!0;return!1}function r(b,a,c,d,e){var f=b?b[e]:null,h=a?a[e]:null,n=c?c[e]:null,q=d?d[e]:null,r;r=m(f,h,n,q);f&&!g(f)&&delete b[e];h&&!p(h)&&delete a[e];n&&!g(n)&&delete c[e];q&&!p(q)&&delete d[e];return r}function n(b,a){return{opSpecsA:[b],opSpecsB:[a]}}var q;q={AddCursor:{AddCursor:n,AddMember:n,AddStyle:n,ApplyDirectStyling:n,
InsertText:n,MergeParagraph:n,MoveCursor:n,RemoveCursor:n,RemoveMember:n,RemoveStyle:n,RemoveText:n,SetParagraphStyle:n,SplitParagraph:n,UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},AddMember:{AddStyle:n,InsertText:n,MergeParagraph:n,MoveCursor:n,RemoveCursor:n,RemoveStyle:n,RemoveText:n,SetParagraphStyle:n,SplitParagraph:n,UpdateMetadata:n,UpdateParagraphStyle:n},AddStyle:{AddStyle:n,ApplyDirectStyling:n,InsertText:n,MergeParagraph:n,MoveCursor:n,RemoveCursor:n,RemoveMember:n,RemoveStyle:function(b,
a){var e,g=[b],f=[a];b.styleFamily===a.styleFamily&&(e=d(b.setProperties,a.styleName),0<e.length&&(e={optype:"UpdateParagraphStyle",memberid:a.memberid,timestamp:a.timestamp,styleName:b.styleName,removedProperties:{attributes:e.join(",")}},f.unshift(e)),c(b.setProperties,a.styleName));return{opSpecsA:g,opSpecsB:f}},RemoveText:n,SetParagraphStyle:n,SplitParagraph:n,UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},ApplyDirectStyling:{ApplyDirectStyling:function(b,a,c){var d,f,h,m,n,p,q,u;m=[b];
h=[a];if(!(b.position+b.length<=a.position||b.position>=a.position+a.length)){d=c?b:a;f=c?a:b;if(b.position!==a.position||b.length!==a.length)p=e(d),q=e(f);a=r(f.setProperties,null,d.setProperties,null,"style:text-properties");if(a.majorChanged||a.minorChanged)h=[],b=[],m=d.position+d.length,n=f.position+f.length,f.position<d.position?a.minorChanged&&(u=e(q),u.length=d.position-f.position,b.push(u),f.position=d.position,f.length=n-f.position):d.position<f.position&&a.majorChanged&&(u=e(p),u.length=
f.position-d.position,h.push(u),d.position=f.position,d.length=m-d.position),n>m?a.minorChanged&&(p=q,p.position=m,p.length=n-m,b.push(p),f.length=m-f.position):m>n&&a.majorChanged&&(p.position=n,p.length=m-n,h.push(p),d.length=n-d.position),d.setProperties&&g(d.setProperties)&&h.push(d),f.setProperties&&g(f.setProperties)&&b.push(f),c?(m=h,h=b):m=b}return{opSpecsA:m,opSpecsB:h}},InsertText:function(b,a){a.position<=b.position?b.position+=a.text.length:a.position<=b.position+b.length&&(b.length+=
a.text.length);return{opSpecsA:[b],opSpecsB:[a]}},MergeParagraph:function(b,a){var c=b.position,d=b.position+b.length;c>=a.sourceStartPosition&&(c-=1);d>=a.sourceStartPosition&&(d-=1);b.position=c;b.length=d-c;return{opSpecsA:[b],opSpecsB:[a]}},MoveCursor:n,RemoveCursor:n,RemoveStyle:n,RemoveText:function(b,a){var c=b.position+b.length,d=a.position+a.length,e=[b],f=[a];d<=b.position?b.position-=a.length:a.position<c&&(b.position<a.position?b.length=d<c?b.length-a.length:a.position-b.position:(b.position=
a.position,d<c?b.length=c-d:e=[]));return{opSpecsA:e,opSpecsB:f}},SetParagraphStyle:n,SplitParagraph:function(b,a){a.position<b.position?b.position+=1:a.position<b.position+b.length&&(b.length+=1);return{opSpecsA:[b],opSpecsB:[a]}},UpdateMetadata:n,UpdateParagraphStyle:n},InsertText:{InsertText:function(b,a,c){b.position<a.position?a.position+=b.text.length:b.position>a.position?b.position+=a.text.length:c?a.position+=b.text.length:b.position+=a.text.length;return{opSpecsA:[b],opSpecsB:[a]}},MergeParagraph:function(b,
a){b.position>=a.sourceStartPosition?b.position-=1:(b.position<a.sourceStartPosition&&(a.sourceStartPosition+=b.text.length),b.position<a.destinationStartPosition&&(a.destinationStartPosition+=b.text.length));return{opSpecsA:[b],opSpecsB:[a]}},MoveCursor:function(b,a){var c=h(a);b.position<a.position?a.position+=b.text.length:b.position<a.position+a.length&&(a.length+=b.text.length);c&&f(a);return{opSpecsA:[b],opSpecsB:[a]}},RemoveCursor:n,RemoveMember:n,RemoveStyle:n,RemoveText:function(b,a){var c;
c=a.position+a.length;var d=[b],e=[a];c<=b.position?b.position-=a.length:b.position<=a.position?a.position+=b.text.length:(a.length=b.position-a.position,c={optype:"RemoveText",memberid:a.memberid,timestamp:a.timestamp,position:b.position+b.text.length,length:c-b.position},e.unshift(c),b.position=a.position);return{opSpecsA:d,opSpecsB:e}},SplitParagraph:function(b,a){b.position<a.sourceParagraphPosition&&(a.sourceParagraphPosition+=b.text.length);b.position<=a.position?a.position+=b.text.length:b.position+=
1;return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},MergeParagraph:{MergeParagraph:function(b,a,c){var d=[b],e=[a],f;b.destinationStartPosition===a.destinationStartPosition?(d=[],e=[],b.moveCursor&&(f={optype:"MoveCursor",memberid:b.memberid,timestamp:b.timestamp,position:b.sourceStartPosition-1},d.push(f)),a.moveCursor&&(f={optype:"MoveCursor",memberid:a.memberid,timestamp:a.timestamp,position:a.sourceStartPosition-1},e.push(f)),b=c?b:a,b={optype:"SetParagraphStyle",
memberid:b.memberid,timestamp:b.timestamp,position:b.destinationStartPosition,styleName:b.paragraphStyleName},c?d.push(b):e.push(b)):b.destinationStartPosition<a.destinationStartPosition?(a.destinationStartPosition-=1,a.sourceStartPosition-=1):(b.destinationStartPosition-=1,b.sourceStartPosition-=1);return{opSpecsA:d,opSpecsB:e}},MoveCursor:function(b,a){var c=a.position,d=a.position+a.length,e=Math.min(c,d),c=Math.max(c,d);e>=b.sourceStartPosition&&(e-=1);c>=b.sourceStartPosition&&(c-=1);0<=a.length?
(a.position=e,a.length=c-e):(a.position=c,a.length=e-c);return{opSpecsA:[b],opSpecsB:[a]}},RemoveCursor:n,RemoveMember:n,RemoveStyle:n,RemoveText:function(b,a){a.position>=b.sourceStartPosition?a.position-=1:(a.position<b.destinationStartPosition&&(b.destinationStartPosition-=a.length),a.position<b.sourceStartPosition&&(b.sourceStartPosition-=a.length));return{opSpecsA:[b],opSpecsB:[a]}},SetParagraphStyle:function(b,a){var c=[b],d=[a];if(a.position>b.sourceStartPosition)a.position-=1;else if(a.position===
b.destinationStartPosition||a.position===b.sourceStartPosition)a.position=b.destinationStartPosition,b.paragraphStyleName=a.styleName;return{opSpecsA:c,opSpecsB:d}},SplitParagraph:function(b,a){var c,d=[b],e=[a];a.position<b.destinationStartPosition?(b.destinationStartPosition+=1,b.sourceStartPosition+=1):a.position>=b.destinationStartPosition&&a.position<b.sourceStartPosition?(a.paragraphStyleName=b.paragraphStyleName,c={optype:"SetParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,position:b.destinationStartPosition,
styleName:b.paragraphStyleName},d.push(c),a.position===b.sourceStartPosition-1&&b.moveCursor&&(c={optype:"MoveCursor",memberid:b.memberid,timestamp:b.timestamp,position:a.position,length:0},d.push(c)),b.destinationStartPosition=a.position+1,b.sourceStartPosition+=1):a.position>=b.sourceStartPosition&&(a.position-=1,a.sourceParagraphPosition-=1);return{opSpecsA:d,opSpecsB:e}},UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},MoveCursor:{MoveCursor:n,RemoveCursor:function(b,a){return{opSpecsA:b.memberid===
a.memberid?[]:[b],opSpecsB:[a]}},RemoveMember:n,RemoveStyle:n,RemoveText:function(b,a){var c=h(b),d=b.position+b.length,e=a.position+a.length;e<=b.position?b.position-=a.length:a.position<d&&(b.position<a.position?b.length=e<d?b.length-a.length:a.position-b.position:(b.position=a.position,b.length=e<d?d-e:0));c&&f(b);return{opSpecsA:[b],opSpecsB:[a]}},SetParagraphStyle:n,SplitParagraph:function(b,a){var c=h(b);a.position<b.position?b.position+=1:a.position<b.position+b.length&&(b.length+=1);c&&f(b);
return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},RemoveCursor:{RemoveCursor:function(b,a){var c=b.memberid===a.memberid;return{opSpecsA:c?[]:[b],opSpecsB:c?[]:[a]}},RemoveMember:n,RemoveStyle:n,RemoveText:n,SetParagraphStyle:n,SplitParagraph:n,UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},RemoveMember:{RemoveStyle:n,RemoveText:n,SetParagraphStyle:n,SplitParagraph:n,UpdateMetadata:n,UpdateParagraphStyle:n},RemoveStyle:{RemoveStyle:function(b,a){var c=
b.styleName===a.styleName&&b.styleFamily===a.styleFamily;return{opSpecsA:c?[]:[b],opSpecsB:c?[]:[a]}},RemoveText:n,SetParagraphStyle:function(b,a){var c,d=[b],e=[a];"paragraph"===b.styleFamily&&b.styleName===a.styleName&&(c={optype:"SetParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,position:a.position,styleName:""},d.unshift(c),a.styleName="");return{opSpecsA:d,opSpecsB:e}},SplitParagraph:n,UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:function(b,a){var e,f=[b],g=[a];"paragraph"===
b.styleFamily&&(e=d(a.setProperties,b.styleName),0<e.length&&(e={optype:"UpdateParagraphStyle",memberid:b.memberid,timestamp:b.timestamp,styleName:a.styleName,removedProperties:{attributes:e.join(",")}},f.unshift(e)),b.styleName===a.styleName?g=[]:c(a.setProperties,b.styleName));return{opSpecsA:f,opSpecsB:g}}},RemoveText:{RemoveText:function(b,a){var c=b.position+b.length,d=a.position+a.length,e=[b],f=[a];d<=b.position?b.position-=a.length:c<=a.position?a.position-=b.length:a.position<c&&(b.position<
a.position?(b.length=d<c?b.length-a.length:a.position-b.position,c<d?(a.position=b.position,a.length=d-c):f=[]):(c<d?a.length-=b.length:a.position<b.position?a.length=b.position-a.position:f=[],d<c?(b.position=a.position,b.length=c-d):e=[]));return{opSpecsA:e,opSpecsB:f}},SplitParagraph:function(b,a){var c=b.position+b.length,d=[b],e=[a];a.position<=b.position?b.position+=1:a.position<c&&(b.length=a.position-b.position,c={optype:"RemoveText",memberid:b.memberid,timestamp:b.timestamp,position:a.position+
1,length:c-a.position},d.unshift(c));b.position+b.length<=a.position?a.position-=b.length:b.position<a.position&&(a.position=b.position);b.position+b.length<a.sourceParagraphPosition&&(a.sourceParagraphPosition-=b.length);return{opSpecsA:d,opSpecsB:e}},UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},SetParagraphStyle:{SplitParagraph:function(b,a){var c=[b],d=[a],f;b.position>a.position?b.position+=1:b.position===a.sourceParagraphPosition&&(a.paragraphStyleName=b.styleName,f=e(b),f.position=
a.position+1,c.push(f));return{opSpecsA:c,opSpecsB:d}},UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},SplitParagraph:{SplitParagraph:function(b,a,c){var d,e;b.position<a.position?d=!0:a.position<b.position?e=!0:b.position===a.position&&(c?d=!0:e=!0);d?(a.position+=1,a.sourceParagraphPosition=b.position<a.sourceParagraphPosition?a.sourceParagraphPosition+1:b.position+1):e&&(b.position+=1,b.sourceParagraphPosition=a.position<a.sourceParagraphPosition?b.sourceParagraphPosition+1:a.position+
1);return{opSpecsA:[b],opSpecsB:[a]}},UpdateMember:n,UpdateMetadata:n,UpdateParagraphStyle:n},UpdateMember:{UpdateMetadata:n,UpdateParagraphStyle:n},UpdateMetadata:{UpdateMetadata:function(b,a,c){var d,e=[b],f=[a];d=c?b:a;b=c?a:b;m(b.setProperties||null,b.removedProperties||null,d.setProperties||null,d.removedProperties||null);d.setProperties&&g(d.setProperties)||d.removedProperties&&p(d.removedProperties)||(c?e=[]:f=[]);b.setProperties&&g(b.setProperties)||b.removedProperties&&p(b.removedProperties)||
(c?f=[]:e=[]);return{opSpecsA:e,opSpecsB:f}},UpdateParagraphStyle:n},UpdateParagraphStyle:{UpdateParagraphStyle:function(b,a,c){var d,e=[b],f=[a];b.styleName===a.styleName&&(d=c?b:a,b=c?a:b,r(b.setProperties,b.removedProperties,d.setProperties,d.removedProperties,"style:paragraph-properties"),r(b.setProperties,b.removedProperties,d.setProperties,d.removedProperties,"style:text-properties"),m(b.setProperties||null,b.removedProperties||null,d.setProperties||null,d.removedProperties||null),d.setProperties&&
g(d.setProperties)||d.removedProperties&&p(d.removedProperties)||(c?e=[]:f=[]),b.setProperties&&g(b.setProperties)||b.removedProperties&&p(b.removedProperties)||(c?f=[]:e=[]));return{opSpecsA:e,opSpecsB:f}}}};this.passUnchanged=n;this.extendTransformations=function(b){Object.keys(b).forEach(function(a){var c=b[a],d,e=q.hasOwnProperty(a);runtime.log((e?"Extending":"Adding")+" map for optypeA: "+a);e||(q[a]={});d=q[a];Object.keys(c).forEach(function(b){var e=d.hasOwnProperty(b);runtime.assert(a<=b,
"Wrong order:"+a+", "+b);runtime.log("  "+(e?"Overwriting":"Adding")+" entry for optypeB: "+b);d[b]=c[b]})})};this.transformOpspecVsOpspec=function(b,a){var c=b.optype<=a.optype,d;runtime.log("Crosstransforming:");runtime.log(runtime.toJson(b));runtime.log(runtime.toJson(a));c||(d=b,b=a,a=d);(d=(d=q[b.optype])&&d[a.optype])?(d=d(b,a,!c),c||null===d||(d={opSpecsA:d.opSpecsB,opSpecsB:d.opSpecsA})):d=null;runtime.log("result:");d?(runtime.log(runtime.toJson(d.opSpecsA)),runtime.log(runtime.toJson(d.opSpecsB))):
runtime.log("null");return d}};ops.OperationTransformer=function(){function f(d,c){for(var e,m,g=[],p=[];0<d.length&&c;){e=d.shift();e=h.transformOpspecVsOpspec(e,c);if(!e)return null;g=g.concat(e.opSpecsA);if(0===e.opSpecsB.length){g=g.concat(d);c=null;break}for(;1<e.opSpecsB.length;){m=f(d,e.opSpecsB.shift());if(!m)return null;p=p.concat(m.opSpecsB);d=m.opSpecsA}c=e.opSpecsB.pop()}c&&p.push(c);return{opSpecsA:g,opSpecsB:p}}var h=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return h};this.transform=
function(d,c){for(var e,h=[];0<c.length;){e=f(d,c.shift());if(!e)return null;d=e.opSpecsA;h=h.concat(e.opSpecsB)}return{opSpecsA:d,opSpecsB:h}}};var webodf_css="/**\n * Copyright (C) 2010-2014 KO GmbH <copyright@kogmbh.com>\n *\n * @licstart\n * This file is part of WebODF.\n *\n * WebODF is free software: you can redistribute it and/or modify it\n * under the terms of the GNU Affero General Public License (GNU AGPL)\n * as published by the Free Software Foundation, either version 3 of\n * the License, or (at your option) any later version.\n *\n * WebODF is distributed in the hope that it will be useful, but\n * WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU Affero General Public License for more details.\n *\n * You should have received a copy of the GNU Affero General Public License\n * along with WebODF.  If not, see <http://www.gnu.org/licenses/>.\n * @licend\n *\n * @source: http://www.webodf.org/\n * @source: https://github.com/kogmbh/WebODF/\n */\n\n@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);\n@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);\n@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);\n@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);\n@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);\n@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);\n@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);\n@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);\n@namespace webodfhelper url(urn:webodf:names:helper);\n@namespace cursor url(urn:webodf:names:cursor);\n@namespace editinfo url(urn:webodf:names:editinfo);\n@namespace annotation url(urn:webodf:names:annotation);\n@namespace dc url(http://purl.org/dc/elements/1.1/);\n@namespace svgns url(http://www.w3.org/2000/svg);\n\noffice|document > *, office|document-content > * {\n  display: none;\n}\noffice|body, office|document {\n  display: inline-block;\n  position: relative;\n}\n\ntext|p, text|h {\n  display: block;\n  padding: 0;\n  margin: 0;\n  line-height: normal;\n  position: relative;\n  min-height: 1.3em; /* prevent empty paragraphs and headings from collapsing if they are empty */\n}\n*[webodfhelper|containsparagraphanchor] {\n  position: relative;\n}\ntext|s {\n    white-space: pre;\n}\ntext|tab {\n  display: inline;\n  white-space: pre;\n}\ntext|tracked-changes {\n  /*Consumers that do not support change tracking, should ignore changes.*/\n  display: none;\n}\noffice|binary-data {\n  display: none;\n}\noffice|text {\n  display: block;\n  text-align: left;\n  overflow: visible;\n  word-wrap: break-word;\n}\n\noffice|text::selection {\n  /** Let's not draw selection highlight that overflows into the office|text\n   * node when selecting content across several paragraphs\n   */\n  background: transparent;\n}\n\n.webodf-virtualSelections *::selection {\n  background: transparent;\n}\n.webodf-virtualSelections *::-moz-selection {\n  background: transparent;\n}\n\noffice|text * draw|text-box {\n/** only for text documents */\n    display: block;\n    border: 1px solid #d3d3d3;\n}\noffice|text draw|frame {\n  /** make sure frames are above the main text. */\n  z-index: 1;\n}\noffice|spreadsheet {\n  display: block;\n  border-collapse: collapse;\n  empty-cells: show;\n  font-family: sans-serif;\n  font-size: 10pt;\n  text-align: left;\n  page-break-inside: avoid;\n  overflow: hidden;\n}\noffice|presentation {\n  display: inline-block;\n  text-align: left;\n}\n#shadowContent {\n  display: inline-block;\n  text-align: left;\n}\ndraw|page {\n  display: block;\n  position: relative;\n  overflow: hidden;\n}\npresentation|notes, presentation|footer-decl, presentation|date-time-decl {\n    display: none;\n}\n@media print {\n  draw|page {\n    border: 1pt solid black;\n    page-break-inside: avoid;\n  }\n  presentation|notes {\n    /*TODO*/\n  }\n}\noffice|spreadsheet text|p {\n  border: 0px;\n  padding: 1px;\n  margin: 0px;\n}\noffice|spreadsheet table|table {\n  margin: 3px;\n}\noffice|spreadsheet table|table:after {\n  /* show sheet name the end of the sheet */\n  /*content: attr(table|name);*/ /* gives parsing error in opera */\n}\noffice|spreadsheet table|table-row {\n  counter-increment: row;\n}\noffice|spreadsheet table|table-row:before {\n  width: 3em;\n  background: #cccccc;\n  border: 1px solid black;\n  text-align: center;\n  content: counter(row);\n  display: table-cell;\n}\noffice|spreadsheet table|table-cell {\n  border: 1px solid #cccccc;\n}\ntable|table {\n  display: table;\n}\ndraw|frame table|table {\n  width: 100%;\n  height: 100%;\n  background: white;\n}\ntable|table-header-rows {\n  display: table-header-group;\n}\ntable|table-row {\n  display: table-row;\n}\ntable|table-column {\n  display: table-column;\n}\ntable|table-cell {\n  width: 0.889in;\n  display: table-cell;\n  word-break: break-all; /* prevent long words from extending out the table cell */\n}\ndraw|frame {\n  display: block;\n}\ndraw|image {\n  display: block;\n  width: 100%;\n  height: 100%;\n  top: 0px;\n  left: 0px;\n  background-repeat: no-repeat;\n  background-size: 100% 100%;\n  -moz-background-size: 100% 100%;\n  background-color: #CCC;\n}\n/* only show the first image in frame */\ndraw|frame > draw|image:nth-of-type(n+2) {\n  display: none;\n}\ntext|list:before {\n    display: none;\n    content:\"\";\n}\ntext|list {\n    display: block;\n    counter-reset: list;\n}\ntext|list-item {\n    display: block;\n}\ntext|number {\n    display:none;\n}\n\ntext|a {\n    color: blue;\n    text-decoration: underline;\n    cursor: pointer;\n}\n.webodf-inactiveLinks text|a {\n    cursor: text;\n}\ntext|note-citation {\n    vertical-align: super;\n    font-size: smaller;\n}\ntext|note-body {\n    display: none;\n}\ntext|note:hover text|note-citation {\n    background: #dddddd;\n}\ntext|note:hover text|note-body {\n    display: block;\n    left:1em;\n    max-width: 80%;\n    position: absolute;\n    background: #ffffaa;\n}\ntext|bibliography-source {\n  display: none;\n}\nsvg|title, svg|desc {\n    display: none;\n}\nvideo {\n    width: 100%;\n    height: 100%\n}\n\n/* below set up the cursor */\ncursor|anchor {\n    display: none;\n}\n\ncursor|cursor {\n    display: none;\n}\n\n.webodf-caretOverlay {\n    position: absolute;\n    top: 5%; /* push down the caret; 0px can do the job, 5% looks better, 10% is a bit over */\n    height: 1em;\n    margin-left: -1px;\n    z-index: 10;\n    pointer-events: none;\n}\n\n.webodf-caretOverlay .caret {\n    position: absolute;\n    border-left: 2px solid black;\n    top: 0;\n    bottom: 0;\n}\n\n.webodf-caretOverlay .handle {\n    margin-top: 5px;\n    padding-top: 3px;\n    margin-left: auto;\n    margin-right: auto;\n    width: 64px !important;\n    height: 68px !important;\n    border-radius: 5px;\n    opacity: 0.3;\n    text-align: center;\n    background-color: black !important;\n    box-shadow: 0px 0px 5px rgb(90, 90, 90);\n    border: 1px solid black;\n\n    top: -85px !important;\n    left: -32px !important;\n}\n\n.webodf-caretOverlay .handle > img {\n    box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;\n    background-color: rgb(200, 200, 200);\n    border-radius: 5px;\n    border: 2px solid;\n    height: 60px !important;\n    width: 60px !important;\n    display: block;\n    margin: auto;\n}\n\n.webodf-caretOverlay .handle.active {\n    opacity: 0.8;\n}\n\n.webodf-caretOverlay .handle:after {\n    content: ' ';\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: black transparent transparent transparent;\n\n    top: 100%;\n    left: 43%;\n}\n\n.webodf-caretSizer {\n    display: inline-block; /* inline-block is necessary so the width can be set to 0 */\n    width: 0; /* the caret sizer shouldn't take up any horizontal space */\n    visibility: hidden; /* \"hidden\" means the client rects are still calculated, but the node content is not shown */\n}\n\n/** Input Method Editor input pane & behaviours */\n/* not within a cursor */\n#eventTrap {\n    height: auto;\n    display: block;\n    position: absolute;\n    bottom: 0;\n    right: 0;\n    width: 1px;\n    outline: none;\n    opacity: 0;\n    color: rgba(255, 255, 255, 0); /* hide the blinking caret by setting the colour to fully transparent */\n    overflow: hidden; /* The overflow visibility is used to hide and show characters being entered */\n    pointer-events: none;\n}\n\n/* within a cursor */\ncursor|cursor > #composer {\n    text-decoration: underline;\n}\n\ncursor|cursor[cursor|caret-sizer-active=\"true\"],\ncursor|cursor[cursor|composing=\"true\"] {\n    display: inline;\n}\n\neditinfo|editinfo {\n    /* Empty or invisible display:inline elements respond very badly to mouse selection.\n       Inline blocks are much more reliably selectable in Chrome & friends */\n    display: inline-block;\n}\n\n.editInfoMarker {\n    position: absolute;\n    width: 10px;\n    height: 100%;\n    left: -20px;\n    opacity: 0.8;\n    top: 0;\n    border-radius: 5px;\n    background-color: transparent;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n}\n.editInfoMarker:hover {\n    box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);\n}\n\n.editInfoHandle {\n    position: absolute;\n    background-color: black;\n    padding: 5px;\n    border-radius: 5px;\n    opacity: 0.8;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n    bottom: 100%;\n    margin-bottom: 10px;\n    z-index: 3;\n    left: -25px;\n}\n.editInfoHandle:after {\n    content: ' ';\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: black transparent transparent transparent;\n\n    top: 100%;\n    left: 5px;\n}\n.editInfo {\n    font-family: sans-serif;\n    font-weight: normal;\n    font-style: normal;\n    text-decoration: none;\n    color: white;\n    width: 100%;\n    height: 12pt;\n}\n.editInfoColor {\n    float: left;\n    width: 10pt;\n    height: 10pt;\n    border: 1px solid white;\n}\n.editInfoAuthor {\n    float: left;\n    margin-left: 5pt;\n    font-size: 10pt;\n    text-align: left;\n    height: 12pt;\n    line-height: 12pt;\n}\n.editInfoTime {\n    float: right;\n    margin-left: 30pt;\n    font-size: 8pt;\n    font-style: italic;\n    color: yellow;\n    height: 12pt;\n    line-height: 12pt;\n}\n\n.annotationWrapper {\n    display: inline;\n    position: relative;\n}\n\n.annotationRemoveButton:before {\n    content: '\u00d7';\n    color: white;\n    padding: 5px;\n    line-height: 1em;\n}\n\n.annotationRemoveButton {\n    width: 20px;\n    height: 20px;\n    border-radius: 10px;\n    background-color: black;\n    box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);\n    position: absolute;\n    top: -10px;\n    left: -10px;\n    z-index: 3;\n    text-align: center;\n    font-family: sans-serif;\n    font-style: normal;\n    font-weight: normal;\n    text-decoration: none;\n    font-size: 15px;\n}\n.annotationRemoveButton:hover {\n    cursor: pointer;\n    box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);\n}\n\n.annotationNote {\n    width: 4cm;\n    position: absolute;\n    display: inline;\n    z-index: 10;\n    top: 0;\n}\n.annotationNote > office|annotation {\n    display: block;\n    text-align: left;\n}\n\n.annotationConnector {\n    position: absolute;\n    display: inline;\n    top: 0;\n    z-index: 2;\n    border-top: 1px dashed brown;\n}\n.annotationConnector.angular {\n    -moz-transform-origin: left top;\n    -webkit-transform-origin: left top;\n    -ms-transform-origin: left top;\n    transform-origin: left top;\n}\n.annotationConnector.horizontal {\n    left: 0;\n}\n.annotationConnector.horizontal:before {\n    content: '';\n    display: inline;\n    position: absolute;\n    width: 0px;\n    height: 0px;\n    border-style: solid;\n    border-width: 8.7px 5px 0 5px;\n    border-color: brown transparent transparent transparent;\n    top: -1px;\n    left: -5px;\n}\n\noffice|annotation {\n    width: 100%;\n    height: 100%;\n    display: none;\n    background: rgb(198, 238, 184);\n    background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);\n    box-shadow: 0 3px 4px -3px #ccc;\n}\n\noffice|annotation > dc|creator {\n    display: block;\n    font-size: 10pt;\n    font-weight: normal;\n    font-style: normal;\n    font-family: sans-serif;\n    color: white;\n    background-color: brown;\n    padding: 4px;\n}\noffice|annotation > dc|date {\n    display: block;\n    font-size: 10pt;\n    font-weight: normal;\n    font-style: normal;\n    font-family: sans-serif;\n    border: 4px solid transparent;\n    color: black;\n}\noffice|annotation > text|list {\n    display: block;\n    padding: 5px;\n}\n\n/* This is very temporary CSS. This must go once\n * we start bundling webodf-default ODF styles for annotations.\n */\noffice|annotation text|p {\n    font-size: 10pt;\n    color: black;\n    font-weight: normal;\n    font-style: normal;\n    text-decoration: none;\n    font-family: sans-serif;\n}\n\n#annotationsPane {\n    background-color: #EAEAEA;\n    width: 4cm;\n    height: 100%;\n    display: none;\n    position: absolute;\n    outline: 1px solid #ccc;\n}\n\n.webodf-annotationHighlight {\n    background-color: yellow;\n    position: relative;\n}\n\n.webodf-selectionOverlay {\n    position: absolute;\n    pointer-events: none;\n    top: 0;\n    left: 0;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 15;\n}\n.webodf-selectionOverlay > polygon {\n    fill-opacity: 0.3;\n    stroke-opacity: 0.8;\n    stroke-width: 1;\n    fill-rule: evenodd;\n}\n\n.webodf-selectionOverlay > .webodf-draggable {\n    fill-opacity: 0.8;\n    stroke-opacity: 0;\n    stroke-width: 8;\n    pointer-events: all;\n    display: none;\n\n    -moz-transform-origin: center center;\n    -webkit-transform-origin: center center;\n    -ms-transform-origin: center center;\n    transform-origin: center center;\n}\n\n#imageSelector {\n    display: none;\n    position: absolute;\n    border-style: solid;\n    border-color: black;\n}\n\n#imageSelector > div {\n    width: 5px;\n    height: 5px;\n    display: block;\n    position: absolute;\n    border: 1px solid black;\n    background-color: #ffffff;\n}\n\n#imageSelector > .topLeft {\n    top: -4px;\n    left: -4px;\n}\n\n#imageSelector > .topRight {\n    top: -4px;\n    right: -4px;\n}\n\n#imageSelector > .bottomRight {\n    right: -4px;\n    bottom: -4px;\n}\n\n#imageSelector > .bottomLeft {\n    bottom: -4px;\n    left: -4px;\n}\n\n#imageSelector > .topMiddle {\n    top: -4px;\n    left: 50%;\n    margin-left: -2.5px; /* half of the width defined in #imageSelector > div */\n}\n\n#imageSelector > .rightMiddle {\n    top: 50%;\n    right: -4px;\n    margin-top: -2.5px; /* half of the height defined in #imageSelector > div */\n}\n\n#imageSelector > .bottomMiddle {\n    bottom: -4px;\n    left: 50%;\n    margin-left: -2.5px; /* half of the width defined in #imageSelector > div */\n}\n\n#imageSelector > .leftMiddle {\n    top: 50%;\n    left: -4px;\n    margin-top: -2.5px; /* half of the height defined in #imageSelector > div */\n}\n\ndiv.webodf-customScrollbars::-webkit-scrollbar\n{\n    width: 8px;\n    height: 8px;\n    background-color: transparent;\n}\n\ndiv.webodf-customScrollbars::-webkit-scrollbar-track\n{\n    background-color: transparent;\n}\n\ndiv.webodf-customScrollbars::-webkit-scrollbar-thumb\n{\n    background-color: #444;\n    border-radius: 4px;\n}\n\n.webodf-hyperlinkTooltip {\n    display: none;\n    color: white;\n    background-color: black;\n    border-radius: 5px;\n    box-shadow: 2px 2px 5px gray;\n    padding: 3px;\n    position: absolute;\n    max-width: 210px;\n    text-align: left;\n    word-break: break-all;\n    z-index: 16;\n}\n\n.webodf-hyperlinkTooltipText {\n    display: block;\n    font-weight: bold;\n}\n";
